---
# tasks file for buildbot

# This will generate passwords for these accounts.
- assert:
    that:
    - buildbot_admin_password is defined

- name: Create buildbot data volume
  docker_volume:
    name: '{{ buildbot_dv_name }}'

- name: Checkout image repo
  git:
    repo: '{{ exim4_image_repo }}'
    version: master
    dest: '{{ docker_projects_dir }}/docker-exim4'

- name: Create buildbot master image
  docker_image:
    name: '{{ buildbot_image_name }}'
    tag: '{{ docker_image_tag }}'
    path: '{{ docker_projects_dir }}/buildbot-master'

- name: Start buildbot container
  docker_container:
    name: '{{ buildbot_container_name }}'
    image: '{{ buildbot_image_name }}:{{ docker_image_tag }}'
    volumes:
      - '{{ buildbot_dv_name }}:{{ buildbot_data_path }}:z'
