---
# tasks file for buildbot-worker-ptxdist

# This will generate passwords for these accounts.
- assert:
    that:
    - buildbot_worker_ptxdist_password is defined

- name: Create buildbot data volume
  docker_volume:
    name: '{{ buildbot_dv_name }}'

- name: Checkout image repo
  git:
    repo: '{{ buildbot_worker_ptxdist_image_repo }}'
    version: master
    dest: '{{ docker_projects_dir }}/buildbot-worker-ptxdist'

- name: Create buildbot master image
  docker_image:
    name: '{{ buildbot_worker_ptxdist_image_name }}'
    tag: '{{ docker_image_tag }}'
    path: '{{ docker_projects_dir }}/buildbot-worker-ptxdist'

- name: Start buildbot container
  docker_container:
    name: '{{ buildbot_worker_ptxdist_container_name }}'
    image: '{{ buildbot_worker_ptxdist_image_name }}:{{ docker_image_tag }}'
    volumes:
      - '{{ buildbot_worker_ptxdist_dv_name }}:{{ buildbot_worker_ptxdist_data_path }}:z'
