Bottom: 86f00e3ea6c7df38d83bf99f31cf6b8130e982e0
Top:    52295b3a551db67b70ab112f2d2125ec203ff5e9
Author: Andrew Cooper <andrew.cooper@novatechweb.com>
Date:   2018-06-14 13:54:46 -0500

Refresh of update-gitlab-to-10-1

---
diff --git a/ansible-playbook/gitlab.yml b/ansible-playbook/gitlab.yml
new file mode 100644
index 00000000..e69de29b
diff --git a/roles/gitlab-omnibus-8/.env b/roles/gitlab-omnibus-8/.env
new file mode 100644
index 00000000..ab7ffa0e
--- /dev/null
+++ b/roles/gitlab-omnibus-8/.env
@@ -0,0 +1,2 @@
+GITLAB_VERSION=8.8.0-ce.0
+PUBLIC_IP=172.16.103.70
diff --git a/roles/gitlab-omnibus-8/Dockerfile b/roles/gitlab-omnibus-8/Dockerfile
new file mode 100644
index 00000000..37295b48
--- /dev/null
+++ b/roles/gitlab-omnibus-8/Dockerfile
@@ -0,0 +1,7 @@
+ARG  GITLAB_VERSION=latest
+FROM gitlab/gitlab-ce:${GITLAB_VERSION}
+
+COPY gitlab.rb /opt/gitlab/etc/gitlab.rb.template
+COPY entrypoint.sh /entrypoint.sh
+RUN  chmod +x /entrypoint.sh
+CMD [ "/entrypoint.sh", "/assets/wrapper" ]
diff --git a/roles/gitlab-omnibus-8/defaults/main.yml b/roles/gitlab-omnibus-8/defaults/main.yml
new file mode 100644
index 00000000..28fe3644
--- /dev/null
+++ b/roles/gitlab-omnibus-8/defaults/main.yml
@@ -0,0 +1,48 @@
+---
+
+# The hostname passed as an envirnment variable into the container
+gitlab_ip_addr: '127.0.0.1'
+gitlab_hostname: git.example.com
+gitlab_port_args: 
+    - 80
+    - 443
+    - 22
+
+# database usernames and passwords
+gitlab_db_user: novatech
+
+# must pass in the following variables
+# gitlab_db_password: ''
+
+# the name of the image being duilt and used for the container
+gitlab_image_repo: 'https://github.com/novatechweb/docker-gitlab.git'
+gitlab_image_name: 'gitlab/gitlab-ce:10.1.7-ce.0'
+# gitlab_dv_image_name: '{{ docker_registry_username }}/gitlab'
+# gitlab_db_image_name: '{{ docker_registry_username }}/postgres'
+# redis_image_name: '{{ docker_registry_username }}/redis'
+
+# the name of the gitlab container
+gitlab_container_name: '{{ docker_name_prefix }}gitlab'
+
+# the name of the redis container for gitlab
+# gitlab_redis_container_name: '{{ docker_name_prefix }}gitlab_redis'
+
+# the name of the postgres container for gitlab
+# gitlab_db_container_name: '{{ docker_name_prefix }}gitlab_db'
+
+# the name of the config-volume used by the container
+gitlab_cv_name: '{{ docker_name_prefix }}gitlab_CV'
+
+# the name of the data-volume used by the container
+gitlab_dv_name: '{{ docker_name_prefix }}gitlab_DV'
+
+# the name of the data-volume used by the postgres container
+# gitlab_db_dv_name: '{{ docker_name_prefix }}gitlab_db_DV'
+
+# restore directories to temporarly store data being restored into docker containers
+gitlab_docker_backup_dir: '{{ docker_backup_dir }}/GIT'
+gitlab_docker_restore_dir: '{{ bacula_dest }}{{ gitlab_docker_backup_dir }}'
+
+# Network names
+docker_network_frontend: 'frontend'
+gitlab_config_dir: '{{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}'
diff --git a/roles/gitlab-omnibus-8/docker-compose.yml b/roles/gitlab-omnibus-8/docker-compose.yml
new file mode 100644
index 00000000..8a7e6e0c
--- /dev/null
+++ b/roles/gitlab-omnibus-8/docker-compose.yml
@@ -0,0 +1,36 @@
+version: "3"
+services:
+  gitlab:
+    build:
+      context: .
+      args:
+        GITLAB_VERSION: "${GITLAB_VERSION}"
+    image: 'novatechweb/gitlab-ce:${GITLAB_VERSION}'
+    hostname: 'git.novatech-llc.com'
+    networks:
+      - frontend
+    ports:
+      - '${PUBLIC_IP}:8080:80'
+      - '${PUBLIC_IP}:8443:443'
+      - '${PUBLIC_IP}:8022:22'
+    volumes:
+      - gitlab-ce-config:/etc/gitlab
+      - gitlab-ce-logs:/var/log/gitlab
+      - gitlab-ce-data:/var/opt/gitlab
+      - gitlab-ce-backups:/mnt/backups
+      - gitlab-ssl:/run/secrets/ssl
+
+networks:
+  frontend:
+
+volumes:
+  gitlab-ce-backups:
+    external: true
+  gitlab-ce-config:
+    external: true
+  gitlab-ce-logs:
+    external: true
+  gitlab-ce-data:
+    external: true
+  gitlab-ssl:
+    external: true
diff --git a/roles/gitlab-omnibus-8/entrypoint.sh b/roles/gitlab-omnibus-8/entrypoint.sh
new file mode 100644
index 00000000..64d5bff0
--- /dev/null
+++ b/roles/gitlab-omnibus-8/entrypoint.sh
@@ -0,0 +1,15 @@
+#!/bin/sh
+
+set -x
+
+groupadd -g 993 registry
+useradd -m -u 993 -g registry -m -s /bin/sh -d /var/opt/gitlab/registry registry
+
+install -m 0755 /opt/gitlab/etc/gitlab.rb.template /etc/gitlab/gitlab.rb
+install -m 0755 -d /etc/gitlab/ssl
+install -m 0660 -t /etc/gitlab/ssl /run/secrets/ssl/nginx.crt
+install -m 0660 -t /etc/gitlab/ssl /run/secrets/ssl/nginx.key
+install -m 0660 -t /etc/gitlab/ssl /run/secrets/ssl/dhparam.pem
+chmod -R 2770 /var/opt/gitlab/git-data/repositories
+
+exec "$@"
diff --git a/roles/gitlab-omnibus-8/gitlab.rb b/roles/gitlab-omnibus-8/gitlab.rb
new file mode 100644
index 00000000..65bd2133
--- /dev/null
+++ b/roles/gitlab-omnibus-8/gitlab.rb
@@ -0,0 +1,851 @@
+## Configuration options with # in front are not active and they were
+## valid at install time. Updating the package does not update this file
+## automatically.
+## Latest options listed at:
+## https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template
+
+
+## Url on which GitLab will be reachable.
+## For more details on configuring external_url see:
+## https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/configuration.md#configuring-the-external-url-for-gitlab
+external_url 'https://127.0.0.1:8443'
+
+
+## Note: configuration settings below are optional.
+## Uncomment and change the value.
+############################
+# gitlab.yml configuration #
+############################
+
+gitlab_rails['gitlab_ssh_host'] = 'localhost'
+gitlab_rails['time_zone'] = 'America/Chicago'
+gitlab_rails['gitlab_email_enabled'] = true
+gitlab_rails['gitlab_email_from'] = 'gitlab@novatech-llc.com'
+gitlab_rails['gitlab_email_display_name'] = 'GitLab'
+gitlab_rails['gitlab_email_reply_to'] = 'noreply@novatech-llc.com'
+gitlab_rails['gitlab_default_can_create_group'] = true
+gitlab_rails['gitlab_username_changing_enabled'] = true
+# gitlab_rails['gitlab_default_theme'] = 2
+gitlab_rails['gitlab_default_projects_features_issues'] = true
+# See http://doc.gitlab.com/ce/customization/issue_closing.html for more information about this pattern.
+# gitlab_rails['gitlab_issue_closing_pattern'] = "((?:[Cc]los(?:e[sd]?|ing)|[Ff]ix(?:e[sd]|ing)?) +(?:(?:issues? +)?%{issue_ref}(?:(?:, *| +and +)?))+)"
+gitlab_rails['gitlab_default_projects_features_merge_requests'] = true
+gitlab_rails['gitlab_default_projects_features_wiki'] = false
+gitlab_rails['gitlab_default_projects_features_snippets'] = true
+# gitlab_rails['gitlab_default_projects_features_builds'] = true
+# gitlab_rails['gitlab_repository_downloads_path'] = 'tmp/repositories'
+gitlab_rails['gravatar_plain_url'] = 'http://cdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+gitlab_rails['gravatar_ssl_url'] = 'https://seccdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+# gitlab_rails['stuck_ci_builds_worker_cron'] = "0 0 * * *"
+# gitlab_rails['repository_archive_cache_worker_cron'] = "0 * * * *"
+# gitlab_rails['historical_data_worker_cron'] = "0 12 * * *"
+# gitlab_rails['update_all_mirrors_worker_cron'] = "0 * * * *"
+# gitlab_rails['update_all_remote_mirrors_worker_cron'] = "30 * * * *"
+# gitlab_rails['ldap_sync_worker_cron'] = "30 1 * * *"
+# gitlab_rails['geo_bulk_notify_worker_cron'] = "*/10 * * * * *"
+# gitlab_rails['webhook_timeout'] = 10
+# gitlab_rails['trusted_proxies'] = []
+
+## Reply by email
+# Allow users to comment on issues and merge requests by replying to notification emails.
+# For documentation on how to set this up, see http://doc.gitlab.com/ce/incoming_email/README.html
+# gitlab_rails['incoming_email_enabled'] = true
+#
+# # The email address including the `%{key}` placeholder that will be replaced to reference the item being replied to.
+# # The placeholder can be omitted but if present, it must appear in the "user" part of the address (before the `@`).
+# gitlab_rails['incoming_email_address'] = "gitlab-incoming+%{key}@gmail.com"
+#
+# # Email account username
+# # With third party providers, this is usually the full email address.
+# # With self-hosted email servers, this is usually the user part of the email address.
+# gitlab_rails['incoming_email_email'] = "gitlab-incoming@gmail.com"
+# # Email account password
+# gitlab_rails['incoming_email_password'] = "[REDACTED]"
+#
+# # IMAP server host
+# gitlab_rails['incoming_email_host'] = "imap.gmail.com"
+# # IMAP server port
+# gitlab_rails['incoming_email_port'] = 993
+# # Whether the IMAP server uses SSL
+# gitlab_rails['incoming_email_ssl'] = true
+# # Whether the IMAP server uses StartTLS
+# gitlab_rails['incoming_email_start_tls'] = false
+#
+# # The mailbox where incoming mail will end up. Usually "inbox".
+# gitlab_rails['incoming_email_mailbox_name'] = "inbox"
+#
+# gitlab_rails['incoming_email_log_directory'] = "/var/log/gitlab/mailroom"
+
+## Build Artifacts
+# gitlab_rails['artifacts_enabled'] = true
+# gitlab_rails['artifacts_path'] = "/mnt/storage/artifacts"
+
+## Git LFS
+# gitlab_rails['lfs_enabled'] = true
+# gitlab_rails['lfs_storage_path'] = "/mnt/storage/lfs-objects"
+
+## ElasticSearch (EE only)
+# gitlab_rails['elasticsearch_enabled'] = false
+# gitlab_rails['elasticsearch_host'] = "localhost"
+# gitlab_rails['elasticsearch_port'] = 9200
+
+## GitLab Pages (EE only)
+# gitlab_rails['pages_path'] = "/mnt/storage/pages"
+
+## For setting up LDAP
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md#setting-up-ldap-sign-in
+## Be careful not to break the identation in the ldap_servers block. It is in
+## yaml format and the spaces must be retained. Using tabs will not work.
+
+# gitlab_rails['ldap_enabled'] = false
+# gitlab_rails['ldap_servers'] = YAML.load <<-'EOS' # remember to close this block with 'EOS' below
+#   main: # 'main' is the GitLab 'provider ID' of this LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     method: 'plain' # "tls" or "ssl" or "plain"
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+#
+#   secondary: # 'secondary' is the GitLab 'provider ID' of second LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     method: 'plain' # "tls" or "ssl" or "plain"
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+# EOS
+gitlab_rails['ldap_enabled'] = true
+gitlab_rails['ldap_servers'] = YAML.load <<-'EOS' # remember to close this block with 'EOS' below
+  main: # 'main' is the GitLab 'provider ID' of this LDAP server
+    label: 'NovaTech'
+    host: 'ldap.novatech-llc.com'
+    port: 389
+    uid: 'uid'
+    method: 'plain' # "tls" or "ssl" or "plain"
+    bind_dn: 'cn=proxyagent,dc=novatech'
+    password: '4H:LK7g5oYkDT1nEhwR0'
+    active_directory: false
+    allow_username_or_email_login: true
+    block_auto_created_users: false
+    base: 'ou=user,dc=novatech'
+    user_filter: '(employeeType=gitlab)'
+    attributes:
+      username: ['uid', 'userid', 'sAMAccountName']
+      email:    ['mail', 'email', 'userPrincipalName']
+      name:       'cn'
+      first_name: 'givenName'
+      last_name:  'sn'
+EOS
+
+## Setting up Kerberos (EE only)
+## See http://doc.gitlab.com/ee/integration/kerberos.html#http-git-access
+# gitlab_rails['kerberos_enabled'] = true
+# gitlab_rails['kerberos_keytab'] = /etc/http.keytab
+# gitlab_rails['kerberos_service_principal_name'] = HTTP/gitlab.example.com@EXAMPLE.COM
+# gitlab_rails['kerberos_use_dedicated_port'] = true
+# gitlab_rails['kerberos_port'] = 8443
+# gitlab_rails['kerberos_https'] = true
+
+## For setting up omniauth
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md#omniauth-google-twitter-github-login
+
+# gitlab_rails['omniauth_enabled'] = false
+# gitlab_rails['omniauth_allow_single_sign_on'] = ['saml']
+# gitlab_rails['omniauth_auto_sign_in_with_provider'] = 'saml'
+# gitlab_rails['omniauth_block_auto_created_users'] = true
+# gitlab_rails['omniauth_auto_link_ldap_user'] = false
+# gitlab_rails['omniauth_auto_link_saml_user'] = false
+# gitlab_rails['omniauth_external_providers'] = ['twitter', 'google_oauth2']
+# gitlab_rails['omniauth_providers'] = [
+#   {
+#     "name" => "google_oauth2",
+#     "app_id" => "YOUR APP ID",
+#     "app_secret" => "YOUR APP SECRET",
+#     "args" => { "access_type" => "offline", "approval_prompt" => "" }
+#   }
+# ]
+#
+# If you setup bitbucket importer under omniauth providers you will need to add the keys
+# which will allow connection between bitbucket and gitlab.
+# For details see http://doc.gitlab.com/ce/integration/bitbucket.html
+# gitlab_rails['bitbucket'] = {
+#  'known_hosts_key' => 'bitbucket.org,207.223.240.182 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAubiN81eDcafrgMeLzaFPsw2kNvEcqTKl/VqLat/MaB33pZy0y3rJZtnqwR2qOOvbwKZYKiEO1O6VqNEBxKvJJelCq0dTXWT5pbO2gDXC6h6QDXCaHo6pOHGPUy+YBaGQRGuSusMEASYiWunYN0vCAI8QaXnWMXNMdFP3jHAJH0eDsoiGnLPBlBp4TNm6rYI74nMzgz3B9IikW4WVK+dc8KZJZWYjAuORU3jc1c/NPskD2ASinf8v3xnfXeukU0sJ5N6m5E8VLjObPEO+mN2t/FZTMZLiFqPWc/ALSqnMnnhwrNi2rbfg/rd/IpL8Le3pSBne8+seeFVBoGqzHM9yXw==',
+#  'private_key' => '-----BEGIN RSA PRIVATE KEY-----
+#   MIIEowIBAAKCAQEAyXxYHwz2KjcwSjTREwlhYHqrf/8U0UM8ej3cqQ551gE4Wo3t
+#   -----END RSA PRIVATE KEY-----',
+#  'public_key' => 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJfFgfDPYqN git@gitlab.example.com'
+# }
+
+## For setting up backups
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md#backups
+
+# gitlab_rails['manage_backup_path'] = true
+gitlab_rails['backup_path'] = "/var/opt/gitlab/backups"
+gitlab_rails['backup_archive_permissions'] = 0644 # See: http://doc.gitlab.com/ce/raketasks/backup_restore.html#backup-archive-permissions
+gitlab_rails['backup_pg_schema'] = 'public'
+gitlab_rails['backup_keep_time'] = 604800
+gitlab_rails['backup_upload_connection'] = {
+  :provider => 'Local',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AKIAKIAKI',
+#   'aws_secret_access_key' => 'secret123'
+:local_root => '/mnt/backups'
+}
+
+# The directory inside the mounted folder to copy backups to
+# Use '.' to store them in the root directory
+gitlab_rails['backup_upload_remote_directory'] = '.'
+# gitlab_rails['backup_multipart_chunk_size'] = 104857600
+# gitlab_rails['backup_encryption'] = 'AES256' # Turns on AWS Server-Side Encryption with Amazon S3-Managed Keys for backups
+
+## For setting up different data storing directory
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md#storing-git-data-in-an-alternative-directory
+## If you want to use a single non-default directory to store git data use
+## a path that doesn't contain symlinks.
+# git_data_dir "/var/opt/gitlab/git-data"
+
+
+## For storing GitLab application uploads, eg. LFS objects, build artifacts
+## see https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/development/shared_files.md
+# gitlab_rails['shared_path'] = '/var/opt/gitlab/gitlab-rails/shared'
+
+# DEPRECATED: gitlab_rails['satellites_timeout'] = 30
+
+## GitLab Shell settings for GitLab
+# gitlab_rails['gitlab_shell_ssh_port'] = 22
+# gitlab_rails['git_max_size'] = 20971520
+# gitlab_rails['git_timeout'] = 10
+
+## Extra customization
+# gitlab_rails['extra_google_analytics_id'] = '_your_tracking_id'
+# gitlab_rails['extra_piwik_url'] = '_your_piwik_url'
+# gitlab_rails['extra_piwik_site_id'] = '_your_piwik_site_id'
+
+# gitlab_rails['env'] = {
+#   'BUNDLE_GEMFILE' => "/opt/gitlab/embedded/service/gitlab-rails/Gemfile",
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+# gitlab_rails['rack_attack_git_basic_auth'] = {
+#   'enabled' => true,
+#   'ip_whitelist' => ["127.0.0.1"],
+#   'maxretry' => 10,
+#   'findtime' => 60,
+#   'bantime' => 3600
+# }
+
+# We do not recommend changing these directories.
+# gitlab_rails['dir'] = "/var/opt/gitlab/gitlab-rails"
+# gitlab_rails['log_directory'] = "/var/log/gitlab/gitlab-rails"
+
+###############################
+# GitLab application settings #
+###############################
+
+# gitlab_rails['uploads_directory'] = "/var/opt/gitlab/gitlab-rails/uploads"
+# gitlab_rails['rate_limit_requests_per_period'] = 10
+# gitlab_rails['rate_limit_period'] = 60
+
+# Change the initial default admin password.
+# Only applicable on inital setup, changing this setting after database is created and seeded
+# won't yield any change.
+gitlab_rails['initial_root_password'] = "nXdKrkalaZaxpk4ipYRk"
+
+############################
+# GitLab database settings #
+############################
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/database.md#database-settings
+## Only needed if you use an external database.
+
+# gitlab_rails['db_adapter'] = "postgresql"
+# gitlab_rails['db_encoding'] = "unicode"
+# gitlab_rails['db_collation'] = nil
+# gitlab_rails['db_database'] = "gitlabhq_production"
+# gitlab_rails['db_pool'] = 10
+# gitlab_rails['db_username'] = "gitlab"
+# gitlab_rails['db_password'] = nil
+# gitlab_rails['db_host'] = nil
+# gitlab_rails['db_port'] = 5432
+# gitlab_rails['db_socket'] = nil
+# gitlab_rails['db_sslmode'] = nil
+# gitlab_rails['db_sslrootcert'] = nil
+
+
+#########################
+# GitLab redis settings #
+#########################
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/redis.md#redis-settings
+## Connect to your own redis instance.
+
+# gitlab_rails['redis_host'] = "127.0.0.1"
+# gitlab_rails['redis_port'] = nil
+# gitlab_rails['redis_password'] = nil
+# gitlab_rails['redis_database'] = 0
+# gitlab_rails['redis_socket'] = "/var/opt/gitlab/redis/redis.socket"
+
+################################
+# GitLab email server settings #
+################################
+# see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/smtp.md#smtp-settings
+# Use smtp instead of sendmail/postfix.
+
+gitlab_rails['smtp_enable'] = true
+gitlab_rails['smtp_address'] = "mail.novatech-llc.com"
+gitlab_rails['smtp_port'] = 465
+gitlab_rails['smtp_user_name'] = "gitlab"
+gitlab_rails['smtp_password'] = "1-:cmnWFnfkbnemDG:2O"
+gitlab_rails['smtp_domain'] = "novatech-llc.com"
+gitlab_rails['smtp_authentication'] = "login"
+gitlab_rails['smtp_enable_starttls_auto'] = true
+gitlab_rails['smtp_tls'] = true
+# gitlab_rails['smtp_openssl_verify_mode'] = 'none' # Can be: 'none', 'peer', 'client_once', 'fail_if_no_peer_cert', see http://api.rubyonrails.org/classes/ActionMailer/Base.html
+# gitlab_rails['smtp_ca_path'] = "/etc/ssl/certs"
+# gitlab_rails['smtp_ca_file'] = "/etc/ssl/certs/ca-certificates.crt"
+
+###############################
+# Container registry settings #
+###############################
+# see  LINK
+#
+
+# Settings used by GitLab application
+# gitlab_rails['registry_enabled'] = true
+# gitlab_rails['registry_host'] = "registry.gitlab.example.com"
+# gitlab_rails['registry_port'] = "7443"
+# gitlab_rails['registry_api_url'] = "http://localhost:5000"
+# gitlab_rails['registry_key_path'] = "/var/opt/gitlab/gitlab-rails/certificate.key"
+# gitlab_rails['registry_path'] = "/var/opt/gitlab/gitlab-rails/shared/registry"
+# gitlab_rails['registry_issuer'] = "omnibus-gitlab-issuer"
+
+# Settings used by Registry application
+# registry['enable'] = true
+# registry['username'] = "registry"
+# registry['group'] = "registry"
+# registry['uid'] = nil
+# registry['gid'] = nil
+# registry['dir'] = "/var/opt/gitlab/registry"
+# registry['log_directory'] = "/var/log/gitlab/registry"
+# registry['log_level'] = "info"
+# registry['rootcertbundle'] = "/var/opt/gitlab/registry/certificate.crt"
+# registry['storage_delete_enabled'] = true
+
+####################
+# GitLab Workhorse #
+####################
+# see https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/README.md
+
+# gitlab_workhorse['enable'] = true
+# gitlab_workhorse['ha'] = false
+# gitlab_workhorse['listen_network'] = "unix"
+# gitlab_workhorse['listen_umask'] = 000
+# gitlab_workhorse['listen_addr'] = "/var/opt/gitlab/gitlab-workhorse/socket"
+# gitlab_workhorse['auth_backend'] = "http://localhost:8080"
+# gitlab_workhorse['auth_socket'] = "''" # the empty string is the default in gitlab-workhorse option parser
+# gitlab_workhorse['pprof_listen_addr'] = "''" # put an empty string on the command line
+# gitlab_workhorse['dir'] = "/var/opt/gitlab/gitlab-workhorse"
+# gitlab_workhorse['log_directory'] = "/var/log/gitlab/gitlab-workhorse"
+# gitlab_workhorse['proxy_headers_timeout'] = "1m0s"
+# gitlab_workhorse['env'] = {
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+###############
+# GitLab user #
+###############
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/tree/master/README.md#changing-the-name-of-the-git-user-group
+## Modify default git user.
+
+
+# user['username'] = "git"
+# user['group'] = "git"
+# user['uid'] = nil
+# user['gid'] = nil
+# # The shell for the git user
+# user['shell'] = "/bin/sh"
+# # The home directory for the git user
+# user['home'] = "/var/opt/gitlab"
+# user['git_user_name'] = "GitLab"
+# user['git_user_email'] = "gitlab@#{node['fqdn']}"
+
+##################
+# GitLab Unicorn #
+##################
+## Tweak unicorn settings.
+
+# unicorn['worker_timeout'] = 60
+# unicorn['worker_processes'] = 2
+
+## Advanced settings
+# unicorn['listen'] = '127.0.0.1'
+# unicorn['port'] = 8080
+# unicorn['socket'] = '/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket'
+# unicorn['pidfile'] = '/opt/gitlab/var/unicorn/unicorn.pid'
+# unicorn['tcp_nopush'] = true
+# unicorn['backlog_socket'] = 1024
+# Make sure somaxconn is equal or higher then backlog_socket
+# unicorn['somaxconn'] = 1024
+# We do not recommend changing this setting
+# unicorn['log_directory'] = "/var/log/gitlab/unicorn"
+
+## Only change these settings if you understand well what they mean
+## see https://about.gitlab.com/2015/06/05/how-gitlab-uses-unicorn-and-unicorn-worker-killer/
+## and https://github.com/kzk/unicorn-worker-killer
+# unicorn['worker_memory_limit_min'] = "300 * 1 << 20"
+# unicorn['worker_memory_limit_max'] = "350 * 1 << 20"
+
+
+##################
+# GitLab Sidekiq #
+##################
+
+# sidekiq['log_directory'] = "/var/log/gitlab/sidekiq"
+# sidekiq['shutdown_timeout'] = 4
+# sidekiq['concurrency'] = 25
+
+
+################
+# gitlab-shell #
+################
+
+# gitlab_shell['audit_usernames'] = false
+# gitlab_shell['log_level'] = 'INFO'
+# gitlab_shell['http_settings'] = { user: 'username', password: 'password', ca_file: '/etc/ssl/cert.pem', ca_path: '/etc/pki/tls/certs', self_signed_cert: false}
+# gitlab_shell['log_directory'] = "/var/log/gitlab/gitlab-shell/"
+
+## If enabled, git-annex needs to be installed on the server where gitlab is setup
+# For Debian and Ubuntu systems this can be done with: sudo apt-get install git-annex
+# For CentOS: sudo yum install epel-release && sudo yum install git-annex
+# gitlab_shell['git_annex_enabled'] = false
+
+#####################
+# GitLab PostgreSQL #
+#####################
+
+# postgresql['enable'] = true
+# postgresql['listen_address'] = nil
+# postgresql['port'] = 5432
+# postgresql['data_dir'] = "/var/opt/gitlab/postgresql/data"
+# postgresql['shared_buffers'] = "256MB" # recommend value is 1/4 of total RAM, up to 14GB.
+
+## Advanced settings
+# postgresql['ha'] = false
+# postgresql['dir'] = "/var/opt/gitlab/postgresql"
+# postgresql['log_directory'] = "/var/log/gitlab/postgresql"
+# postgresql['username'] = "gitlab-psql"
+# postgresql['uid'] = nil
+# postgresql['gid'] = nil
+# postgresql['shell'] = "/bin/sh"
+# postgresql['home'] = "/var/opt/gitlab/postgresql"
+# postgresql['user_path'] = "/opt/gitlab/embedded/bin:/opt/gitlab/bin:$PATH"
+# postgresql['sql_user'] = "gitlab"
+# postgresql['sql_ci_user'] = "gitlab_ci"
+# postgresql['max_connections'] = 200
+# postgresql['md5_auth_cidr_addresses'] = []
+# postgresql['trust_auth_cidr_addresses'] = []
+# postgresql['shmmax'] =  17179869184 # or 4294967295
+# postgresql['shmall'] =  4194304 # or 1048575
+# postgresql['work_mem'] = "8MB"
+# postgresql['maintenance_work_mem'] = "16MB"
+# postgresql['effective_cache_size'] = "1MB"
+# postgresql['checkpoint_segments'] = 10
+# postgresql['checkpoint_timeout'] = "5min"
+# postgresql['checkpoint_completion_target'] = 0.9
+# postgresql['checkpoint_warning'] = "30s"
+# postgresql['wal_buffers'] = "-1"
+
+## Replication settings
+# postgresql['sql_replication_user'] = "gitlab_replicator"
+# postgresql['wal_level'] = "hot_standby"
+# postgresql['max_wal_senders'] = 5
+# postgresql['wal_keep_segments'] = 10
+# postgresql['hot_standby'] = "off"
+
+################
+# GitLab Redis #
+################
+## Can be disabled if you are using your own redis instance.
+
+# redis['enable'] = true
+# redis['username'] = "gitlab-redis"
+# redis['uid'] = nil
+# redis['gid'] = nil
+
+
+#####################
+# GitLab Web server #
+#####################
+## see: https://gitlab.com/gitlab-org/omnibus-gitlab/tree/master/doc/settings/nginx.md#using-a-non-bundled-web-server
+## When bundled nginx is disabled we need to add the external webserver user to the GitLab webserver group.
+
+# web_server['external_users'] = []
+# web_server['username'] = 'gitlab-www'
+# web_server['group'] = 'gitlab-www'
+# web_server['uid'] = nil
+# web_server['gid'] = nil
+# web_server['shell'] = '/bin/false'
+# web_server['home'] = '/var/opt/gitlab/nginx'
+
+
+################
+# GitLab Nginx #
+################
+## see: https://gitlab.com/gitlab-org/omnibus-gitlab/tree/master/doc/settings/nginx.md
+
+nginx['enable'] = true
+# nginx['client_max_body_size'] = '250m'
+nginx['redirect_http_to_https'] = true
+# nginx['redirect_http_to_https_port'] = 80
+# nginx['ssl_client_certificate'] = "/etc/gitlab/ssl/ca.crt" # Most root CA's are included by default
+nginx['ssl_certificate'] = "/etc/gitlab/ssl/nginx.crt"
+nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/nginx.key"
+# nginx['ssl_ciphers'] = "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"
+# nginx['ssl_prefer_server_ciphers'] = "on"
+# nginx['ssl_protocols'] = "TLSv1 TLSv1.1 TLSv1.2" # recommended by https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html & https://cipherli.st/
+# nginx['ssl_session_cache'] = "builtin:1000  shared:SSL:10m" # recommended in http://nginx.org/en/docs/http/ngx_http_ssl_module.html
+# nginx['ssl_session_timeout'] = "5m" # default according to http://nginx.org/en/docs/http/ngx_http_ssl_module.html
+nginx['ssl_dhparam'] = "/etc/gitlab/ssl/dhparam.pem" # Path to dhparams.pem, eg. /etc/gitlab/ssl/dhparams.pem
+# nginx['listen_addresses'] = ['*']
+nginx['listen_port'] = 443
+# nginx['listen_https'] = nil # override only if your reverse proxy internally communicates over HTTP: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#supporting-proxied-ssl
+# nginx['custom_gitlab_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# nginx['custom_nginx_config'] = "include /etc/nginx/conf.d/example.conf;"
+# nginx['proxy_read_timeout'] = 300
+# nginx['proxy_connect_timeout'] = 300
+# nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on"
+# }
+# nginx['proxy_cache_path'] = 'proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2'
+# nginx['proxy_cache'] = 'gitlab'
+# nginx['http2_enabled'] = true
+# nginx['real_ip_trusted_addresses'] = []
+# nginx['real_ip_header'] = nil
+# nginx['real_ip_recursive'] = nil
+
+## Advanced settings
+# nginx['dir'] = "/var/opt/gitlab/nginx"
+# nginx['log_directory'] = "/var/log/gitlab/nginx"
+# nginx['worker_processes'] = 4
+# nginx['worker_connections'] = 10240
+# nginx['log_format'] = '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"'
+# nginx['sendfile'] = 'on'
+# nginx['tcp_nopush'] = 'on'
+# nginx['tcp_nodelay'] = 'on'
+# nginx['gzip'] = "on"
+# nginx['gzip_http_version'] = "1.0"
+# nginx['gzip_comp_level'] = "2"
+# nginx['gzip_proxied'] = "any"
+# nginx['gzip_types'] = [ "text/plain", "text/css", "application/x-javascript", "text/xml", "application/xml", "application/xml+rss", "text/javascript", "application/json" ]
+# nginx['keepalive_timeout'] = 65
+# nginx['cache_max_size'] = '5000m'
+
+
+
+##################
+# GitLab Logging #
+##################
+## see: https://gitlab.com/gitlab-org/omnibus-gitlab/tree/master/README.md#logs
+
+# logging['svlogd_size'] = 200 * 1024 * 1024 # rotate after 200 MB of log data
+# logging['svlogd_num'] = 30 # keep 30 rotated log files
+# logging['svlogd_timeout'] = 24 * 60 * 60 # rotate after 24 hours
+# logging['svlogd_filter'] = "gzip" # compress logs with gzip
+# logging['svlogd_udp'] = nil # transmit log messages via UDP
+# logging['svlogd_prefix'] = nil # custom prefix for log messages
+# logging['logrotate_frequency'] = "daily" # rotate logs daily
+# logging['logrotate_size'] = nil # do not rotate by size by default
+# logging['logrotate_rotate'] = 30 # keep 30 rotated logs
+# logging['logrotate_compress'] = "compress" # see 'man logrotate'
+# logging['logrotate_method'] = "copytruncate" # see 'man logrotate'
+# logging['logrotate_postrotate'] = nil # no postrotate command by default
+# logging['logrotate_dateformat'] = nil # use date extensions for rotated files rather than numbers e.g. a value of "-%Y-%m-%d" would give rotated files like production.log-2016-03-09.gz
+# Enterprise Edition only
+# logging['udp_log_shipping_host'] = nil # remote host to ship log messages to via UDP
+# logging['udp_log_shipping_port'] = 514 # remote host to ship log messages to via UDP
+
+#############
+# Logrotate #
+#############
+## see: https://gitlab.com/gitlab-org/omnibus-gitlab/tree/master/README.md#logrotate
+## You can disable built in logrotate feature.
+
+# logrotate['enable'] = true
+
+#############################
+# Users and groups accounts #
+#############################
+## Disable management of users and groups accounts.
+## Set only if creating accounts manually
+## See: http://doc.gitlab.com/omnibus/settings/configuration.html#disable-user-and-group-account-management
+# manage_accounts['enable'] = false
+
+#######################
+# Storage directories #
+#######################
+## Disable managing storage directories
+## Set only if the select directories are created manually
+## See: http://doc.gitlab.com/omnibus/settings/configuration.html#disable-storage-directories-management
+# manage_storage_directories['enable'] = false
+
+#######
+# Git #
+#######
+## Advanced setting for configuring git system settings for omnibus-gitlab internal git
+## For multiple options under one header use array of comma separated values, eg.
+## { "receive" => ["fsckObjects = true"], "alias" => ["st = status", "co = checkout"] }
+
+# omnibus_gitconfig['system'] = { "receive" => ["fsckObjects = true"] }
+
+#############
+# GitLab CI #
+#############
+## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/gitlab-ci/README.md
+
+# gitlab_ci['gitlab_ci_all_broken_builds'] = true
+# gitlab_ci['gitlab_ci_add_pusher'] = true
+# gitlab_ci['builds_directory'] = '/var/opt/gitlab/gitlab-ci/builds'
+
+# DEPRECATED
+# ci_external_url 'http://ci.example.com'
+#
+
+#####################
+# GitLab Mattermost #
+#####################
+
+# mattermost_external_url 'http://mattermost.example.com'
+#
+# mattermost['enable'] = false
+# mattermost['username'] = 'mattermost'
+# mattermost['group'] = 'mattermost'
+# mattermost['uid'] = nil
+# mattermost['gid'] = nil
+# mattermost['home'] = '/var/opt/gitlab/mattermost'
+# mattermost['database_name'] = 'mattermost_production'
+
+# mattermost['service_use_ssl'] = false
+# mattermost['service_address'] = "127.0.0.1"
+# mattermost['service_port'] = "8065"
+
+# mattermost['service_maximum_login_attempts'] = 10
+# mattermost['service_segment_developer_key'] = nil
+# mattermost['service_google_developer_key'] = nil
+# mattermost['service_enable_incoming_webhooks'] = true
+# mattermost['service_enable_post_username_override'] = false
+# mattermost['service_enable_post_icon_override'] = false
+# mattermost['service_enable_testing'] = false
+# mattermost['service_enable_security_fix_alert'] = true
+# mattermost['service_enable_insecure_outgoing_connections'] = false
+# mattermost['service_allow_cors_from'] = ""
+# mattermost['service_enable_outgoing_webhooks'] = true
+# mattermost['service_enable_commands'] = false
+# mattermost['service_enable_only_admin_integrations'] = true
+# mattermost['service_enable_oauth_service_provider'] = false
+# mattermost['service_enable_developer'] = false
+# mattermost['service_session_length_web_in_days'] = 30
+# mattermost['service_session_length_mobile_in_days'] = 30
+# mattermost['service_session_length_sso_in_days'] = 30
+# mattermost['service_session_cache_in_minutes'] = 10
+
+# mattermost['team_site_name'] = "GitLab Mattermost"
+# mattermost['team_max_users_per_team'] = 150
+# mattermost['team_enable_team_creation'] = true
+# mattermost['team_enable_user_creation'] = true
+# mattermost['team_allow_public_link'] = true
+# mattermost['team_allow_valet_default'] = false
+# mattermost['team_default_color'] = '#2389D7'
+# mattermost['team_restrict_creation_to_domains'] = "gmail.com"
+# mattermost['team_restrict_team_names'] = true
+# mattermost['team_enable_team_listing'] = false
+
+
+# mattermost['sql_driver_name'] = 'mysql'
+# mattermost['sql_data_source'] = "mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"
+# mattermost['sql_data_source_replicas'] = ["mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"]
+# mattermost['sql_max_idle_conns'] = 10
+# mattermost['sql_max_open_conns'] = 10
+# mattermost['sql_trace'] = false
+
+# mattermost['log_file_directory'] = '/var/log/gitlab/mattermost'
+# mattermost['log_console_enable'] = true
+# mattermost['log_console_level'] = 'INFO'
+# mattermost['log_enable_file'] = false
+# mattermost['log_file_level'] = 'INFO'
+# mattermost['log_file_format'] = nil
+
+# mattermost['gitlab_enable'] = false
+# mattermost['gitlab_secret'] = "123456789"
+# mattermost['gitlab_id'] = "12345656"
+# mattermost['gitlab_scope'] = ""
+# mattermost['gitlab_auth_endpoint'] = "http://gitlab.example.com/oauth/authorize"
+# mattermost['gitlab_token_endpoint'] = "http://gitlab.example.com/oauth/token"
+# mattermost['gitlab_user_api_endpoint'] = "http://gitlab.example.com/api/v3/user"
+
+# mattermost['aws'] = {'S3AccessKeyId' => '123', 'S3SecretAccessKey' => '123', 'S3Bucket' => 'aa', 'S3Region' => 'bb'}
+
+# mattermost['email_enable_sign_up_with_email'] = true
+# mattermost['email_enable_sign_in_with_email'] = true
+# mattermost['email_enable_sign_in_with_username'] = false
+# mattermost['email_send_email_notifications'] = false
+# mattermost['email_require_email_verification'] = false
+# mattermost['email_smtp_username'] = nil
+# mattermost['email_smtp_password'] = nil
+# mattermost['email_smtp_server'] = nil
+# mattermost['email_smtp_port'] = nil
+# mattermost['email_connection_security'] = nil
+# mattermost['email_feedback_name'] = nil
+# mattermost['email_feedback_email'] = nil
+# mattermost['email_send_push_notifications'] = true
+# mattermost['email_push_notification_server'] = ""
+
+# mattermost['file_driver_name'] = "local"
+# mattermost['file_directory'] = "/var/opt/gitlab/mattermost/data"
+# mattermost['file_enable_public_link'] = true
+# mattermost['file_thumbnail_width'] = 120
+# mattermost['file_thumbnail_height'] = 100
+# mattermost['file_preview_width'] = 1024
+# mattermost['file_preview_height'] = 0
+# mattermost['file_profile_width'] = 128
+# mattermost['file_profile_height'] = 128
+# mattermost['file_initial_font'] = 'luximbi.ttf'
+# mattermost['file_amazon_s3_access_key_id'] = nil
+# mattermost['file_amazon_s3_bucket'] = nil
+# mattermost['file_amazon_s3_secret_access_key'] = nil
+# mattermost['file_amazon_s3_bucket'] = nil
+# mattermost["file_amazon_s3_endpoint"] = nil
+# mattermost["file_amazon_s3_bucket_endpoint"] = nil
+# mattermost["file_amazon_s3_location_constraint"] = false
+# mattermost["file_amazon_s3_lowercase_bucket"] = false
+
+# mattermost['ratelimit_enable_rate_limiter'] = true
+# mattermost['ratelimit_per_sec'] = 10
+# mattermost['ratelimit_memory_store_size'] = 10000
+# mattermost['ratelimit_vary_by_remote_addr'] = true
+# mattermost['ratelimit_vary_by_header'] = nil
+
+# mattermost['support_terms_of_service_link'] = "/static/help/terms.html"
+# mattermost['support_privacy_policy_link'] = "/static/help/privacy.html"
+# mattermost['support_about_link'] = "/static/help/about.html"
+# mattermost['support_report_a_problem_link'] =  "/static/help/report_problem.html"
+# mattermost['support_email'] =  "support@example.com"
+
+# mattermost['privacy_show_email_address'] = true
+# mattermost['privacy_show_full_name'] = true
+
+
+####################
+# Mattermost NGINX #
+####################
+
+# mattermost_nginx['enable'] = false
+# mattermost_nginx['client_max_body_size'] = '250m'
+# mattermost_nginx['redirect_http_to_https'] = false
+# mattermost_nginx['redirect_http_to_https_port'] = 80
+# mattermost_nginx['ssl_certificate'] = "/etc/gitlab/ssl/#{node['fqdn']}.crt"
+# mattermost_nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/#{node['fqdn']}.key"
+# mattermost_nginx['ssl_ciphers'] = "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"
+# mattermost_nginx['ssl_prefer_server_ciphers'] = "on"
+# mattermost_nginx['ssl_protocols'] = "TLSv1 TLSv1.1 TLSv1.2" # recommended by https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html & https://cipherli.st/
+# mattermost_nginx['ssl_session_cache'] = "builtin:1000  shared:SSL:10m" # recommended in http://nginx.org/en/docs/http/ngx_http_ssl_module.html
+# mattermost_nginx['ssl_session_timeout'] = "5m" # default according to http://nginx.org/en/docs/http/ngx_http_ssl_module.html
+# mattermost_nginx['ssl_dhparam'] = nil # Path to ci_dhparams.pem, eg. /etc/gitlab/ssl/ci_dhparams.pem
+# mattermost_nginx['listen_addresses'] = ['*']
+# mattermost_nginx['listen_port'] = nil # override only if you use a reverse proxy: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#setting-the-nginx-listen-port
+# mattermost_nginx['listen_https'] = nil # override only if your reverse proxy internally communicates over HTTP: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#supporting-proxied-ssl
+# mattermost_nginx['custom_gitlab_mattermost_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# mattermost_nginx['custom_nginx_config'] = "include /etc/nginx/conf.d/example.conf;"
+# mattermost_nginx['real_ip_trusted_addresses'] = []
+# mattermost_nginx['real_ip_header'] = nil
+# mattermost_nginx['real_ip_recursive'] = nil
+
+## Advanced settings
+# mattermost_nginx['dir'] = "/var/opt/gitlab/nginx"
+# mattermost_nginx['log_directory'] = "/var/log/gitlab/nginx"
+# mattermost_nginx['worker_processes'] = 4
+# mattermost_nginx['worker_connections'] = 10240
+# mattermost_nginx['sendfile'] = 'on'
+# mattermost_nginx['tcp_nopush'] = 'on'
+# mattermost_nginx['tcp_nodelay'] = 'on'
+# mattermost_nginx['gzip'] = "on"
+# mattermost_nginx['gzip_http_version'] = "1.0"
+# mattermost_nginx['gzip_comp_level'] = "2"
+# mattermost_nginx['gzip_proxied'] = "any"
+# mattermost_nginx['gzip_types'] = [ "text/plain", "text/css", "application/x-javascript", "text/xml", "application/xml", "application/xml+rss", "text/javascript", "application/json" ]
+# mattermost_nginx['keepalive_timeout'] = 65
+# mattermost_nginx['cache_max_size'] = '5000m'
+
+####################
+# GitLab Pages
+####################
+
+## Define to enable GitLab Pages
+# pages_external_url "http://pages.example.com/"
+
+# gitlab_pages['enable'] = false
+# gitlab_pages['external_http'] = nil # Configure to expose GitLab Pages on external IP address, serving the HTTP
+# gitlab_pages['external_https'] = nil # Configure to expose GitLab Pages on external IP address, serving the HTTPS
+# gitlab_pages['listen_proxy'] = "localhost:8090"
+# gitlab_pages['redirect_http'] = true
+# gitlab_pages['use_http2'] = true
+# gitlab_pages['dir'] = "/var/opt/gitlab/gitlab-pages"
+# gitlab_pages['log_directory'] = "/var/log/gitlab/gitlab-pages"
+
+####################
+# GitLab Pages NGINX #
+####################
+
+# pages_nginx['enable'] = false
+# pages_nginx['redirect_http_to_https'] = false
+# pages_nginx['redirect_http_to_https_port'] = 80
+# pages_nginx['ssl_certificate'] = "/etc/gitlab/ssl/#{node['fqdn']}.crt"
+# pages_nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/#{node['fqdn']}.key"
+# pages_nginx['ssl_ciphers'] = "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"
+# pages_nginx['ssl_prefer_server_ciphers'] = "on"
+# pages_nginx['ssl_protocols'] = "TLSv1 TLSv1.1 TLSv1.2" # recommended by https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html & https://cipherli.st/
+# pages_nginx['ssl_session_cache'] = "builtin:1000  shared:SSL:10m" # recommended in http://nginx.org/en/docs/http/ngx_http_ssl_module.html
+# pages_nginx['ssl_session_timeout'] = "5m" # default according to http://nginx.org/en/docs/http/ngx_http_ssl_module.html
+# pages_nginx['ssl_dhparam'] = nil # Path to ci_dhparams.pem, eg. /etc/gitlab/ssl/ci_dhparams.pem
+# pages_nginx['listen_addresses'] = ['*']
+# pages_nginx['listen_port'] = nil # override only if you use a reverse proxy: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#setting-the-nginx-listen-port
+# pages_nginx['listen_https'] = nil # override only if your reverse proxy internally communicates over HTTP: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#supporting-proxied-ssl
+# pages_nginx['custom_gitlab_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+
+## Advanced settings
+# pages_nginx['dir'] = "/var/opt/gitlab/nginx"
+# pages_nginx['log_directory'] = "/var/log/gitlab/nginx"
diff --git a/roles/gitlab-omnibus-8/tasks/main.yml b/roles/gitlab-omnibus-8/tasks/main.yml
new file mode 100644
index 00000000..82072b97
--- /dev/null
+++ b/roles/gitlab-omnibus-8/tasks/main.yml
@@ -0,0 +1,122 @@
+---
+# file: roles/docker-gitlab/tasks/main.yaml
+
+- assert:
+    that:
+    - gitlab_db_password is defined
+
+# *****************************************************************************
+# Setup the directory where the backup and restore is to take place
+
+- name: restore dir
+  file:
+    state: directory
+    path: '{{ gitlab_docker_restore_dir }}'
+    owner: root
+    group: tape
+    mode: 'u=rwx,g=rwx,o=rx'
+    recurse: no
+    setype: svirt_sandbox_file_t
+
+- name: docker_container.conf dir
+  file:
+    state: directory
+    path: '{{ gitlab_config_dir }}'
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rx,o=rx'
+    recurse: no
+
+# *****************************************************************************
+# backup script part
+
+- name: Assemble dir for backup scripts
+  file:
+    path: /usr/libexec/bacula/backup-scripts
+    state: directory
+
+- name: before_backup script part
+  template:
+    src: before_backup.j2
+    dest: /usr/libexec/bacula/backup-scripts/55.before_backup.gitlab
+
+- name: after_backup script part
+  template:
+    src: after_backup.j2
+    dest: /usr/libexec/bacula/backup-scripts/55.after_backup.gitlab
+
+# *****************************************************************************
+# update the Docker restore config
+
+# contains the database username and password
+- name: make gitlab.rb
+  template:
+    src: gitlab.rb.j2
+    dest: '{{ gitlab_config_dir }}/gitlab.rb'
+    backup: yes
+    owner: root
+    group: root
+    mode: 'u=rw,g=r,o='
+- name: exists - state file
+  stat:
+    path: '{{ gitlab_config_dir }}/restore.date.txt'
+    get_checksum: False
+    get_md5: False
+  register: st_gitlab_restore
+
+# *****************************************************************************
+# Create the data volumes
+
+- name: config-volume container (gitlab)
+  docker_volume:
+    name: '{{ gitlab_cv_name }}'
+
+
+- name: data-volume container (gitlab)
+  docker_volume:
+    name: '{{ gitlab_dv_name }}'
+
+# *****************************************************************************
+# Create the gitlab container
+
+- name: create container (gitlab)
+  docker_container:
+    name: '{{ gitlab_container_name }}'
+    detach: true
+    restart_policy: '{{ docker_restart_policy }}'
+    hostname: '{{ gitlab_hostname }}'
+    ports: '{{ gitlab_port_args }}'
+    networks:
+      - name: '{{ docker_network_frontend }}'
+    volumes:
+      - '{{ openssl_dv_name }}:/etc/ssl/private:z'
+      - '{{ gitlab_cv_name }}:/etc/gitlab:z'
+      - '{{ gitlab_dv_name }}:/var/opt/gitlab:z'
+      - '{{ gitlab_docker_backup_dir }}:/mnt/backups:z'
+    image: '{{ gitlab_image_name }}'
+    state: present
+
+- name: Copy config into container
+  command: >
+    docker cp
+    '{{ gitlab_config_dir }}/gitlab.rb'
+    '{{ gitlab_container_name }}:/etc/gitlab/gitlab.rb'
+
+- name: start container (gitlab)
+  docker_container:
+    name: '{{ gitlab_container_name }}'
+    state: started
+
+- name: Wait for gitlab to be fully running
+  wait_for:
+    delay: 10
+    host: '{{ gitlab_network.ip_addr }}'
+    port: 22
+    state: started
+    timeout: 180
+
+# *****************************************************************************
+# restore?
+
+- include_tasks: restore.yml
+  when: st_gitlab_restore.stat.exists == False
diff --git a/roles/gitlab-omnibus-8/tasks/restore.yml b/roles/gitlab-omnibus-8/tasks/restore.yml
new file mode 100644
index 00000000..aeeef7a4
--- /dev/null
+++ b/roles/gitlab-omnibus-8/tasks/restore.yml
@@ -0,0 +1,95 @@
+---
+# file: roles/docker-gitlab/tasks/restore.yaml
+
+# *****************************************************************************
+# Get data from tape
+
+- name: find files
+  find:
+    path: '{{ gitlab_docker_restore_dir }}'
+    file_type: any
+  register: gitlab_backup
+
+- name: data from tape
+  bacula:
+    command: restore
+    storage: '{{ bacula_storage }}'
+    fileset: '{{ bacula_fileset }}'
+    dest: '{{ bacula_dest }}'
+    path_to_restore: '{{ gitlab_docker_backup_dir }}'
+  when: gitlab_backup.matched == 0
+
+- name: find files
+  find:
+    path: '{{ gitlab_docker_restore_dir }}'
+    file_type: any
+    follow: yes
+  register: gitlab_backup
+
+- name: File permissions
+  file:
+    path: '{{ gitlab_docker_restore_dir }}/{{ item }}'
+    state: touch
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rwx,o='
+  with_items: '{{ gitlab_backup.file_list | default([]) }}'
+
+# *****************************************************************************
+# restore the gitlab backup
+
+- name: Copy backup files to container
+  copy:
+    remote_src: yes
+    src: '{{ item.path }}'
+    dest: '{{ gitlab_docker_backup_dir }}/'
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rwx,o=rwx'
+  loop: "{{ gitlab_backup.files }}"
+
+- name: shut down gitlab services for restoration
+  command: >
+    docker exec -t {{ gitlab_container_name }} gitlab-ctl stop {{ item }}
+  loop:
+  - unicorn
+  - sidekiq
+
+- name: gitlab restore script
+  command: >
+    docker exec -t {{ gitlab_container_name }}
+    /bin/sh -c 'tar vxzf /mnt/backups/etc-gitlab-*.tgz -C /' 
+
+- name: gitlab restore script
+  command: >
+    docker exec -t {{ gitlab_container_name }}
+    gitlab-rake gitlab:backup:restore force=yes
+
+- name: reconfigure gitlab for updated configuration
+  command: >
+    docker exec -t {{ gitlab_container_name }} gitlab-ctl reconfigure
+
+- name: restart gitlab services
+  command: >
+    docker exec -t {{ gitlab_container_name }} gitlab-ctl start
+
+- name: Set root user password in restored database
+  command: >
+    docker exec -t {{ gitlab_container_name }} 
+    gitlab-rails runner 
+      'user=User.where(id: 1).first;
+       user.password="{{ gitlab_root_password }}";
+       user.password_confirmation="{{ gitlab_root_password }}";
+       user.save!'
+
+# *****************************************************************************
+# cleanup
+
+- name: Remove files
+  file:
+    path: '{{ gitlab_docker_restore_dir }}'
+    state: absent
+
+- name: State file
+  shell: 'date --rfc-3339=seconds > {{ gitlab_config_dir }}/restore.date.txt'
+  when: st_gitlab_restore.stat.exists == False
diff --git a/roles/gitlab-omnibus-8/templates/before_backup.j2 b/roles/gitlab-omnibus-8/templates/before_backup.j2
new file mode 100644
index 00000000..a85ea225
--- /dev/null
+++ b/roles/gitlab-omnibus-8/templates/before_backup.j2
@@ -0,0 +1,10 @@
+{% if gitlab_docker_backup_dir is defined %}
+
+# *****************************************************************************
+# Backup gitlab
+docker run --rm -v {{ docker_backup_dir }}:/tmp/import_export:z debian:latest bash -c "rm -rf /tmp/import_export/GIT"
+mkdir -p -m u=rwx,g=rwx,o= {{ gitlab_docker_backup_dir }}
+docker exec -t {{ gitlab_container_name }} gitlab_rake gitlab:backup:create
+docker exec -t {{ gitlab_container_name }} /bin/sh -c \
+    'umask 0077; tar czf /mnt/backups/$(date "+etc-gitlab-\%s.tgz") -C / etc/gitlab'
+{% endif %}
diff --git a/roles/gitlab-omnibus-8/templates/gitlab.rb.j2 b/roles/gitlab-omnibus-8/templates/gitlab.rb.j2
new file mode 100644
index 00000000..8102b4bb
--- /dev/null
+++ b/roles/gitlab-omnibus-8/templates/gitlab.rb.j2
@@ -0,0 +1,1726 @@
+## GitLab configuration settings
+##! This file is generated during initial installation and **is not** modified
+##! during upgrades.
+##! Check out the latest version of this file to know about the different
+##! settings that can be configured by this file, which may be found at:
+##! https://gitlab.com/gitlab-org/omnibus-gitlab/raw/master/files/gitlab-config-template/gitlab.rb.template
+
+
+## GitLab URL
+##! URL on which GitLab will be reachable.
+##! For more details on configuring external_url see:
+##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab
+external_url 'https://{{ gitlab_hostname }}'
+
+## Roles for multi-instance GitLab
+##! The default is to have no roles enabled, which results in GitLab running as an all-in-one instance.
+##! Options:
+##!   redis_sentinel_role redis_master_role redis_slave_role geo_primary_role geo_secondary_role
+##! For more deatils on each role, see:
+##! https://docs.gitlab.com/omnibus/roles/README.html#roles
+##!
+# roles ['redis_sentinel_role', 'redis_master_role']
+
+## Legend
+##! The following notations at the beginning of each line may be used to
+##! differentiate between components of this file and to easily select them using
+##! a regex.
+##! ## Titles, subtitles etc
+##! ##! More information - Description, Docs, Links, Issues etc.
+##! Configuration settings have a single # followed by a single space at the
+##! beginning; Remove them to enable the setting.
+
+##! **Configuration settings below are optional.**
+##! **The values currently assigned are only examples and ARE NOT the default
+##!   values.**
+
+
+################################################################################
+################################################################################
+##                Configuration Settings for GitLab CE and EE                 ##
+################################################################################
+################################################################################
+
+################################################################################
+## gitlab.yml configuration
+##! Docs: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/gitlab.yml.md
+################################################################################
+gitlab_rails['gitlab_ssh_host'] = '{{ gitlab_hostname }}'
+gitlab_rails['time_zone'] = 'America/Chicago'
+
+### Email Settings
+gitlab_rails['gitlab_email_enabled'] = true
+gitlab_rails['gitlab_email_from'] = 'gitlab@novatech-llc.com'
+gitlab_rails['gitlab_email_display_name'] = 'GitLab'
+gitlab_rails['gitlab_email_reply_to'] = 'noreply@novatech-llc.com'
+# gitlab_rails['gitlab_email_subject_suffix'] = ''
+
+### GitLab user privileges
+gitlab_rails['gitlab_default_can_create_group'] = true
+gitlab_rails['gitlab_username_changing_enabled'] = true
+
+### Default Theme
+# gitlab_rails['gitlab_default_theme'] = 2
+
+### Default project feature settings
+gitlab_rails['gitlab_default_projects_features_issues'] = true
+gitlab_rails['gitlab_default_projects_features_merge_requests'] = true
+gitlab_rails['gitlab_default_projects_features_wiki'] = false
+gitlab_rails['gitlab_default_projects_features_snippets'] = true
+# gitlab_rails['gitlab_default_projects_features_builds'] = true
+# gitlab_rails['gitlab_default_projects_features_container_registry'] = true
+
+### Automatic issue closing
+###! See https://docs.gitlab.com/ce/customization/issue_closing.html for more
+###! information about this pattern.
+# gitlab_rails['gitlab_issue_closing_pattern'] = "((?:[Cc]los(?:e[sd]?|ing)|[Ff]ix(?:e[sd]|ing)?|[Rr]esolv(?:e[sd]?|ing)|[Ii]mplement(?:s|ed|ing)?)(:?) +(?:(?:issues? +)?%{issue_ref}(?:(?:, *| +and +)?)|([A-Z][A-Z0-9_]+-\d+))+)"
+
+### Download location
+###! When a user clicks e.g. 'Download zip' on a project, a temporary zip file
+###! is created in the following directory.
+# gitlab_rails['gitlab_repository_downloads_path'] = 'tmp/repositories'
+
+### Gravatar Settings
+gitlab_rails['gravatar_plain_url'] = 'http://cdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+gitlab_rails['gravatar_ssl_url'] = 'https://seccdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+
+### Auxiliary jobs
+###! Periodically executed jobs, to self-heal Gitlab, do external
+###! synchronizations, etc.
+###! Docs: https://github.com/ondrejbartas/sidekiq-cron#adding-cron-job
+###!       https://docs.gitlab.com/ce/ci/yaml/README.html#artifacts:expire_in
+# gitlab_rails['stuck_ci_jobs_worker_cron'] = "0 0 * * *"
+# gitlab_rails['expire_build_artifacts_worker_cron'] = "50 * * * *"
+# gitlab_rails['pipeline_schedule_worker_cron'] = "41 * * * *"
+# gitlab_rails['repository_check_worker_cron'] = "20 * * * *"
+# gitlab_rails['admin_email_worker_cron'] = "0 0 * * 0"
+# gitlab_rails['repository_archive_cache_worker_cron'] = "0 * * * *"
+
+### Webhook Settings
+###! Number of seconds to wait for HTTP response after sending webhook HTTP POST
+###! request (default: 10)
+# gitlab_rails['webhook_timeout'] = 10
+
+### Trusted proxies
+###! Customize if you have GitLab behind a reverse proxy which is running on a
+###! different machine.
+###! **Add the IP address for your reverse proxy to the list, otherwise users
+###!   will appear signed in from that address.**
+# gitlab_rails['trusted_proxies'] = []
+
+### Monitoring settings
+###! IP whitelist controlling access to monitoring endpoints
+# gitlab_rails['monitoring_whitelist'] = ['127.0.0.0/8']
+###! Time between sampling of unicorn socket metrics, in seconds
+# gitlab_rails['monitoring_unicorn_sampler_interval'] = 10
+
+### Reply by email
+###! Allow users to comment on issues and merge requests by replying to
+###! notification emails.
+###! Docs: https://docs.gitlab.com/ce/administration/reply_by_email.html
+# gitlab_rails['incoming_email_enabled'] = true
+
+#### Incoming Email Address
+####! The email address including the `%{key}` placeholder that will be replaced
+####! to reference the item being replied to.
+####! **The placeholder can be omitted but if present, it must appear in the
+####!   "user" part of the address (before the `@`).**
+# gitlab_rails['incoming_email_address'] = "gitlab-incoming+%{key}@gmail.com"
+
+#### Email account username
+####! **With third party providers, this is usually the full email address.**
+####! **With self-hosted email servers, this is usually the user part of the
+####!   email address.**
+# gitlab_rails['incoming_email_email'] = "gitlab-incoming@gmail.com"
+
+#### Email account password
+# gitlab_rails['incoming_email_password'] = "[REDACTED]"
+
+#### IMAP Settings
+# gitlab_rails['incoming_email_host'] = "imap.gmail.com"
+# gitlab_rails['incoming_email_port'] = 993
+# gitlab_rails['incoming_email_ssl'] = true
+# gitlab_rails['incoming_email_start_tls'] = false
+
+#### Incoming Mailbox Settings
+####! The mailbox where incoming mail will end up. Usually "inbox".
+# gitlab_rails['incoming_email_mailbox_name'] = "inbox"
+####! The IDLE command timeout.
+# gitlab_rails['incoming_email_idle_timeout'] = 60
+
+### Job Artifacts
+# gitlab_rails['artifacts_enabled'] = true
+# gitlab_rails['artifacts_path'] = "/mnt/storage/artifacts"
+# gitlab_rails['artifacts_object_store_enabled'] = false # EE only
+# gitlab_rails['artifacts_object_store_remote_directory'] = "artifacts"
+# gitlab_rails['artifacts_object_store_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AWS_ACCESS_KEY_ID',
+#   'aws_secret_access_key' => 'AWS_SECRET_ACCESS_KEY',
+#   # # The below options configure an S3 compatible host instead of AWS
+#   # 'host' => 's3.amazonaws.com',
+#   # 'endpoint' => nil,
+#   # 'path_style' => false # Use 'host/bucket_name/object' instead of 'bucket_name.host/object'
+# }
+
+### Git LFS
+# gitlab_rails['lfs_enabled'] = true
+# gitlab_rails['lfs_storage_path'] = "/mnt/storage/lfs-objects"
+# gitlab_rails['lfs_object_store_enabled'] = false # EE only
+# gitlab_rails['lfs_object_store_background_upload'] = true
+# gitlab_rails['lfs_object_store_remote_directory'] = "lfs-objects"
+# gitlab_rails['lfs_object_store_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AWS_ACCESS_KEY_ID',
+#   'aws_secret_access_key' => 'AWS_SECRET_ACCESS_KEY',
+#   # # The below options configure an S3 compatible host instead of AWS
+#   # 'host' => 's3.amazonaws.com',
+#   # 'endpoint' => nil,
+#   # 'path_style' => false # Use 'host/bucket_name/object' instead of 'bucket_name.host/object'
+# }
+
+### Usage Statistics
+# gitlab_rails['usage_ping_enabled'] = true
+
+### GitLab Mattermost
+###! These settings are void if Mattermost is installed on the same omnibus
+###! install
+# gitlab_rails['mattermost_host'] = "https://mattermost.example.com"
+
+### LDAP Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html
+###! **Be careful not to break the indentation in the ldap_servers block. It is
+###!   in yaml format and the spaces must be retained. Using tabs will not work.**
+
+gitlab_rails['ldap_enabled'] = true
+
+###! **remember to close this block with 'EOS' below**
+gitlab_rails['ldap_servers'] = YAML.load <<-'EOS'
+  main: # 'main' is the GitLab 'provider ID' of this LDAP server
+    label: 'NovaTech'
+    host: '{{ openldap_hostname }}'
+    port: 389
+    uid: 'uid'
+    bind_dn: 'cn=proxyagent,dc=novatech'
+    password: '{{ gitlab_email_password }}'
+    encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+    verify_certificates: true
+    ca_file: ''
+    ssl_version: ''
+    active_directory: false
+    allow_username_or_email_login: true
+    block_auto_created_users: false
+    base: 'ou=user,dc=novatech'
+    user_filter: '(employeeType=gitlab)'
+    attributes:
+      username: ['uid', 'userid', 'sAMAccountName']
+      email:    ['mail', 'email', 'userPrincipalName']
+      name:       'cn'
+      first_name: 'givenName'
+      last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+#
+#   secondary: # 'secondary' is the GitLab 'provider ID' of second LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+#     verify_certificates: true
+#     ca_file: ''
+#     ssl_version: ''
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+EOS
+
+### OmniAuth Settings
+###! Docs: https://docs.gitlab.com/ce/integration/omniauth.html
+# gitlab_rails['omniauth_enabled'] = false
+# gitlab_rails['omniauth_allow_single_sign_on'] = ['saml']
+# gitlab_rails['omniauth_sync_email_from_provider'] = 'saml'
+# gitlab_rails['omniauth_sync_profile_from_provider'] = ['saml']
+# gitlab_rails['omniauth_sync_profile_attributes'] = ['email']
+# gitlab_rails['omniauth_auto_sign_in_with_provider'] = 'saml'
+# gitlab_rails['omniauth_block_auto_created_users'] = true
+# gitlab_rails['omniauth_auto_link_ldap_user'] = false
+# gitlab_rails['omniauth_auto_link_saml_user'] = false
+# gitlab_rails['omniauth_external_providers'] = ['twitter', 'google_oauth2']
+# gitlab_rails['omniauth_providers'] = [
+#   {
+#     "name" => "google_oauth2",
+#     "app_id" => "YOUR APP ID",
+#     "app_secret" => "YOUR APP SECRET",
+#     "args" => { "access_type" => "offline", "approval_prompt" => "" }
+#   }
+# ]
+
+### Backup Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/backups.html
+
+# gitlab_rails['manage_backup_path'] = true
+gitlab_rails['backup_path'] = "/mnt/backups"
+
+###! Docs: https://docs.gitlab.com/ce/raketasks/backup_restore.html#backup-archive-permissions
+gitlab_rails['backup_archive_permissions'] = 0644
+
+gitlab_rails['backup_pg_schema'] = 'public'
+
+###! The duration in seconds to keep backups before they are allowed to be deleted
+gitlab_rails['backup_keep_time'] = 604800
+
+gitlab_rails['backup_upload_connection'] = {
+  :provider => 'Local',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AKIAKIAKI',
+#   'aws_secret_access_key' => 'secret123'
+:local_root => '/mnt/backups'
+}
+gitlab_rails['backup_upload_remote_directory'] = '.'
+# gitlab_rails['backup_multipart_chunk_size'] = 104857600
+
+###! **Turns on AWS Server-Side Encryption with Amazon S3-Managed Keys for
+###!   backups**
+# gitlab_rails['backup_encryption'] = 'AES256'
+
+###! **Specifies Amazon S3 storage class to use for backups. Valid values
+###!   include 'STANDARD', 'STANDARD_IA', 'GLACIER', and
+###!   'REDUCED_REDUNDANCY'**
+# gitlab_rails['backup_storage_class'] = 'STANDARD'
+
+### For setting up different data storing directory
+###! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#storing-git-data-in-an-alternative-directory
+###! **If you want to use a single non-default directory to store git data use a
+###!   path that doesn't contain symlinks.**
+# git_data_dirs({
+#   "default" => {
+#     "path" => "/mnt/nfs-01/git-data",
+#     "failure_count_threshold" => 10,
+#     "failure_wait_time" => 30,
+#     "failure_reset_time" => 1800,
+#     "storage_timeout" => 30
+#    }
+# })
+
+### Gitaly settings
+# gitlab_rails['gitaly_token'] = 'secret token'
+
+### For storing GitLab application uploads, eg. LFS objects, build artifacts
+###! Docs: https://docs.gitlab.com/ce/development/shared_files.html
+# gitlab_rails['shared_path'] = '/var/opt/gitlab/gitlab-rails/shared'
+
+### GitLab Shell settings for GitLab
+# gitlab_rails['gitlab_shell_ssh_port'] = 22
+# gitlab_rails['gitlab_shell_git_timeout'] = 800
+
+### Extra customization
+# gitlab_rails['extra_google_analytics_id'] = '_your_tracking_id'
+# gitlab_rails['extra_piwik_url'] = '_your_piwik_url'
+# gitlab_rails['extra_piwik_site_id'] = '_your_piwik_site_id'
+
+##! Docs: https://docs.gitlab.com/omnibus/settings/environment-variables.html
+# gitlab_rails['env'] = {
+#   'BUNDLE_GEMFILE' => "/opt/gitlab/embedded/service/gitlab-rails/Gemfile",
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+# gitlab_rails['rack_attack_git_basic_auth'] = {
+#   'enabled' => true,
+#   'ip_whitelist' => ["127.0.0.1"],
+#   'maxretry' => 10,
+#   'findtime' => 60,
+#   'bantime' => 3600
+# }
+
+# gitlab_rails['rack_attack_protected_paths'] = [
+#   '/users/password',
+#   '/users/sign_in',
+#   '/api/#{API::API.version}/session.json',
+#   '/api/#{API::API.version}/session',
+#   '/users',
+#   '/users/confirmation',
+#   '/unsubscribes/',
+#   '/import/github/personal_access_token'
+# ]
+
+###! **We do not recommend changing these directories.**
+# gitlab_rails['dir'] = "/var/opt/gitlab/gitlab-rails"
+# gitlab_rails['log_directory'] = "/var/log/gitlab/gitlab-rails"
+
+### GitLab application settings
+# gitlab_rails['uploads_directory'] = "/var/opt/gitlab/gitlab-rails/uploads"
+# gitlab_rails['rate_limit_requests_per_period'] = 10
+# gitlab_rails['rate_limit_period'] = 60
+
+#### Change the initial default admin password and shared runner registraion tokens.
+####! **Only applicable on initial setup, changing these settings after database
+####!   is created and seeded won't yield any change.**
+gitlab_rails['initial_root_password'] = "{{ gitlab_root_password }}"
+# gitlab_rails['initial_shared_runners_registration_token'] = "token"
+
+#### Enable or disable automatic database migrations
+# gitlab_rails['auto_migrate'] = true
+
+#### This is advanced feature used by large gitlab deployments where loading
+#### whole RAILS env takes a lot of time.
+# gitlab_rails['rake_cache_clear'] = true
+
+### GitLab database settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/database.html
+###! **Only needed if you use an external database.**
+# gitlab_rails['db_adapter'] = "postgresql"
+# gitlab_rails['db_encoding'] = "unicode"
+# gitlab_rails['db_collation'] = nil
+# gitlab_rails['db_database'] = "gitlabhq_production"
+# gitlab_rails['db_pool'] = 10
+# gitlab_rails['db_username'] = "gitlab"
+# gitlab_rails['db_password'] = nil
+# gitlab_rails['db_host'] = nil
+# gitlab_rails['db_port'] = 5432
+# gitlab_rails['db_socket'] = nil
+# gitlab_rails['db_sslmode'] = nil
+# gitlab_rails['db_sslrootcert'] = nil
+# gitlab_rails['db_prepared_statements'] = true
+# gitlab_rails['db_statements_limit'] = 1000
+
+
+### GitLab Redis settings
+###! Connect to your own Redis instance
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+
+#### Redis TCP connection
+# gitlab_rails['redis_host'] = "127.0.0.1"
+# gitlab_rails['redis_port'] = 6379
+# gitlab_rails['redis_password'] = nil
+# gitlab_rails['redis_database'] = 0
+
+#### Redis local UNIX socket (will be disabled if TCP method is used)
+# gitlab_rails['redis_socket'] = "/var/opt/gitlab/redis/redis.socket"
+
+#### Sentinel support
+####! To have Sentinel working, you must enable Redis TCP connection support
+####! above and define a few Sentinel hosts below (to get a reliable setup
+####! at least 3 hosts).
+####! **You don't need to list every sentinel host, but the ones not listed will
+####!   not be used in a fail-over situation to query for the new master.**
+# gitlab_rails['redis_sentinels'] = [
+#   {'host' => '127.0.0.1', 'port' => 26379},
+# ]
+
+### GitLab email server settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html
+###! **Use smtp instead of sendmail/postfix.**
+
+gitlab_rails['smtp_enable'] = true
+gitlab_rails['smtp_address'] = "{{ exim4_hostname }}"
+gitlab_rails['smtp_port'] = 465
+gitlab_rails['smtp_user_name'] = "gitlab"
+gitlab_rails['smtp_password'] = "{{ gitlab_email_password }}"
+gitlab_rails['smtp_domain'] = "novatech-llc.com"
+gitlab_rails['smtp_authentication'] = "login"
+gitlab_rails['smtp_enable_starttls_auto'] = true
+gitlab_rails['smtp_tls'] = true
+
+###! **Can be: 'none', 'peer', 'client_once', 'fail_if_no_peer_cert'**
+###! Docs: http://api.rubyonrails.org/classes/ActionMailer/Base.html
+# gitlab_rails['smtp_openssl_verify_mode'] = 'none'
+
+# gitlab_rails['smtp_ca_path'] = "/etc/ssl/certs"
+# gitlab_rails['smtp_ca_file'] = "/etc/ssl/certs/ca-certificates.crt"
+
+################################################################################
+## Container Registry settings
+##! Docs: https://docs.gitlab.com/ce/administration/container_registry.html
+################################################################################
+
+# registry_external_url 'https://registry.gitlab.example.com'
+
+### Settings used by GitLab application
+# gitlab_rails['registry_enabled'] = true
+# gitlab_rails['registry_host'] = "registry.gitlab.example.com"
+# gitlab_rails['registry_port'] = "5005"
+# gitlab_rails['registry_path'] = "/var/opt/gitlab/gitlab-rails/shared/registry"
+
+###! **Do not change the following 3 settings unless you know what you are
+###!   doing**
+# gitlab_rails['registry_api_url'] = "http://localhost:5000"
+# gitlab_rails['registry_key_path'] = "/var/opt/gitlab/gitlab-rails/certificate.key"
+# gitlab_rails['registry_issuer'] = "omnibus-gitlab-issuer"
+
+### Settings used by Registry application
+# registry['enable'] = true
+# registry['username'] = "registry"
+# registry['group'] = "registry"
+# registry['uid'] = nil
+# registry['gid'] = nil
+# registry['dir'] = "/var/opt/gitlab/registry"
+# registry['registry_http_addr'] = "localhost:5000"
+# registry['debug_addr'] = "localhost:5001"
+# registry['log_directory'] = "/var/log/gitlab/registry"
+# registry['log_level'] = "info"
+# registry['rootcertbundle'] = "/var/opt/gitlab/registry/certificate.crt"
+# registry['storage_delete_enabled'] = true
+
+### Registry backend storage
+###! Docs: https://docs.gitlab.com/ce/administration/container_registry.html#container-registry-storage-driver
+# registry['storage'] = {
+#   's3' => {
+#     'accesskey' => 'AKIAKIAKI',
+#     'secretkey' => 'secret123',
+#     'bucket' => 'gitlab-registry-bucket-AKIAKIAKI'
+#   }
+# }
+
+### Registry notifications endpoints
+# registry['notifications'] = [
+#   {
+#     'name' => 'test_endpoint',
+#     'url' => 'https://gitlab.example.com/notify2',
+#     'timeout' => '500ms',
+#     'threshold' => 5,
+#     'backoff' => '1s',
+#     'headers' => {
+#       "Authorization" => ["AUTHORIZATION_EXAMPLE_TOKEN"]
+#     }
+#   }
+# ]
+### Default registry notifications
+# registry['default_notifications_timeout'] = "500ms"
+# registry['default_notifications_threshold'] = 5
+# registry['default_notifications_backoff'] = "1s"
+# registry['default_notifications_headers'] = {}
+
+
+
+################################################################################
+## GitLab Workhorse
+##! Docs: https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/README.md
+################################################################################
+
+# gitlab_workhorse['enable'] = true
+# gitlab_workhorse['ha'] = false
+# gitlab_workhorse['listen_network'] = "unix"
+# gitlab_workhorse['listen_umask'] = 000
+# gitlab_workhorse['listen_addr'] = "/var/opt/gitlab/gitlab-workhorse/socket"
+# gitlab_workhorse['auth_backend'] = "http://localhost:8080"
+
+##! the empty string is the default in gitlab-workhorse option parser
+# gitlab_workhorse['auth_socket'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['pprof_listen_addr'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['prometheus_listen_addr'] = "''"
+
+# gitlab_workhorse['dir'] = "/var/opt/gitlab/gitlab-workhorse"
+# gitlab_workhorse['log_directory'] = "/var/log/gitlab/gitlab-workhorse"
+# gitlab_workhorse['proxy_headers_timeout'] = "1m0s"
+
+##! limit number of concurrent API requests, defaults to 0 which is unlimited
+# gitlab_workhorse['api_limit'] = 0
+
+##! limit number of API requests allowed to be queued, defaults to 0 which
+##! disables queuing
+# gitlab_workhorse['api_queue_limit'] = 0
+
+##! duration after which we timeout requests if they sit too long in the queue
+# gitlab_workhorse['api_queue_duration'] = "30s"
+
+##! Long polling duration for job requesting for runners
+# gitlab_workhorse['api_ci_long_polling_duration'] = "60s"
+
+# gitlab_workhorse['env'] = {
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+################################################################################
+## GitLab User Settings
+##! Modify default git user.
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#changing-the-name-of-the-git-user-group
+################################################################################
+
+# user['username'] = "git"
+# user['group'] = "git"
+# user['uid'] = nil
+# user['gid'] = nil
+
+##! The shell for the git user
+# user['shell'] = "/bin/sh"
+
+##! The home directory for the git user
+# user['home'] = "/var/opt/gitlab"
+
+# user['git_user_name'] = "GitLab"
+# user['git_user_email'] = "gitlab@#{node['fqdn']}"
+
+################################################################################
+## GitLab Unicorn
+##! Tweak unicorn settings.
+##! Docs: https://docs.gitlab.com/omnibus/settings/unicorn.html
+################################################################################
+
+# unicorn['worker_timeout'] = 60
+###! Minimum worker_processes is 2 at this moment
+###! See https://gitlab.com/gitlab-org/gitlab-ce/issues/18771
+# unicorn['worker_processes'] = 2
+
+### Advanced settings
+# unicorn['listen'] = '127.0.0.1'
+# unicorn['port'] = 8080
+# unicorn['socket'] = '/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket'
+# unicorn['pidfile'] = '/opt/gitlab/var/unicorn/unicorn.pid'
+# unicorn['tcp_nopush'] = true
+# unicorn['backlog_socket'] = 1024
+
+###! **Make sure somaxconn is equal or higher then backlog_socket**
+# unicorn['somaxconn'] = 1024
+
+###! **We do not recommend changing this setting**
+# unicorn['log_directory'] = "/var/log/gitlab/unicorn"
+
+### **Only change these settings if you understand well what they mean**
+###! Docs: https://about.gitlab.com/2015/06/05/how-gitlab-uses-unicorn-and-unicorn-worker-killer/
+###!       https://github.com/kzk/unicorn-worker-killer
+# unicorn['worker_memory_limit_min'] = "400 * 1 << 20"
+# unicorn['worker_memory_limit_max'] = "650 * 1 << 20"
+
+################################################################################
+## GitLab Sidekiq
+################################################################################
+
+# sidekiq['log_directory'] = "/var/log/gitlab/sidekiq"
+# sidekiq['shutdown_timeout'] = 4
+# sidekiq['concurrency'] = 25
+
+################################################################################
+## gitlab-shell
+################################################################################
+
+# gitlab_shell['audit_usernames'] = false
+# gitlab_shell['log_level'] = 'INFO'
+# gitlab_shell['http_settings'] = { user: 'username', password: 'password', ca_file: '/etc/ssl/cert.pem', ca_path: '/etc/pki/tls/certs', self_signed_cert: false}
+# gitlab_shell['log_directory'] = "/var/log/gitlab/gitlab-shell/"
+# gitlab_shell['custom_hooks_dir'] = "/opt/gitlab/embedded/service/gitlab-shell/hooks"
+
+# gitlab_shell['auth_file'] = "/var/opt/gitlab/.ssh/authorized_keys"
+
+### Git trace log file.
+###! If set, git commands receive GIT_TRACE* environment variables
+###! Docs: https://git-scm.com/book/es/v2/Git-Internals-Environment-Variables#Debugging
+###! An absolute path starting with /  the trace output will be appended to
+###! that file. It needs to exist so we can check permissions and avoid
+###! throwing warnings to the users.
+# gitlab_shell['git_trace_log_file'] = "/var/log/gitlab/gitlab-shell/gitlab-shell-git-trace.log"
+
+##! **We do not recommend changing this directory.**
+# gitlab_shell['dir'] = "/var/opt/gitlab/gitlab-shell"
+
+################################################################
+## GitLab PostgreSQL
+################################################################
+
+###! Changing any of these settings requires a restart of postgresql.
+###! By default, reconfigure reloads postgresql if it is running. If you
+###! change any of these settings, be sure to run `gitlab-ctl restart postgresql`
+###! after reconfigure in order for the changes to take effect.
+# postgresql['enable'] = true
+# postgresql['listen_address'] = nil
+# postgresql['port'] = 5432
+# postgresql['data_dir'] = "/var/opt/gitlab/postgresql/data"
+
+##! **recommend value is 1/4 of total RAM, up to 14GB.**
+# postgresql['shared_buffers'] = "256MB"
+
+### Advanced settings
+# postgresql['ha'] = false
+# postgresql['dir'] = "/var/opt/gitlab/postgresql"
+# postgresql['log_directory'] = "/var/log/gitlab/postgresql"
+# postgresql['username'] = "gitlab-psql"
+# postgresql['uid'] = nil
+# postgresql['gid'] = nil
+# postgresql['shell'] = "/bin/sh"
+# postgresql['home'] = "/var/opt/gitlab/postgresql"
+# postgresql['user_path'] = "/opt/gitlab/embedded/bin:/opt/gitlab/bin:$PATH"
+# postgresql['sql_user'] = "gitlab"
+# postgresql['max_connections'] = 200
+# postgresql['md5_auth_cidr_addresses'] = []
+# postgresql['trust_auth_cidr_addresses'] = []
+# postgresql['wal_buffers'] = "-1"
+# postgresql['autovacuum_max_workers'] = "3"
+# postgresql['autovacuum_freeze_max_age'] = "200000000"
+# postgresql['track_activity_query_size'] = "1024"
+# postgresql['shared_preload_libraries'] = nil
+# postgresql['dynamic_shared_memory_type'] = nil
+# postgresql['hot_standby'] = "off"
+
+### Replication settings
+###! Note, some replication settings do not require a full restart. They are documented below.
+# postgresql['wal_level'] = "hot_standby"
+# postgresql['max_wal_senders'] = 5
+# postgresql['max_replication_slots'] = 0
+# postgresql['max_locks_per_transaction'] = 128
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_mode'] = "off"
+
+###! Changing any of these settings only requires a reload of postgresql. You do not need to
+###! restart postgresql if you change any of these and run reconfigure.
+# postgresql['work_mem'] = "16MB"
+# postgresql['maintenance_work_mem'] = "16MB"
+# postgresql['checkpoint_segments'] = 10
+# postgresql['checkpoint_timeout'] = "5min"
+# postgresql['checkpoint_completion_target'] = 0.9
+# postgresql['effective_io_concurrency'] = 1
+# postgresql['checkpoint_warning'] = "30s"
+# postgresql['effective_cache_size'] = "1MB"
+# postgresql['shmmax'] =  17179869184 # or 4294967295
+# postgresql['shmall'] =  4194304 # or 1048575
+# postgresql['autovacuum'] = "on"
+# postgresql['log_autovacuum_min_duration'] = "-1"
+# postgresql['autovacuum_naptime'] = "1min"
+# postgresql['autovacuum_vacuum_threshold'] = "50"
+# postgresql['autovacuum_analyze_threshold'] = "50"
+# postgresql['autovacuum_vacuum_scale_factor'] = "0.02"
+# postgresql['autovacuum_analyze_scale_factor'] = "0.01"
+# postgresql['autovacuum_vacuum_cost_delay'] = "20ms"
+# postgresql['autovacuum_vacuum_cost_limit'] = "-1"
+# postgresql['statement_timeout'] = "60000"
+# postgresql['idle_in_transaction_session_timeout'] = "60000"
+# postgresql['log_line_prefix'] = "%a"
+# postgresql['max_worker_processes'] = 8
+# postgreslq['max_parallel_workers_per_gather'] = 0
+# postgresql['log_lock_waits'] = 1
+# postgresql['deadlock_timeout'] = '5s'
+# postgresql['track_io_timing'] = 0
+
+### Available in PostgreSQL 9.6 and later
+# postgresql['min_wal_size'] = 80MB
+# postgresql['max_wal_size'] = 1GB
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_command'] = nil
+# default['gitlab']['postgresql']['archive_timeout'] = "60"
+
+### Replication settings
+# postgresql['sql_replication_user'] = "gitlab_replicator"
+# postgresql['wal_keep_segments'] = 10
+# postgresql['max_standby_archive_delay'] = "30s"
+# postgresql['max_standby_streaming_delay'] = "30s"
+# postgresql['synchronous_commit'] = on
+# postgresql['synchronous_standby_names'] = ''
+# postgresql['hot_standby_feedback'] = 'off'
+# postgresql['random_page_cost'] = 2.0
+# postgresql['log_temp_files'] = -1
+# postgresql['log_checkpoints'] = 'off'
+# To add custom entries to pg_hba.conf use the following
+# postgresql['custom_pg_hba_entries'] = {
+#   APPLICATION: { # APPLICATION should identify what the settings are used for
+#     type: example,
+#     database: example,
+#     user: example,
+#     cidr: example,
+#     method: example,
+#     option: exmple
+#   }
+# }
+# See https://www.postgresql.org/docs/9.6/static/auth-pg-hba-conf.html for an explanation
+# of the values
+
+
+################################################################################
+## GitLab Redis
+##! **Can be disabled if you are using your own Redis instance.**
+##! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+################################################################################
+
+# redis['enable'] = true
+# redis['username'] = "gitlab-redis"
+# redis['maxclients'] = "10000"
+# redis['tcp_timeout'] = "60"
+# redis['tcp_keepalive'] = "300"
+# redis['uid'] = nil
+# redis['gid'] = nil
+
+###! **To enable only Redis service in this machine, uncomment
+###!   one of the lines below (choose master or slave instance types).**
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+###!       https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_master_role['enable'] = true
+# redis_slave_role['enable'] = true
+
+### Redis TCP support (will disable UNIX socket transport)
+# redis['bind'] = '0.0.0.0' # or specify an IP to bind to a single one
+# redis['port'] = 6379
+# redis['password'] = 'redis-password-goes-here'
+
+### Redis Sentinel support
+###! **You need a master slave Redis replication to be able to do failover**
+###! **Please read the documentation before enabling it to understand the
+###!   caveats:**
+###! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+
+### Replication support
+#### Slave Redis instance
+# redis['master'] = false # by default this is true
+
+#### Slave and Sentinel shared configuration
+####! **Both need to point to the master Redis instance to get replication and
+####!   heartbeat monitoring**
+# redis['master_name'] = 'gitlab-redis'
+# redis['master_ip'] = nil
+# redis['master_port'] = 6379
+
+####! **Master password should have the same value defined in
+####!   redis['password'] to enable the instance to transition to/from
+####!   master/slave in a failover event.**
+# redis['master_password'] = 'redis-password-goes-here'
+
+####! Increase these values when your slaves can't catch up with master
+# redis['client_output_buffer_limit_normal'] = '0 0 0'
+# redis['client_output_buffer_limit_slave'] = '256mb 64mb 60'
+# redis['client_output_buffer_limit_pubsub'] = '32mb 8mb 60'
+
+#####! Redis snapshotting frequency
+#####! Set to [] to disable
+#####! Set to [''] to clear previously set values
+# redis['save'] = [ '900 1', '300 10', '60 10000' ]
+
+################################################################################
+## GitLab Web server
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#using-a-non-bundled-web-server
+################################################################################
+
+##! When bundled nginx is disabled we need to add the external webserver user to
+##! the GitLab webserver group.
+# web_server['external_users'] = []
+# web_server['username'] = 'gitlab-www'
+# web_server['group'] = 'gitlab-www'
+# web_server['uid'] = nil
+# web_server['gid'] = nil
+# web_server['shell'] = '/bin/false'
+# web_server['home'] = '/var/opt/gitlab/nginx'
+
+################################################################################
+## GitLab NGINX
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html
+################################################################################
+
+nginx['enable'] = true
+# nginx['client_max_body_size'] = '250m'
+nginx['redirect_http_to_https'] = true
+# nginx['redirect_http_to_https_port'] = 80
+
+##! Most root CA's are included by default
+# nginx['ssl_client_certificate'] = "/etc/gitlab/ssl/ca.crt"
+
+##! enable/disable 2-way SSL client authentication
+# nginx['ssl_verify_client'] = "off"
+
+##! if ssl_verify_client on, verification depth in the client certificates chain
+# nginx['ssl_verify_depth'] = "1"
+
+nginx['ssl_certificate'] = "/etc/ssl/private/nginx.crt"
+nginx['ssl_certificate_key'] = "/etc/ssl/private/nginx.key"
+# nginx['ssl_ciphers'] = "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"
+# nginx['ssl_prefer_server_ciphers'] = "on"
+
+##! **Recommended by: https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html
+##!                   https://cipherli.st/**
+# nginx['ssl_protocols'] = "TLSv1.1 TLSv1.2"
+
+##! **Recommended in: https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_cache'] = "builtin:1000  shared:SSL:10m"
+
+##! **Default according to https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_timeout'] = "5m"
+
+nginx['ssl_dhparam'] = "/etc/ssl/private/dhparam.pem" # Path to dhparams.pem, eg. /etc/gitlab/ssl/dhparams.pem
+# nginx['listen_addresses'] = ['*', '[::]']
+
+##! **Defaults to forcing web browsers to always communicate using only HTTPS**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-http-strict-transport-security
+# nginx['hsts_max_age'] = 31536000
+# nginx['hsts_include_subdomains'] = false
+
+##! **Override only if you use a reverse proxy**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-the-nginx-listen-port
+nginx['listen_port'] = 443
+
+##! **Override only if your reverse proxy internally communicates over HTTP**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#supporting-proxied-ssl
+# nginx['listen_https'] = nil
+
+# nginx['custom_gitlab_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# nginx['custom_nginx_config'] = "include /etc/nginx/conf.d/example.conf;"
+# nginx['proxy_read_timeout'] = 3600
+# nginx['proxy_connect_timeout'] = 300
+# nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host_with_default",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on",
+#  "Upgrade" => "$http_upgrade",
+#  "Connection" => "$connection_upgrade"
+# }
+# nginx['proxy_cache_path'] = 'proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2'
+# nginx['proxy_cache'] = 'gitlab'
+# nginx['http2_enabled'] = true
+# nginx['real_ip_trusted_addresses'] = []
+# nginx['real_ip_header'] = nil
+# nginx['real_ip_recursive'] = nil
+# nginx['custom_error_pages'] = {
+#   '404' => {
+#     'title' => 'Example title',
+#     'header' => 'Example header',
+#     'message' => 'Example message'
+#   }
+# }
+
+### Advanced settings
+# nginx['dir'] = "/var/opt/gitlab/nginx"
+# nginx['log_directory'] = "/var/log/gitlab/nginx"
+# nginx['worker_processes'] = 4
+# nginx['worker_connections'] = 10240
+# nginx['log_format'] = '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"'
+# nginx['sendfile'] = 'on'
+# nginx['tcp_nopush'] = 'on'
+# nginx['tcp_nodelay'] = 'on'
+# nginx['gzip'] = "on"
+# nginx['gzip_http_version'] = "1.0"
+# nginx['gzip_comp_level'] = "2"
+# nginx['gzip_proxied'] = "any"
+# nginx['gzip_types'] = [ "text/plain", "text/css", "application/x-javascript", "text/xml", "application/xml", "application/xml+rss", "text/javascript", "application/json" ]
+# nginx['keepalive_timeout'] = 65
+# nginx['cache_max_size'] = '5000m'
+# nginx['server_names_hash_bucket_size'] = 64
+
+### Nginx status
+# nginx['status'] = {
+#  "enable" => true,
+#  "listen_addresses" => ["127.0.0.1"],
+#  "fqdn" => "dev.example.com",
+#  "port" => 9999,
+#  "options" => {
+#    "stub_status" => "on", # Turn on stats
+#    "server_tokens" => "off", # Don't show the version of NGINX
+#    "access_log" => "off", # Disable logs for stats
+#    "allow" => "127.0.0.1", # Only allow access from localhost
+#    "deny" => "all" # Deny access to anyone else
+#  }
+# }
+
+################################################################################
+## GitLab Logging
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html
+################################################################################
+
+# logging['svlogd_size'] = 200 * 1024 * 1024 # rotate after 200 MB of log data
+# logging['svlogd_num'] = 30 # keep 30 rotated log files
+# logging['svlogd_timeout'] = 24 * 60 * 60 # rotate after 24 hours
+# logging['svlogd_filter'] = "gzip" # compress logs with gzip
+# logging['svlogd_udp'] = nil # transmit log messages via UDP
+# logging['svlogd_prefix'] = nil # custom prefix for log messages
+# logging['logrotate_frequency'] = "daily" # rotate logs daily
+# logging['logrotate_size'] = nil # do not rotate by size by default
+# logging['logrotate_rotate'] = 30 # keep 30 rotated logs
+# logging['logrotate_compress'] = "compress" # see 'man logrotate'
+# logging['logrotate_method'] = "copytruncate" # see 'man logrotate'
+# logging['logrotate_postrotate'] = nil # no postrotate command by default
+# logging['logrotate_dateformat'] = nil # use date extensions for rotated files rather than numbers e.g. a value of "-%Y-%m-%d" would give rotated files like production.log-2016-03-09.gz
+
+### UDP log forwarding
+##! Docs: http://docs.gitlab.com/omnibus/settings/logs.html#udp-log-forwarding
+
+##! remote host to ship log messages to via UDP
+# logging['udp_log_shipping_host'] = nil
+
+##! override the hostname used when logs are shipped via UDP,
+##  by default the system hostname will be used.
+# logging['udp_log_shipping_hostname'] = nil
+
+##! remote port to ship log messages to via UDP
+# logging['udp_log_shipping_port'] = 514
+
+################################################################################
+## Logrotate
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html#logrotate
+##! You can disable built in logrotate feature.
+################################################################################
+# logrotate['enable'] = true
+
+################################################################################
+## Users and groups accounts
+##! Disable management of users and groups accounts.
+##! **Set only if creating accounts manually**
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-user-and-group-account-management
+################################################################################
+
+# manage_accounts['enable'] = false
+
+################################################################################
+## Storage directories
+##! Disable managing storage directories
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-storage-directories-management
+################################################################################
+
+##! **Set only if the select directories are created manually**
+# manage_storage_directories['enable'] = false
+# manage_storage_directories['manage_etc'] = false
+
+################################################################################
+## Runtime directory
+##! Docs: https://docs.gitlab.com//omnibus/settings/configuration.html#configuring-runtime-directory
+################################################################################
+
+# runtime_dir '/run'
+
+################################################################################
+## Git
+##! Advanced setting for configuring git system settings for omnibus-gitlab
+##! internal git
+################################################################################
+
+##! For multiple options under one header use array of comma separated values,
+##! eg.:
+##! { "receive" => ["fsckObjects = true"], "alias" => ["st = status", "co = checkout"] }
+
+# omnibus_gitconfig['system'] = {
+#  "pack" => ["threads = 1"],
+#  "receive" => ["fsckObjects = true"],
+#  "repack" => ["writeBitmaps = true"],
+#  "transfer" => ["hideRefs=^refs/tmp/", "hideRefs=^refs/keep-around/"],
+# }
+
+################################################################################
+## GitLab Pages
+##! Docs: https://docs.gitlab.com/ce/pages/administration.html
+################################################################################
+
+##! Define to enable GitLab Pages
+# pages_external_url "http://pages.example.com/"
+# gitlab_pages['enable'] = false
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTP
+# gitlab_pages['external_http'] = []
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTPS
+# gitlab_pages['external_https'] = []
+
+# gitlab_pages['listen_proxy'] = "localhost:8090"
+# gitlab_pages['redirect_http'] = true
+# gitlab_pages['use_http2'] = true
+# gitlab_pages['dir'] = "/var/opt/gitlab/gitlab-pages"
+# gitlab_pages['log_directory'] = "/var/log/gitlab/gitlab-pages"
+
+# gitlab_pages['artifacts_server'] = true
+# gitlab_pages['artifacts_server_url'] = nil # Defaults to external_url + '/api/v4'
+# gitlab_pages['artifacts_server_timeout'] = 10
+
+##! Prometheus metrics for Pages docs: https://gitlab.com/gitlab-org/gitlab-pages/#enable-prometheus-metrics
+# gitlab_pages['metrics_address'] = ":9235"
+
+################################################################################
+## GitLab Pages NGINX
+################################################################################
+
+# All the settings defined in the "GitLab Nginx" section are also available in this "GitLab Pages NGINX" section
+# You just have to change the key "nginx['some_settings']" with "pages_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "GitLab Pages NGINX"
+# pages_nginx['enable'] = false
+
+# gitlab_rails['pages_path'] = "/mnt/storage/pages"
+
+################################################################################
+## GitLab CI
+##! Docs: https://docs.gitlab.com/ce/ci/quick_start/README.html
+################################################################################
+
+# gitlab_ci['gitlab_ci_all_broken_builds'] = true
+# gitlab_ci['gitlab_ci_add_pusher'] = true
+# gitlab_ci['builds_directory'] = '/var/opt/gitlab/gitlab-ci/builds'
+
+################################################################################
+## GitLab Mattermost
+##! Docs: https://docs.gitlab.com/omnibus/gitlab-mattermost
+################################################################################
+
+# mattermost_external_url 'http://mattermost.example.com'
+
+# mattermost['enable'] = false
+# mattermost['username'] = 'mattermost'
+# mattermost['group'] = 'mattermost'
+# mattermost['uid'] = nil
+# mattermost['gid'] = nil
+# mattermost['home'] = '/var/opt/gitlab/mattermost'
+# mattermost['database_name'] = 'mattermost_production'
+# mattermost['env'] = {}
+
+# mattermost['service_use_ssl'] = false
+# mattermost['service_address'] = "127.0.0.1"
+# mattermost['service_port'] = "8065"
+# mattermost['service_site_url'] = nil
+# mattermost['service_maximum_login_attempts'] = 10
+# mattermost['service_google_developer_key'] = nil
+# mattermost['service_enable_incoming_webhooks'] = true
+# mattermost['service_enable_post_username_override'] = true
+# mattermost['service_enable_post_icon_override'] = true
+# mattermost['service_enable_testing'] = false
+# mattermost['service_enable_security_fix_alert'] = true
+# mattermost['service_enable_insecure_outgoing_connections'] = false
+# mattermost['service_allowed_untrusted_internal_connections'] = ""
+# mattermost['service_allow_cors_from'] = ""
+# mattermost['service_enable_outgoing_webhooks'] = true
+# mattermost['service_enable_commands'] = true
+# mattermost['service_enable_custom_emoji'] = false
+# mattermost['service_enable_only_admin_integrations'] = true
+# mattermost['service_enable_oauth_service_provider'] = false
+# mattermost['service_enable_developer'] = false
+# mattermost['service_session_length_web_in_days'] = 30
+# mattermost['service_session_length_mobile_in_days'] = 30
+# mattermost['service_session_length_sso_in_days'] = 30
+# mattermost['service_session_cache_in_minutes'] = 10
+# mattermost['service_connection_security'] = nil
+# mattermost['service_tls_cert_file'] = nil
+# mattermost['service_tls_key_file'] = nil
+# mattermost['service_use_lets_encrypt'] = false
+# mattermost['service_lets_encrypt_cert_cache_file'] = "./config/letsencrypt.cache"
+# mattermost['service_forward_80_to_443'] = false
+# mattermost['service_read_timeout'] = 300
+# mattermost['service_write_timeout'] = 300
+# mattermost['service_time_between_user_typing_updates_milliseconds'] = 5000
+# mattermost['service_enable_link_previews'] = false
+# mattermost['service_enable_user_typing_messages'] = true
+# mattermost['service_enable_post_search'] = true
+# mattermost['service_enable_user_statuses'] = true
+# mattermost['service_enable_emoji_picker'] = true
+# mattermost['service_enable_channel_viewed_messages'] = true
+# mattermost['service_enable_apiv3'] = true
+# mattermost['service_goroutine_health_threshold'] = -1
+# mattermost['service_user_access_tokens'] = false
+
+# mattermost['team_site_name'] = "GitLab Mattermost"
+# mattermost['team_max_users_per_team'] = 150
+# mattermost['team_enable_team_creation'] = true
+# mattermost['team_enable_user_creation'] = true
+# mattermost['team_enable_open_server'] = false
+# mattermost['team_allow_public_link'] = true
+# mattermost['team_allow_valet_default'] = false
+# mattermost['team_restrict_creation_to_domains'] = "gmail.com"
+# mattermost['team_restrict_team_names'] = true
+# mattermost['team_restrict_direct_message'] = "any"
+# mattermost['team_max_channels_per_team'] = 2000
+# mattermost['team_enable_x_to_leave_channels_from_lhs'] = false
+# mattermost['team_user_status_away_timeout'] = 300
+# mattermost['team_teammate_name_display'] = "full_name"
+
+# mattermost['sql_driver_name'] = 'mysql'
+# mattermost['sql_data_source'] = "mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"
+# mattermost['sql_data_source_replicas'] = ["mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"]
+# mattermost['sql_max_idle_conns'] = 10
+# mattermost['sql_max_open_conns'] = 10
+# mattermost['sql_trace'] = false
+# mattermost['sql_data_source_search_replicas'] = []
+# mattermost['sql_query_timeout'] = 30
+
+
+# mattermost['log_file_directory'] = '/var/log/gitlab/mattermost/'
+# mattermost['log_console_enable'] = true
+# mattermost['log_console_level'] = 'INFO'
+# mattermost['log_enable_file'] = false
+# mattermost['log_file_level'] = 'INFO'
+# mattermost['log_file_format'] = nil
+# mattermost['log_enable_diagnostics'] = true
+
+# mattermost['gitlab_enable'] = false
+# mattermost['gitlab_id'] = "12345656"
+# mattermost['gitlab_secret'] = "123456789"
+# mattermost['gitlab_scope'] = ""
+# mattermost['gitlab_auth_endpoint'] = "http://gitlab.example.com/oauth/authorize"
+# mattermost['gitlab_token_endpoint'] = "http://gitlab.example.com/oauth/token"
+# mattermost['gitlab_user_api_endpoint'] = "http://gitlab.example.com/api/v4/user"
+
+# mattermost['aws'] = {'S3AccessKeyId' => '123', 'S3SecretAccessKey' => '123', 'S3Bucket' => 'aa', 'S3Region' => 'bb'}
+
+# mattermost['email_enable_sign_up_with_email'] = true
+# mattermost['email_enable_sign_in_with_email'] = true
+# mattermost['email_enable_sign_in_with_username'] = false
+# mattermost['email_send_email_notifications'] = false
+# mattermost['email_require_email_verification'] = false
+# mattermost['email_smtp_username'] = nil
+# mattermost['email_smtp_password'] = nil
+# mattermost['email_smtp_server'] = nil
+# mattermost['email_smtp_port'] = nil
+# mattermost['email_connection_security'] = nil
+# mattermost['email_feedback_name'] = nil
+# mattermost['email_feedback_email'] = nil
+# mattermost['email_feedback_organization'] = nil
+# mattermost['email_send_push_notifications'] = true
+# mattermost['email_push_notification_server'] = ""
+# mattermost['email_push_notification_contents'] = "generic"
+# mattermost['email_enable_batching'] = false
+# mattermost['email_batching_buffer_size'] = 256
+# mattermost['email_batching_interval'] = 30
+# mattermost['email_skip_server_certificate_verification'] = false
+# mattermost['email_smtp_auth'] = false
+# mattermost['email_notification_content_type'] = "full"
+
+# mattermost['file_max_file_size'] = 52428800
+# mattermost['file_driver_name'] = "local"
+# mattermost['file_directory'] = "/var/opt/gitlab/mattermost/data"
+# mattermost['file_enable_public_link'] = true
+# mattermost['file_initial_font'] = 'luximbi.ttf'
+# mattermost['file_amazon_s3_access_key_id'] = nil
+# mattermost['file_amazon_s3_bucket'] = nil
+# mattermost['file_amazon_s3_secret_access_key'] = nil
+# mattermost['file_amazon_s3_region'] = nil
+# mattermost["file_amazon_s3_endpoint"] = nil
+# mattermost["file_amazon_s3_bucket_endpoint"] = nil
+# mattermost["file_amazon_s3_location_constraint"] = false
+# mattermost["file_amazon_s3_lowercase_bucket"] = false
+# mattermost["file_amazon_s3_ssl"] = true
+# mattermost["file_amazon_s3_sign_v2"] = false
+# mattermost['file_enable_file_attachments'] = true
+# mattermost["file_amazon_s3_trace"] = false
+
+# mattermost['ratelimit_enable_rate_limiter'] = false
+# mattermost['ratelimit_per_sec'] = 10
+# mattermost['ratelimit_memory_store_size'] = 10000
+# mattermost['ratelimit_vary_by_remote_addr'] = true
+# mattermost['ratelimit_vary_by_header'] = nil
+# mattermost['ratelimit_max_burst'] = 100
+
+# mattermost['support_terms_of_service_link'] = "/static/help/terms.html"
+# mattermost['support_privacy_policy_link'] = "/static/help/privacy.html"
+# mattermost['support_about_link'] = "/static/help/about.html"
+# mattermost['support_report_a_problem_link'] =  "/static/help/report_problem.html"
+# mattermost['support_email'] =  "support@example.com"
+
+# mattermost['privacy_show_email_address'] = true
+# mattermost['privacy_show_full_name'] = true
+
+# mattermost['localization_server_locale'] = "en"
+# mattermost['localization_client_locale'] = "en"
+# mattermost['localization_available_locales'] = "en,es,fr,ja,pt-BR"
+
+# mattermost['webrtc_enable'] = false
+# mattermost['webrtc_gateway_websocket_url'] = nil
+# mattermost['webrtc_gateway_admin_url'] = nil
+# mattermost['webrtc_gateway_admin_secret'] = nil
+# mattermost['webrtc_gateway_stun_uri'] = nil
+# mattermost['webrtc_gateway_turn_uri'] = nil
+# mattermost['webrtc_gateway_turn_username'] = nil
+# mattermost['webrtc_gateway_turn_shared_key'] = nil
+
+################################################################################
+## Mattermost NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Mattermost NGINX" section
+# You just have to change the key "nginx['some_settings']" with "mattermost_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Mattermost NGINX"
+# mattermost_nginx['enable'] = false
+
+# mattermost_nginx['custom_gitlab_mattermost_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# mattermost_nginx['proxy_set_headers'] = {
+#   "Host" => "$http_host",
+#   "X-Real-IP" => "$remote_addr",
+#   "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#   "X-Frame-Options" => "SAMEORIGIN",
+#   "X-Forwarded-Proto" => "https",
+#   "X-Forwarded-Ssl" => "on",
+#   "Upgrade" => "$http_upgrade",
+#   "Connection" => "$connection_upgrade"
+# }
+
+
+################################################################################
+## Registry NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Registry NGINX" section
+# You just have to change the key "nginx['some_settings']" with "registry_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Registry NGINX"
+# registry_nginx['enable'] = false
+
+# registry_nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on"
+# }
+
+################################################################################
+## Prometheus
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/
+################################################################################
+
+# prometheus['enable'] = true
+# prometheus['monitor_kubernetes'] = true
+# prometheus['username'] = 'gitlab-prometheus'
+# prometheus['uid'] = nil
+# prometheus['gid'] = nil
+# prometheus['shell'] = '/bin/sh'
+# prometheus['home'] = '/var/opt/gitlab/prometheus'
+# prometheus['log_directory'] = '/var/log/gitlab/prometheus'
+# prometheus['scrape_interval'] = 15
+# prometheus['scrape_timeout'] = 15
+# prometheus['chunk_encoding_version'] = 2
+#
+### Custom scrape configs
+#
+# Prometheus can scrape additional jobs via scrape_configs.  The default automatically
+# includes all of the exporters supported by the omnibus config.
+#
+# See: https://prometheus.io/docs/operating/configuration/#<scrape_config>
+#
+# Example:
+#
+# prometheus['scrape_configs'] = [
+#   {
+#     'job_name': 'example',
+#     'static_configs' => [
+#       'targets' => ['hostname:port'],
+#     ],
+#   },
+# ]
+#
+### Prometheus Memory Management
+#
+# Prometheus needs to be configured for how much memory is used.
+# * This sets the target heap size.
+# * This value accounts for approximately 2/3 of the memory used by the server.
+# * The recommended memory is 4kb per unique metrics time-series.
+# See: https://prometheus.io/docs/operating/storage/#memory-usage
+#
+# prometheus['target_heap_size'] = (
+#   # Use 25mb + 2% of total memory for Prometheus memory.
+#   26_214_400 + (node['memory']['total'].to_i * 1024 * 0.02 )
+# ).to_i
+#
+# prometheus['flags'] = {
+#   'storage.local.path' => "#{node['gitlab']['prometheus']['home']}/data",
+#   'storage.local.chunk-encoding-version' => user_config['chunk-encoding-version'],
+#   'storage.local.target-heap-size' => node['gitlab']['prometheus']['target-heap-size'],
+#   'config.file' => "#{node['gitlab']['prometheus']['home']}/prometheus.yml"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# prometheus['listen_address'] = 'localhost:9090'
+
+################################################################################
+## Prometheus Node Exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/node_exporter.html
+################################################################################
+
+# node_exporter['enable'] = true
+# node_exporter['home'] = '/var/opt/gitlab/node-exporter'
+# node_exporter['log_directory'] = '/var/log/gitlab/node-exporter'
+# node_exporter['flags'] = {
+#   'collector.textfile.directory' => "#{node['gitlab']['node-exporter']['home']}/textfile_collector"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# node_exporter['listen_address'] = 'localhost:9100'
+
+################################################################################
+## Prometheus Redis exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/redis_exporter.html
+################################################################################
+
+# redis_exporter['enable'] = true
+# redis_exporter['log_directory'] = '/var/log/gitlab/redis-exporter'
+# redis_exporter['flags'] = {
+#   'redis.addr' => "unix://#{node['gitlab']['gitlab-rails']['redis_socket']}",
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# redis_exporter['listen_address'] = 'localhost:9121'
+
+################################################################################
+## Prometheus Postgres exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/postgres_exporter.html
+################################################################################
+
+# postgres_exporter['enable'] = true
+# postgres_exporter['home'] = '/var/opt/gitlab/postgres-exporter'
+# postgres_exporter['log_directory'] = '/var/log/gitlab/postgres-exporter'
+# postgres_exporter['flags'] = {}
+# postgres_exporter['listen_address'] = 'localhost:9187'
+
+################################################################################
+## Prometheus Gitlab monitor
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/gitlab_monitor_exporter.html
+################################################################################
+
+
+# gitlab_monitor['enable'] = true
+# gitlab_monitor['log_directory'] = "/var/log/gitlab/gitlab-monitor"
+# gitlab_monitor['home'] = "/var/opt/gitlab/gitlab-monitor"
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# gitlab_monitor['listen_address'] = 'localhost'
+# gitlab_monitor['listen_port'] = '9168'
+
+# To completely disable prometheus, and all of it's exporters, set to false
+# prometheus_monitoring['enable'] = true
+
+################################################################################
+## Gitaly
+##! Docs:
+################################################################################
+
+
+# gitaly['enable'] = false
+# gitaly['dir'] = "/var/opt/gitlab/gitaly"
+# gitaly['log_directory'] = "/var/log/gitlab/gitaly"
+# gitaly['bin_path'] = "/opt/gitlab/embedded/bin/gitaly"
+# gitaly['env_directory'] = "/opt/gitlab/etc/gitaly"
+# gitaly['env'] = {
+#  'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin",
+#  'HOME' => '/var/opt/gitlab'
+# }
+# gitaly['socket_path'] = "/var/opt/gitlab/gitaly/gitaly.socket"
+# gitaly['listen_addr'] = "localhost:8075"
+# gitaly['prometheus_listen_addr'] = "localhost:9175"
+# gitaly['logging_format'] = "json"
+# gitaly['logging_sentry_dsn'] = "https://<key>:<secret>@sentry.io/<project>"
+# gitaly['prometheus_grpc_latency_buckets'] = "[0.001, 0.005, 0.025, 0.1, 0.5, 1.0, 10.0, 30.0, 60.0, 300.0, 1500.0]"
+# gitaly['auth_token'] = '<secret>'
+# gitaly['auth_transitioning'] = false # When true, auth is logged to Prometheus but NOT enforced
+# gitaly['storage'] = [
+#   {
+#     'name' => 'default',
+#     'path' => '/tmp/path-1'
+#   },
+#   {
+#     'name' => 'nfs1',
+#     'path' => '/mnt/nfs1'
+#   }
+# ]
+# gitaly['concurrency'] = [
+#   {
+#     'rpc' => "/gitaly.SmartHTTPService/PostReceivePack",
+#     'max_per_repo' => 20
+#   }, {
+#     'rpc' => "/gitaly.SSHService/SSHUploadPack",
+#     'max_per_repo' => 5
+#   }
+# ]
+
+################################################################################
+################################################################################
+##                  Configuration Settings for GitLab EE only                 ##
+################################################################################
+################################################################################
+
+
+################################################################################
+## Auxiliary cron jobs applicable to GitLab EE only
+################################################################################
+#
+# gitlab_rails['geo_file_download_dispatch_worker_cron'] = "*/10 * * * *"
+# gitlab_rails['geo_repository_sync_worker_cron'] = "*/5 * * * *"
+# gitlab_rails['ldap_sync_worker_cron'] = "30 1 * * *"
+# gitlab_rails['ldap_group_sync_worker_cron'] = "0 * * * *"
+# gitlab_rails['historical_data_worker_cron'] = "0 12 * * *"
+
+################################################################################
+## Kerberos (EE Only)
+##! Docs: https://docs.gitlab.com/ee/integration/kerberos.html#http-git-access
+################################################################################
+
+# gitlab_rails['kerberos_enabled'] = true
+# gitlab_rails['kerberos_keytab'] = /etc/http.keytab
+# gitlab_rails['kerberos_service_principal_name'] = HTTP/gitlab.example.com@EXAMPLE.COM
+# gitlab_rails['kerberos_use_dedicated_port'] = true
+# gitlab_rails['kerberos_port'] = 8443
+# gitlab_rails['kerberos_https'] = true
+
+################################################################################
+## GitLab Sentinel (EE Only)
+##! Docs: http://docs.gitlab.com/ce/administration/high_availability/redis.html#high-availability-with-sentinel
+################################################################################
+
+##! **Make sure you configured all redis['master_*'] keys above before
+##!   continuing.**
+
+##! To enable Sentinel and disable all other services in this machine,
+##! uncomment the line below (if you've enabled Redis role, it will keep it).
+##! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_sentinel_role['enable'] = true
+
+# sentinel['enable'] = true
+
+##! Bind to all interfaces, uncomment to specify an IP and bind to a single one
+# sentinel['bind'] = '0.0.0.0'
+
+##! Uncomment to change default port
+# sentinel['port'] = 26379
+
+##! Quorum must reflect the amount of voting sentinels it take to start a
+##! failover.
+##! **Value must NOT be greater then the amount of sentinels.**
+##! The quorum can be used to tune Sentinel in two ways:
+##! 1. If a the quorum is set to a value smaller than the majority of Sentinels
+##!    we deploy, we are basically making Sentinel more sensible to master
+##!    failures, triggering a failover as soon as even just a minority of
+##!    Sentinels is no longer able to talk with the master.
+##! 2. If a quorum is set to a value greater than the majority of Sentinels, we
+##!    are making Sentinel able to failover only when there are a very large
+##!    number (larger than majority) of well connected Sentinels which agree
+##!    about the master being down.
+# sentinel['quorum'] = 1
+
+### Consider unresponsive server down after x amount of ms.
+# sentinel['down_after_milliseconds'] = 10000
+
+### Specifies the failover timeout in milliseconds.
+##! It is used in many ways:
+##!
+##! - The time needed to re-start a failover after a previous failover was
+##!   already tried against the same master by a given Sentinel, is two
+##!   times the failover timeout.
+##!
+##! - The time needed for a slave replicating to a wrong master according
+##!   to a Sentinel current configuration, to be forced to replicate
+##!   with the right master, is exactly the failover timeout (counting since
+##!   the moment a Sentinel detected the misconfiguration).
+##!
+##! - The time needed to cancel a failover that is already in progress but
+##!   did not produced any configuration change (SLAVEOF NO ONE yet not
+##!   acknowledged by the promoted slave).
+##!
+##! - The maximum time a failover in progress waits for all the slaves to be
+##!   reconfigured as slaves of the new master. However even after this time
+##!   the slaves will be reconfigured by the Sentinels anyway, but not with
+##!   the exact parallel-syncs progression as specified.
+# sentinel['failover_timeout'] = 60000
+
+################################################################################
+## GitLab Sidekiq Cluster (EE only)
+################################################################################
+
+##! GitLab Enterprise Edition allows one to start an extra set of Sidekiq processes
+##! besides the default one. These processes can be used to consume a dedicated set
+##! of queues. This can be used to ensure certain queues always have dedicated
+##! workers, no matter the amount of jobs that need to be processed.
+
+# sidekiq_cluster['enable'] = false
+# sidekiq_cluster['ha'] = false
+# sidekiq_cluster['log_directory'] = "/var/log/gitlab/sidekiq-cluster"
+# sidekiq_cluster['interval'] = 5 # The number of seconds to wait between worker checks
+
+##! Each entry in the queue_groups array denotes a group of queues that have to be processed by a
+##! Sidekiq process. Multiple queues can be processed by the same process by
+##! separating them with a comma within the group entry
+
+# sidekiq_cluster['queue_groups'] = [
+#   "process_commit,post_receive",
+#   "gitlab_shell"
+# ]
+#
+
+##! If negate is enabled then sidekiq-cluster will process all the queues that
+##! don't match those in queue_groups.
+
+# sidekiq_cluster['negate'] = false
+
+################################################################################
+## Additional Database Settings (EE only)
+##! Docs: https://docs.gitlab.com/ee/administration/database_load_balancing.html
+################################################################################
+# gitlab_rails['db_load_balancing'] = { 'hosts' => ['secondary1.example.com'] }
+
+################################################################################
+## GitLab Geo
+##! Docs: https://docs.gitlab.com/ee/gitlab-geo
+################################################################################
+# geo_primary_role['enable'] = false
+# geo_secondary_role['enable'] = false
+
+################################################################################
+## GitLab Geo Secondary (EE only)
+################################################################################
+# geo_secondary['auto_migrate'] = true
+# geo_secondary['db_adapter'] = "postgresql"
+# geo_secondary['db_encoding'] = "unicode"
+# geo_secondary['db_collation'] = nil
+# geo_secondary['db_database'] = "gitlabhq_geo_production"
+# geo_secondary['db_pool'] = 10
+# geo_secondary['db_username'] = "gitlab_geo"
+# geo_secondary['db_password'] = nil
+# geo_secondary['db_host'] = "/var/opt/gitlab/geo-postgresql"
+# geo_secondary['db_port'] = 5431
+# geo_secondary['db_socket'] = nil
+# geo_secondary['db_sslmode'] = nil
+# geo_secondary['db_sslrootcert'] = nil
+# geo_secondary['db_sslca'] = nil
+
+################################################################################
+## GitLab Geo Secondary Tracking Database (EE only)
+################################################################################
+
+# geo_postgresql['enable'] = false
+# geo_postgresql['ha'] = false
+# geo_postgresql['dir'] = '/var/opt/gitlab/geo-postgresql'
+# geo_postgresql['data_dir'] = '/var/opt/gitlab/geo-postgresql/data'
+
+################################################################################
+# Pgbouncer (EE only)
+# See [GitLab PgBouncer documentation](http://docs.gitlab.com/omnibus/settings/database.html#enabling-pgbouncer-ee-only)
+# See the [PgBouncer page](https://pgbouncer.github.io/config.html) for details
+################################################################################
+# pgbouncer['enable'] = false
+# pgbouncer['log_directory'] = '/var/log/gitlab/pgbouncer'
+# pgbouncer['data_directory'] = '/var/opt/gitlab/pgbouncer'
+# pgbouncer['listen_addr'] = '0.0.0.0'
+# pgbouncer['listen_port'] = '6432'
+# pgbouncer['pool_mode'] = 'session'
+# pgbouncer['server_reset_query'] = 'DISCARD ALL'
+# pgbouncer['max_client_conn'] = '100'
+# pgbouncer['default_pool_size'] = '20'
+# pgbouncer['min_pool_size'] = '0'
+# pgbouncer['reserve_pool_size'] = '0'
+# pgbouncer['reserve_pool_timeout'] = '5.0'
+# pgbouncer['server_round_robin'] = '0'
+# pgbouncer['log_connections'] = '0'
+# pgbouncer['server_idle_timeout'] = '600.0'
+# pgbouncer['dns_max_ttl'] = '15.0'
+# pgbouncer['dns_zone_check_period'] = '0'
+# pgbouncer['dns_nxdomain_ttl'] = '15.0'
+# pgbouncer['admin_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['stats_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['ignore_startup_parameters'] = 'extra_float_digits'
+# pgbouncer['databases'] = {
+#   DATABASE_NAME: {
+#     host: HOSTNAME,
+#     port: PORT
+#     user: USERNAME,
+#     password: PASSWORD
+###! generate this with `echo -n '$password + $username' | md5sum`
+#   }
+#   ...
+# }
+# pgbouncer['logfile'] = nil
+# pgbouncer['auth_type'] = 'md5'
+# pgbouncer['auth_hba_file'] = nil
+# pgbouncer['auth_query'] = 'SELECT username, password FROM public.pg_shadow_lookup($1)'
+# pgbouncer['users'] = [
+#   {
+#     name: USERNAME,
+#     password: MD5_PASSWORD_HASH
+#   }
+# ]
+# postgresql['pgbouncer_user'] = nil
+# postgresql['pgbouncer_user_password'] = nil
+#
+
+################################################################################
+# Repmgr (EE only)
+################################################################################
+# repmgr['enable'] = false
+# repmgr['cluster'] = 'gitlab_cluster'
+# repmgr['database'] = 'gitlab_repmgr'
+# repmgr['host'] = nil
+# repmgr['node_number'] = nil
+# repmgr['port'] = 5432
+# repmgr['trust_auth_cidr_addresses'] = []
+# repmgr['user'] = 'gitlab_repmgr'
+# repmgr['failover'] = 'automatic'
+# repmgr['log_directory'] = '/var/log/gitlab/repmgrd'
+# repmgr['node_name'] = nil
+# repmgr['pg_bindir'] = '/opt/gitlab/embedded/bin'
+# repmgr['service_start_command'] = '/opt/gitlab/bin/gitlab-ctl start postgresql'
+# repmgr['service_stop_command'] = '/opt/gitlab/bin/gitlab-ctl stop postgresql'
+# repmgr['service_reload_command'] = '/opt/gitlab/bin/gitlab-ctl hup postgresql'
+# repmgr['service_restart_command'] = '/opt/gitlab/bin/gitlab-ctl restart postgresql'
+# repmgr['service_promote_command'] = nil
+# repmgr['promote_command'] = '/opt/gitlab/embedded/bin/repmgr standby promote -f /var/opt/gitlab/postgresql/repmgr.conf'
+# repmgr['follow_command'] = '/opt/gitlab/embedded/bin/repmgr standby follow -f /var/opt/gitlab/postgresql/repmgr.conf'
+
+# repmgr['upstream_node'] = nil
+# repmgr['use_replication_slots'] = false
+# repmgr['loglevel'] = 'INFO'
+# repmgr['logfacility'] = 'STDERR'
+# repmgr['logfile'] = nil
+
+# repmgr['event_notification_command'] = nil
+# repmgr['event_notifications'] = nil
+
+# repmgr['rsync_options'] = nil
+# repmgr['ssh_options'] = nil
+# repmgr['priority'] = nil
+
+# repmgr['retry_promote_interval_secs'] = 300
+# repmgr['witness_repl_nodes_sync_interval_secs'] = 15
+# repmgr['reconnect_attempts'] = 6
+# repmgr['reconnect_interval'] = 10
+# repmgr['monitor_interval_secs'] = 2
+# repmgr['master_response_timeout'] = 60
+# repmgr['daemon'] = true
+# repmgrd['enable'] = true
+
+################################################################################
+# Consul (EEP only)
+################################################################################
+# consul['enable'] = false
+# consul['dir'] = '/var/opt/gitlab/consul'
+# consul['user'] = 'gitlab-consul'
+# consul['config_file'] = '/var/opt/gitlab/consul/config.json'
+# consul['config_dir'] = '/var/opt/gitlab/consul/config.d'
+# consul['data_dir'] = '/var/opt/gitlab/consul/data'
+# consul['log_directory'] = '/var/log/gitlab/consul'
+# consul['script_directory'] = '/var/opt/gitlab/consul/scripts'
+# consul['configuration'] = {
+#   'client_addr' => nil,
+#   'datacenter' => 'gitlab_consul',
+#   'enable_script_checks' => true,
+#   'server' => false
+# }
+# consul['services'] = []
+# consul['service_config'] = {
+#   'postgresql' => {
+#     'service' => {
+#       'name' => "postgresql",
+#       'address' => '',
+#       'port' => 5432,
+#       'checks' => [
+#         {
+#           'script' => "/var/opt/gitlab/consul/scripts/check_postgresql",
+#           'interval' => "10s"
+#         }
+#       ]
+#     }
+#   }
+# }
+# consul['watchers'] = {
+#   'postgresql' => {
+#     enable: false,
+#     handler: 'failover_pgbouncer'
+#   }
+# }
diff --git a/roles/gitlab-omnibus-9/.env b/roles/gitlab-omnibus-9/.env
new file mode 100644
index 00000000..3837f872
--- /dev/null
+++ b/roles/gitlab-omnibus-9/.env
@@ -0,0 +1,2 @@
+GITLAB_VERSION=9.5.0-ce.0
+PUBLIC_IP=172.16.103.70
diff --git a/roles/gitlab-omnibus-9/Dockerfile b/roles/gitlab-omnibus-9/Dockerfile
new file mode 100644
index 00000000..37295b48
--- /dev/null
+++ b/roles/gitlab-omnibus-9/Dockerfile
@@ -0,0 +1,7 @@
+ARG  GITLAB_VERSION=latest
+FROM gitlab/gitlab-ce:${GITLAB_VERSION}
+
+COPY gitlab.rb /opt/gitlab/etc/gitlab.rb.template
+COPY entrypoint.sh /entrypoint.sh
+RUN  chmod +x /entrypoint.sh
+CMD [ "/entrypoint.sh", "/assets/wrapper" ]
diff --git a/roles/gitlab-omnibus-9/defaults/main.yml b/roles/gitlab-omnibus-9/defaults/main.yml
new file mode 100644
index 00000000..28fe3644
--- /dev/null
+++ b/roles/gitlab-omnibus-9/defaults/main.yml
@@ -0,0 +1,48 @@
+---
+
+# The hostname passed as an envirnment variable into the container
+gitlab_ip_addr: '127.0.0.1'
+gitlab_hostname: git.example.com
+gitlab_port_args: 
+    - 80
+    - 443
+    - 22
+
+# database usernames and passwords
+gitlab_db_user: novatech
+
+# must pass in the following variables
+# gitlab_db_password: ''
+
+# the name of the image being duilt and used for the container
+gitlab_image_repo: 'https://github.com/novatechweb/docker-gitlab.git'
+gitlab_image_name: 'gitlab/gitlab-ce:10.1.7-ce.0'
+# gitlab_dv_image_name: '{{ docker_registry_username }}/gitlab'
+# gitlab_db_image_name: '{{ docker_registry_username }}/postgres'
+# redis_image_name: '{{ docker_registry_username }}/redis'
+
+# the name of the gitlab container
+gitlab_container_name: '{{ docker_name_prefix }}gitlab'
+
+# the name of the redis container for gitlab
+# gitlab_redis_container_name: '{{ docker_name_prefix }}gitlab_redis'
+
+# the name of the postgres container for gitlab
+# gitlab_db_container_name: '{{ docker_name_prefix }}gitlab_db'
+
+# the name of the config-volume used by the container
+gitlab_cv_name: '{{ docker_name_prefix }}gitlab_CV'
+
+# the name of the data-volume used by the container
+gitlab_dv_name: '{{ docker_name_prefix }}gitlab_DV'
+
+# the name of the data-volume used by the postgres container
+# gitlab_db_dv_name: '{{ docker_name_prefix }}gitlab_db_DV'
+
+# restore directories to temporarly store data being restored into docker containers
+gitlab_docker_backup_dir: '{{ docker_backup_dir }}/GIT'
+gitlab_docker_restore_dir: '{{ bacula_dest }}{{ gitlab_docker_backup_dir }}'
+
+# Network names
+docker_network_frontend: 'frontend'
+gitlab_config_dir: '{{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}'
diff --git a/roles/gitlab-omnibus-9/docker-compose.yml b/roles/gitlab-omnibus-9/docker-compose.yml
new file mode 100644
index 00000000..8a7e6e0c
--- /dev/null
+++ b/roles/gitlab-omnibus-9/docker-compose.yml
@@ -0,0 +1,36 @@
+version: "3"
+services:
+  gitlab:
+    build:
+      context: .
+      args:
+        GITLAB_VERSION: "${GITLAB_VERSION}"
+    image: 'novatechweb/gitlab-ce:${GITLAB_VERSION}'
+    hostname: 'git.novatech-llc.com'
+    networks:
+      - frontend
+    ports:
+      - '${PUBLIC_IP}:8080:80'
+      - '${PUBLIC_IP}:8443:443'
+      - '${PUBLIC_IP}:8022:22'
+    volumes:
+      - gitlab-ce-config:/etc/gitlab
+      - gitlab-ce-logs:/var/log/gitlab
+      - gitlab-ce-data:/var/opt/gitlab
+      - gitlab-ce-backups:/mnt/backups
+      - gitlab-ssl:/run/secrets/ssl
+
+networks:
+  frontend:
+
+volumes:
+  gitlab-ce-backups:
+    external: true
+  gitlab-ce-config:
+    external: true
+  gitlab-ce-logs:
+    external: true
+  gitlab-ce-data:
+    external: true
+  gitlab-ssl:
+    external: true
diff --git a/roles/gitlab-omnibus-9/entrypoint.sh b/roles/gitlab-omnibus-9/entrypoint.sh
new file mode 100644
index 00000000..64d5bff0
--- /dev/null
+++ b/roles/gitlab-omnibus-9/entrypoint.sh
@@ -0,0 +1,15 @@
+#!/bin/sh
+
+set -x
+
+groupadd -g 993 registry
+useradd -m -u 993 -g registry -m -s /bin/sh -d /var/opt/gitlab/registry registry
+
+install -m 0755 /opt/gitlab/etc/gitlab.rb.template /etc/gitlab/gitlab.rb
+install -m 0755 -d /etc/gitlab/ssl
+install -m 0660 -t /etc/gitlab/ssl /run/secrets/ssl/nginx.crt
+install -m 0660 -t /etc/gitlab/ssl /run/secrets/ssl/nginx.key
+install -m 0660 -t /etc/gitlab/ssl /run/secrets/ssl/dhparam.pem
+chmod -R 2770 /var/opt/gitlab/git-data/repositories
+
+exec "$@"
diff --git a/roles/gitlab-omnibus-9/gitlab.rb b/roles/gitlab-omnibus-9/gitlab.rb
new file mode 100644
index 00000000..99c68d42
--- /dev/null
+++ b/roles/gitlab-omnibus-9/gitlab.rb
@@ -0,0 +1,1652 @@
+## GitLab configuration settings
+##! This file is generated during initial installation and **is not** modified
+##! during upgrades.
+##! Check out the latest version of this file to know about the different
+##! settings that can be configured by this file, which may be found at:
+##! https://gitlab.com/gitlab-org/omnibus-gitlab/raw/master/files/gitlab-config-template/gitlab.rb.template
+
+
+## GitLab URL
+##! URL on which GitLab will be reachable.
+##! For more details on configuring external_url see:
+##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab
+external_url 'https://127.0.0.1:8443'
+
+## Legend
+##! The following notations at the beginning of each line may be used to
+##! differentiate between components of this file and to easily select them using
+##! a regex.
+##! ## Titles, subtitles etc
+##! ##! More information - Description, Docs, Links, Issues etc.
+##! Configuration settings have a single # followed by a single space at the
+##! beginning; Remove them to enable the setting.
+
+##! **Configuration settings below are optional.**
+##! **The values currently assigned are only examples and ARE NOT the default
+##!   values.**
+
+
+################################################################################
+################################################################################
+##                Configuration Settings for GitLab CE and EE                 ##
+################################################################################
+################################################################################
+
+################################################################################
+## gitlab.yml configuration
+##! Docs: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/gitlab.yml.md
+################################################################################
+gitlab_rails['gitlab_ssh_host'] = 'localhost'
+gitlab_rails['time_zone'] = 'America/Chicago'
+
+### Email Settings
+gitlab_rails['gitlab_email_enabled'] = true
+gitlab_rails['gitlab_email_from'] = 'gitlab@novatech-llc.com'
+gitlab_rails['gitlab_email_display_name'] = 'GitLab'
+gitlab_rails['gitlab_email_reply_to'] = 'noreply@novatech-llc.com'
+# gitlab_rails['gitlab_email_subject_suffix'] = ''
+
+### GitLab user privileges
+gitlab_rails['gitlab_default_can_create_group'] = true
+gitlab_rails['gitlab_username_changing_enabled'] = true
+
+### Default Theme
+# gitlab_rails['gitlab_default_theme'] = 2
+
+### Default project feature settings
+gitlab_rails['gitlab_default_projects_features_issues'] = true
+gitlab_rails['gitlab_default_projects_features_merge_requests'] = true
+gitlab_rails['gitlab_default_projects_features_wiki'] = false
+gitlab_rails['gitlab_default_projects_features_snippets'] = true
+# gitlab_rails['gitlab_default_projects_features_builds'] = true
+# gitlab_rails['gitlab_default_projects_features_container_registry'] = true
+
+### Automatic issue closing
+###! See https://docs.gitlab.com/ce/customization/issue_closing.html for more
+###! information about this pattern.
+# gitlab_rails['gitlab_issue_closing_pattern'] = "((?:[Cc]los(?:e[sd]?|ing)|[Ff]ix(?:e[sd]|ing)?|[Rr]esolv(?:e[sd]?|ing))(:?) +(?:(?:issues? +)?%{issue_ref}(?:(?:, *| +and +)?)|([A-Z][A-Z0-9_]+-\d+))+)"
+
+### Download location
+###! When a user clicks e.g. 'Download zip' on a project, a temporary zip file
+###! is created in the following directory.
+# gitlab_rails['gitlab_repository_downloads_path'] = 'tmp/repositories'
+
+### Gravatar Settings
+gitlab_rails['gravatar_plain_url'] = 'http://cdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+gitlab_rails['gravatar_ssl_url'] = 'https://seccdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+
+### Auxiliary jobs
+###! Periodically executed jobs, to self-heal Gitlab, do external
+###! synchronizations, etc.
+###! Docs: https://github.com/ondrejbartas/sidekiq-cron#adding-cron-job
+###!       https://docs.gitlab.com/ce/ci/yaml/README.html#artifacts:expire_in
+# gitlab_rails['stuck_ci_jobs_worker_cron'] = "0 0 * * *"
+# gitlab_rails['expire_build_artifacts_worker_cron'] = "50 * * * *"
+# gitlab_rails['pipeline_schedule_worker_cron'] = "41 * * * *"
+# gitlab_rails['repository_check_worker_cron'] = "20 * * * *"
+# gitlab_rails['admin_email_worker_cron'] = "0 0 * * 0"
+# gitlab_rails['repository_archive_cache_worker_cron'] = "0 * * * *"
+
+### Webhook Settings
+###! Number of seconds to wait for HTTP response after sending webhook HTTP POST
+###! request (default: 10)
+# gitlab_rails['webhook_timeout'] = 10
+
+### Trusted proxies
+###! Customize if you have GitLab behind a reverse proxy which is running on a
+###! different machine.
+###! **Add the IP address for your reverse proxy to the list, otherwise users
+###!   will appear signed in from that address.**
+# gitlab_rails['trusted_proxies'] = []
+
+### Monitoring settings
+###! IP whitelist controlling access to monitoring endpoints
+# gitlab_rails['monitoring_whitelist'] = ['127.0.0.0/8']
+###! Time between sampling of unicorn socket metrics, in seconds
+# gitlab_rails['monitoring_unicorn_sampler_interval'] = 10
+
+### Reply by email
+###! Allow users to comment on issues and merge requests by replying to
+###! notification emails.
+###! Docs: https://docs.gitlab.com/ce/administration/reply_by_email.html
+# gitlab_rails['incoming_email_enabled'] = true
+
+#### Incoming Email Address
+####! The email address including the `%{key}` placeholder that will be replaced
+####! to reference the item being replied to.
+####! **The placeholder can be omitted but if present, it must appear in the
+####!   "user" part of the address (before the `@`).**
+# gitlab_rails['incoming_email_address'] = "gitlab-incoming+%{key}@gmail.com"
+
+#### Email account username
+####! **With third party providers, this is usually the full email address.**
+####! **With self-hosted email servers, this is usually the user part of the
+####!   email address.**
+# gitlab_rails['incoming_email_email'] = "gitlab-incoming@gmail.com"
+
+#### Email account password
+# gitlab_rails['incoming_email_password'] = "[REDACTED]"
+
+#### IMAP Settings
+# gitlab_rails['incoming_email_host'] = "imap.gmail.com"
+# gitlab_rails['incoming_email_port'] = 993
+# gitlab_rails['incoming_email_ssl'] = true
+# gitlab_rails['incoming_email_start_tls'] = false
+
+#### Incoming Mailbox Settings
+####! The mailbox where incoming mail will end up. Usually "inbox".
+# gitlab_rails['incoming_email_mailbox_name'] = "inbox"
+####! The IDLE command timeout.
+# gitlab_rails['incoming_email_idle_timeout'] = 60
+
+### Job Artifacts
+# gitlab_rails['artifacts_enabled'] = true
+# gitlab_rails['artifacts_path'] = "/mnt/storage/artifacts"
+# gitlab_rails['artifacts_object_store_enabled'] = false
+# gitlab_rails['artifacts_object_store_remote_directory'] = "artifacts"
+# gitlab_rails['artifacts_object_store_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AWS_ACCESS_KEY_ID',
+#   'aws_secret_access_key' => 'AWS_SECRET_ACCESS_KEY'
+# }
+
+### Git LFS
+# gitlab_rails['lfs_enabled'] = true
+# gitlab_rails['lfs_storage_path'] = "/mnt/storage/lfs-objects"
+
+### Usage Statistics
+# gitlab_rails['usage_ping_enabled'] = true
+
+### GitLab Mattermost
+###! These settings are void if Mattermost is installed on the same omnibus
+###! install
+# gitlab_rails['mattermost_host'] = "https://mattermost.example.com"
+
+### LDAP Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html
+###! **Be careful not to break the indentation in the ldap_servers block. It is
+###!   in yaml format and the spaces must be retained. Using tabs will not work.**
+
+gitlab_rails['ldap_enabled'] = true
+
+###! **remember to close this block with 'EOS' below**
+# gitlab_rails['ldap_servers'] = YAML.load <<-'EOS'
+#   main: # 'main' is the GitLab 'provider ID' of this LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+#     verify_certificates: true
+#     ca_file: ''
+#     ssl_version: ''
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+#
+#   secondary: # 'secondary' is the GitLab 'provider ID' of second LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+#     verify_certificates: true
+#     ca_file: ''
+#     ssl_version: ''
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+# EOS
+
+gitlab_rails['ldap_servers'] = YAML.load <<-'EOS' # remember to close this block with 'EOS' below
+  main: # 'main' is the GitLab 'provider ID' of this LDAP server
+    label: 'NovaTech'
+    host: 'ldap.novatech-llc.com'
+    port: 389
+    uid: 'uid'
+    bind_dn: 'cn=proxyagent,dc=novatech'
+    password: '4H:LK7g5oYkDT1nEhwR0'
+    encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+    verify_certificates: true
+    ca_file: ''
+    ssl_version: ''
+    active_directory: false
+    allow_username_or_email_login: true
+    block_auto_created_users: false
+    base: 'ou=user,dc=novatech'
+    user_filter: '(employeeType=gitlab)'
+    attributes:
+      username: ['uid', 'userid', 'sAMAccountName']
+      email:    ['mail', 'email', 'userPrincipalName']
+      name:       'cn'
+      first_name: 'givenName'
+      last_name:  'sn'
+EOS
+
+### OmniAuth Settings
+###! Docs: https://docs.gitlab.com/ce/integration/omniauth.html
+# gitlab_rails['omniauth_enabled'] = false
+# gitlab_rails['omniauth_allow_single_sign_on'] = ['saml']
+# gitlab_rails['omniauth_sync_email_from_provider'] = 'saml'
+# gitlab_rails['omniauth_auto_sign_in_with_provider'] = 'saml'
+# gitlab_rails['omniauth_block_auto_created_users'] = true
+# gitlab_rails['omniauth_auto_link_ldap_user'] = false
+# gitlab_rails['omniauth_auto_link_saml_user'] = false
+# gitlab_rails['omniauth_external_providers'] = ['twitter', 'google_oauth2']
+# gitlab_rails['omniauth_providers'] = [
+#   {
+#     "name" => "google_oauth2",
+#     "app_id" => "YOUR APP ID",
+#     "app_secret" => "YOUR APP SECRET",
+#     "args" => { "access_type" => "offline", "approval_prompt" => "" }
+#   }
+# ]
+
+### Backup Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/backups.html
+
+# gitlab_rails['manage_backup_path'] = true
+gitlab_rails['backup_path'] = "/var/opt/gitlab/backups"
+
+###! Docs: https://docs.gitlab.com/ce/raketasks/backup_restore.html#backup-archive-permissions
+gitlab_rails['backup_archive_permissions'] = 0644
+
+gitlab_rails['backup_pg_schema'] = 'public'
+
+###! The duration in seconds to keep backups before they are allowed to be deleted
+gitlab_rails['backup_keep_time'] = 604800
+
+# gitlab_rails['backup_upload_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AKIAKIAKI',
+#   'aws_secret_access_key' => 'secret123'
+# }
+# gitlab_rails['backup_upload_remote_directory'] = 'my.s3.bucket'
+# gitlab_rails['backup_multipart_chunk_size'] = 104857600
+gitlab_rails['backup_upload_connection'] = {
+  :provider => 'Local',
+  :local_root => '/mnt/backups'
+}
+gitlab_rails['backup_upload_remote_directory'] = '.'
+
+###! **Turns on AWS Server-Side Encryption with Amazon S3-Managed Keys for
+###!   backups**
+# gitlab_rails['backup_encryption'] = 'AES256'
+
+###! **Specifies Amazon S3 storage class to use for backups. Valid values
+###!   include 'STANDARD', 'STANDARD_IA', 'GLACIER', and
+###!   'REDUCED_REDUNDANCY'**
+# gitlab_rails['backup_storage_class'] = 'STANDARD'
+
+### For setting up different data storing directory
+###! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#storing-git-data-in-an-alternative-directory
+###! **If you want to use a single non-default directory to store git data use a
+###!   path that doesn't contain symlinks.**
+# git_data_dirs({
+#   "default" => {
+#     "path" => "/mnt/nfs-01/git-data",
+#     "failure_count_threshold" => 10,
+#     "failure_wait_time" => 30,
+#     "failure_reset_time" => 1800,
+#     "storage_timeout" => 5
+#    }
+# })
+
+### Gitaly settings
+# gitlab_rails['gitaly_token'] = 'secret token'
+
+### For storing GitLab application uploads, eg. LFS objects, build artifacts
+###! Docs: https://docs.gitlab.com/ce/development/shared_files.html
+# gitlab_rails['shared_path'] = '/var/opt/gitlab/gitlab-rails/shared'
+
+### GitLab Shell settings for GitLab
+# gitlab_rails['gitlab_shell_ssh_port'] = 22
+# gitlab_rails['git_max_size'] = 20971520
+# gitlab_rails['git_timeout'] = 10
+# gitlab_rails['gitlab_shell_git_timeout'] = 800
+
+### Extra customization
+# gitlab_rails['extra_google_analytics_id'] = '_your_tracking_id'
+# gitlab_rails['extra_piwik_url'] = '_your_piwik_url'
+# gitlab_rails['extra_piwik_site_id'] = '_your_piwik_site_id'
+
+##! Docs: https://docs.gitlab.com/omnibus/settings/environment-variables.html
+# gitlab_rails['env'] = {
+#   'BUNDLE_GEMFILE' => "/opt/gitlab/embedded/service/gitlab-rails/Gemfile",
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+# gitlab_rails['rack_attack_git_basic_auth'] = {
+#   'enabled' => true,
+#   'ip_whitelist' => ["127.0.0.1"],
+#   'maxretry' => 10,
+#   'findtime' => 60,
+#   'bantime' => 3600
+# }
+
+# gitlab_rails['rack_attack_protected_paths'] = [
+#   '/users/password',
+#   '/users/sign_in',
+#   '/api/#{API::API.version}/session.json',
+#   '/api/#{API::API.version}/session',
+#   '/users',
+#   '/users/confirmation',
+#   '/unsubscribes/',
+#   '/import/github/personal_access_token'
+# ]
+
+###! **We do not recommend changing these directories.**
+# gitlab_rails['dir'] = "/var/opt/gitlab/gitlab-rails"
+# gitlab_rails['log_directory'] = "/var/log/gitlab/gitlab-rails"
+
+### GitLab application settings
+# gitlab_rails['uploads_directory'] = "/var/opt/gitlab/gitlab-rails/uploads"
+# gitlab_rails['rate_limit_requests_per_period'] = 10
+# gitlab_rails['rate_limit_period'] = 60
+
+#### Change the initial default admin password and shared runner registraion tokens.
+####! **Only applicable on initial setup, changing these settings after database
+####!   is created and seeded won't yield any change.**
+gitlab_rails['initial_root_password'] = "nXdKrkalaZaxpk4ipYRk"
+# gitlab_rails['initial_shared_runners_registration_token'] = "token"
+
+#### Enable or disable automatic database migrations
+# gitlab_rails['auto_migrate'] = true
+
+#### This is advanced feature used by large gitlab deployments where loading
+#### whole RAILS env takes a lot of time.
+# gitlab_rails['rake_cache_clear'] = true
+
+### GitLab database settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/database.html
+###! **Only needed if you use an external database.**
+# gitlab_rails['db_adapter'] = "postgresql"
+# gitlab_rails['db_encoding'] = "unicode"
+# gitlab_rails['db_collation'] = nil
+# gitlab_rails['db_database'] = "gitlabhq_production"
+# gitlab_rails['db_pool'] = 10
+# gitlab_rails['db_username'] = "gitlab"
+# gitlab_rails['db_password'] = nil
+# gitlab_rails['db_host'] = nil
+# gitlab_rails['db_port'] = 5432
+# gitlab_rails['db_socket'] = nil
+# gitlab_rails['db_sslmode'] = nil
+# gitlab_rails['db_sslrootcert'] = nil
+# gitlab_rails['db_prepared_statements'] = true
+# gitlab_rails['db_statements_limit'] = 1000
+
+
+### GitLab Redis settings
+###! Connect to your own Redis instance
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+
+#### Redis TCP connection
+# gitlab_rails['redis_host'] = "127.0.0.1"
+# gitlab_rails['redis_port'] = 6379
+# gitlab_rails['redis_password'] = nil
+# gitlab_rails['redis_database'] = 0
+
+#### Redis local UNIX socket (will be disabled if TCP method is used)
+# gitlab_rails['redis_socket'] = "/var/opt/gitlab/redis/redis.socket"
+
+#### Sentinel support
+####! To have Sentinel working, you must enable Redis TCP connection support
+####! above and define a few Sentinel hosts below (to get a reliable setup
+####! at least 3 hosts).
+####! **You don't need to list every sentinel host, but the ones not listed will
+####!   not be used in a fail-over situation to query for the new master.**
+# gitlab_rails['redis_sentinels'] = [
+#   {'host' => '127.0.0.1', 'port' => 26379},
+# ]
+
+### GitLab email server settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html
+###! **Use smtp instead of sendmail/postfix.**
+
+gitlab_rails['smtp_enable'] = true
+gitlab_rails['smtp_address'] = "mail.novatech-llc.com"
+gitlab_rails['smtp_port'] = 465
+gitlab_rails['smtp_user_name'] = "gitlab"
+gitlab_rails['smtp_password'] = "1-:cmnWFnfkbnemDG:2O"
+gitlab_rails['smtp_domain'] = "novatech-llc.com"
+gitlab_rails['smtp_authentication'] = "login"
+gitlab_rails['smtp_enable_starttls_auto'] = true
+gitlab_rails['smtp_tls'] = true
+
+###! **Can be: 'none', 'peer', 'client_once', 'fail_if_no_peer_cert'**
+###! Docs: http://api.rubyonrails.org/classes/ActionMailer/Base.html
+# gitlab_rails['smtp_openssl_verify_mode'] = 'none'
+
+# gitlab_rails['smtp_ca_path'] = "/etc/ssl/certs"
+# gitlab_rails['smtp_ca_file'] = "/etc/ssl/certs/ca-certificates.crt"
+
+################################################################################
+## Container Registry settings
+##! Docs: https://docs.gitlab.com/ce/administration/container_registry.html
+################################################################################
+
+# registry_external_url 'https://registry.gitlab.example.com'
+
+### Settings used by GitLab application
+# gitlab_rails['registry_enabled'] = true
+# gitlab_rails['registry_host'] = "registry.gitlab.example.com"
+# gitlab_rails['registry_port'] = "5005"
+# gitlab_rails['registry_path'] = "/var/opt/gitlab/gitlab-rails/shared/registry"
+
+###! **Do not change the following 3 settings unless you know what you are
+###!   doing**
+# gitlab_rails['registry_api_url'] = "http://localhost:5000"
+# gitlab_rails['registry_key_path'] = "/var/opt/gitlab/gitlab-rails/certificate.key"
+# gitlab_rails['registry_issuer'] = "omnibus-gitlab-issuer"
+
+### Settings used by Registry application
+# registry['enable'] = true
+# registry['username'] = "registry"
+# registry['group'] = "registry"
+# registry['uid'] = nil
+# registry['gid'] = nil
+# registry['dir'] = "/var/opt/gitlab/registry"
+# registry['registry_http_addr'] = "localhost:5000"
+# registry['debug_addr'] = "localhost:5001"
+# registry['log_directory'] = "/var/log/gitlab/registry"
+# registry['log_level'] = "info"
+# registry['rootcertbundle'] = "/var/opt/gitlab/registry/certificate.crt"
+# registry['storage_delete_enabled'] = true
+
+### Registry backend storage
+###! Docs: https://docs.gitlab.com/ce/administration/container_registry.html#container-registry-storage-driver
+# registry['storage'] = {
+#   's3' => {
+#     'accesskey' => 'AKIAKIAKI',
+#     'secretkey' => 'secret123',
+#     'bucket' => 'gitlab-registry-bucket-AKIAKIAKI'
+#   }
+# }
+
+### Registry notifications endpoints
+# registry['notifications'] = [
+#   {
+#     'name' => 'test_endpoint',
+#     'url' => 'https://gitlab.example.com/notify2',
+#     'timeout' => '500ms',
+#     'threshold' => 5,
+#     'backoff' => '1s',
+#     'headers' => {
+#       "Authorization" => ["AUTHORIZATION_EXAMPLE_TOKEN"]
+#     }
+#   }
+# ]
+### Default registry notifications
+# registry['default_notifications_timeout'] = "500ms"
+# registry['default_notifications_threshold'] = 5
+# registry['default_notifications_backoff'] = "1s"
+# registry['default_notifications_headers'] = {}
+
+
+
+################################################################################
+## GitLab Workhorse
+##! Docs: https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/README.md
+################################################################################
+
+# gitlab_workhorse['enable'] = true
+# gitlab_workhorse['ha'] = false
+# gitlab_workhorse['listen_network'] = "unix"
+# gitlab_workhorse['listen_umask'] = 000
+# gitlab_workhorse['listen_addr'] = "/var/opt/gitlab/gitlab-workhorse/socket"
+# gitlab_workhorse['auth_backend'] = "http://localhost:8080"
+
+##! the empty string is the default in gitlab-workhorse option parser
+# gitlab_workhorse['auth_socket'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['pprof_listen_addr'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['prometheus_listen_addr'] = "''"
+
+# gitlab_workhorse['dir'] = "/var/opt/gitlab/gitlab-workhorse"
+# gitlab_workhorse['log_directory'] = "/var/log/gitlab/gitlab-workhorse"
+# gitlab_workhorse['proxy_headers_timeout'] = "1m0s"
+
+##! limit number of concurrent API requests, defaults to 0 which is unlimited
+# gitlab_workhorse['api_limit'] = 0
+
+##! limit number of API requests allowed to be queued, defaults to 0 which
+##! disables queuing
+# gitlab_workhorse['api_queue_limit'] = 0
+
+##! duration after which we timeout requests if they sit too long in the queue
+# gitlab_workhorse['api_queue_duration'] = "30s"
+
+##! Long polling duration for job requesting for runners
+# gitlab_workhorse['api_ci_long_polling_duration'] = "60s"
+
+# gitlab_workhorse['env'] = {
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+################################################################################
+## GitLab User Settings
+##! Modify default git user.
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#changing-the-name-of-the-git-user-group
+################################################################################
+
+# user['username'] = "git"
+# user['group'] = "git"
+# user['uid'] = nil
+# user['gid'] = nil
+
+##! The shell for the git user
+# user['shell'] = "/bin/sh"
+
+##! The home directory for the git user
+# user['home'] = "/var/opt/gitlab"
+
+# user['git_user_name'] = "GitLab"
+# user['git_user_email'] = "gitlab@#{node['fqdn']}"
+
+################################################################################
+## GitLab Unicorn
+##! Tweak unicorn settings.
+##! Docs: https://docs.gitlab.com/omnibus/settings/unicorn.html
+################################################################################
+
+# unicorn['worker_timeout'] = 60
+###! Minimum worker_processes is 2 at this moment
+###! See https://gitlab.com/gitlab-org/gitlab-ce/issues/18771
+# unicorn['worker_processes'] = 2
+
+### Advanced settings
+# unicorn['listen'] = '127.0.0.1'
+# unicorn['port'] = 8080
+# unicorn['socket'] = '/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket'
+# unicorn['pidfile'] = '/opt/gitlab/var/unicorn/unicorn.pid'
+# unicorn['tcp_nopush'] = true
+# unicorn['backlog_socket'] = 1024
+
+###! **Make sure somaxconn is equal or higher then backlog_socket**
+# unicorn['somaxconn'] = 1024
+
+###! **We do not recommend changing this setting**
+# unicorn['log_directory'] = "/var/log/gitlab/unicorn"
+
+### **Only change these settings if you understand well what they mean**
+###! Docs: https://about.gitlab.com/2015/06/05/how-gitlab-uses-unicorn-and-unicorn-worker-killer/
+###!       https://github.com/kzk/unicorn-worker-killer
+# unicorn['worker_memory_limit_min'] = "400 * 1 << 20"
+# unicorn['worker_memory_limit_max'] = "650 * 1 << 20"
+
+################################################################################
+## GitLab Sidekiq
+################################################################################
+
+# sidekiq['log_directory'] = "/var/log/gitlab/sidekiq"
+# sidekiq['shutdown_timeout'] = 4
+# sidekiq['concurrency'] = 25
+
+################################################################################
+## gitlab-shell
+################################################################################
+
+# gitlab_shell['audit_usernames'] = false
+# gitlab_shell['log_level'] = 'INFO'
+# gitlab_shell['http_settings'] = { user: 'username', password: 'password', ca_file: '/etc/ssl/cert.pem', ca_path: '/etc/pki/tls/certs', self_signed_cert: false}
+# gitlab_shell['log_directory'] = "/var/log/gitlab/gitlab-shell/"
+# gitlab_shell['custom_hooks_dir'] = "/opt/gitlab/embedded/service/gitlab-shell/hooks"
+
+# gitlab_shell['auth_file'] = "/var/opt/gitlab/.ssh/authorized_keys"
+
+### Git trace log file.
+###! If set, git commands receive GIT_TRACE* environment variables
+###! Docs: https://git-scm.com/book/es/v2/Git-Internals-Environment-Variables#Debugging
+###! An absolute path starting with /  the trace output will be appended to
+###! that file. It needs to exist so we can check permissions and avoid
+###! throwing warnings to the users.
+# gitlab_shell['git_trace_log_file'] = "/var/log/gitlab/gitlab-shell/gitlab-shell-git-trace.log"
+
+##! **We do not recommend changing this directory.**
+# gitlab_shell['dir'] = "/var/opt/gitlab/gitlab-shell"
+
+################################################################
+## GitLab PostgreSQL
+################################################################
+
+###! Changing any of these settings requires a restart of postgresql.
+###! By default, reconfigure reloads postgresql if it is running. If you
+###! change any of these settings, be sure to run `gitlab-ctl restart postgresql`
+###! after reconfigure in order for the changes to take effect.
+# postgresql['enable'] = true
+# postgresql['listen_address'] = nil
+# postgresql['port'] = 5432
+# postgresql['data_dir'] = "/var/opt/gitlab/postgresql/data"
+
+##! **recommend value is 1/4 of total RAM, up to 14GB.**
+# postgresql['shared_buffers'] = "256MB"
+
+### Advanced settings
+# postgresql['ha'] = false
+# postgresql['dir'] = "/var/opt/gitlab/postgresql"
+# postgresql['log_directory'] = "/var/log/gitlab/postgresql"
+# postgresql['username'] = "gitlab-psql"
+# postgresql['uid'] = nil
+# postgresql['gid'] = nil
+# postgresql['shell'] = "/bin/sh"
+# postgresql['home'] = "/var/opt/gitlab/postgresql"
+# postgresql['user_path'] = "/opt/gitlab/embedded/bin:/opt/gitlab/bin:$PATH"
+# postgresql['sql_user'] = "gitlab"
+# postgresql['max_connections'] = 200
+# postgresql['md5_auth_cidr_addresses'] = []
+# postgresql['trust_auth_cidr_addresses'] = []
+# postgresql['wal_buffers'] = "-1"
+# postgresql['autovacuum_max_workers'] = "3"
+# postgresql['autovacuum_freeze_max_age'] = "200000000"
+# postgresql['track_activity_query_size'] = "1024"
+# postgresql['shared_preload_libraries'] = nil
+# postgresql['dynamic_shared_memory_type'] = nil
+# postgresql['hot_standby'] = "off"
+
+### Replication settings
+###! Note, some replication settings do not require a full restart. They are documented below.
+# postgresql['wal_level'] = "hot_standby"
+# postgresql['max_wal_senders'] = 5
+# postgresql['max_replication_slots'] = 0
+# postgresql['max_locks_per_transaction'] = 128
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_mode'] = "off"
+
+###! Changing any of these settings only requires a reload of postgresql. You do not need to
+###! restart postgresql if you change any of these and run reconfigure.
+# postgresql['work_mem'] = "16MB"
+# postgresql['maintenance_work_mem'] = "16MB"
+# postgresql['checkpoint_segments'] = 10
+# postgresql['checkpoint_timeout'] = "5min"
+# postgresql['checkpoint_completion_target'] = 0.9
+# postgresql['checkpoint_warning'] = "30s"
+# postgresql['effective_cache_size'] = "1MB"
+# postgresql['shmmax'] =  17179869184 # or 4294967295
+# postgresql['shmall'] =  4194304 # or 1048575
+# postgresql['autovacuum'] = "on"
+# postgresql['log_autovacuum_min_duration'] = "-1"
+# postgresql['autovacuum_naptime'] = "1min"
+# postgresql['autovacuum_vacuum_threshold'] = "50"
+# postgresql['autovacuum_analyze_threshold'] = "50"
+# postgresql['autovacuum_vacuum_scale_factor'] = "0.02"
+# postgresql['autovacuum_analyze_scale_factor'] = "0.01"
+# postgresql['autovacuum_vacuum_cost_delay'] = "20ms"
+# postgresql['autovacuum_vacuum_cost_limit'] = "-1"
+# postgresql['statement_timeout'] = "60000"
+# postgresql['idle_in_transaction_session_timeout'] = "60000"
+# postgresql['log_line_prefix'] = "%a"
+
+### Available in PostgreSQL 9.6 and later
+# postgresql['min_wal_size'] = 80MB
+# postgresql['max_wal_size'] = 1GB
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_command'] = nil
+# default['gitlab']['postgresql']['archive_timeout'] = "60"
+
+### Replication settings
+# postgresql['sql_replication_user'] = "gitlab_replicator"
+# postgresql['wal_keep_segments'] = 10
+# postgresql['max_standby_archive_delay'] = "30s"
+# postgresql['max_standby_streaming_delay'] = "30s"
+# postgresql['synchronous_commit'] = on
+# postgresql['synchronous_standby_names'] = ''
+# postgresql['hot_standby_feedback'] = 'off'
+# postgresql['random_page_cost'] = 2.0
+# postgresql['log_temp_files'] = -1
+# postgresql['log_checkpoints'] = 'off'
+# To add custom entries to pg_hba.conf use the following
+# postgresql['custom_pg_hba_entries'][APPLICATION] = { # APPLICATION should identify what the settings are used for
+#   type: example,
+#   database: example,
+#   user: example,
+#   cidr: example,
+#   method: example,
+#   option: exmple
+# }
+# See https://www.postgresql.org/docs/9.6/static/auth-pg-hba-conf.html for an explanation
+# of the values
+
+
+################################################################################
+## GitLab Redis
+##! **Can be disabled if you are using your own Redis instance.**
+##! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+################################################################################
+
+# redis['enable'] = true
+# redis['username'] = "gitlab-redis"
+# redis['maxclients'] = "10000"
+# redis['tcp_timeout'] = "60"
+# redis['tcp_keepalive'] = "300"
+# redis['uid'] = nil
+# redis['gid'] = nil
+
+###! **To enable only Redis service in this machine, uncomment
+###!   one of the lines below (choose master or slave instance types).**
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+###!       https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_master_role['enable'] = true
+# redis_slave_role['enable'] = true
+
+### Redis TCP support (will disable UNIX socket transport)
+# redis['bind'] = '0.0.0.0' # or specify an IP to bind to a single one
+# redis['port'] = 6379
+# redis['password'] = 'redis-password-goes-here'
+
+### Redis Sentinel support
+###! **You need a master slave Redis replication to be able to do failover**
+###! **Please read the documentation before enabling it to understand the
+###!   caveats:**
+###! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+
+### Replication support
+#### Slave Redis instance
+# redis['master'] = false # by default this is true
+
+#### Slave and Sentinel shared configuration
+####! **Both need to point to the master Redis instance to get replication and
+####!   heartbeat monitoring**
+# redis['master_name'] = 'gitlab-redis'
+# redis['master_ip'] = nil
+# redis['master_port'] = 6379
+
+####! **Master password should have the same value defined in
+####!   redis['password'] to enable the instance to transition to/from
+####!   master/slave in a failover event.**
+# redis['master_password'] = 'redis-password-goes-here'
+
+####! Increase these values when your slaves can't catch up with master
+# redis['client_output_buffer_limit_normal'] = '0 0 0'
+# redis['client_output_buffer_limit_slave'] = '256mb 64mb 60'
+# redis['client_output_buffer_limit_pubsub'] = '32mb 8mb 60'
+
+################################################################################
+## GitLab Web server
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#using-a-non-bundled-web-server
+################################################################################
+
+##! When bundled nginx is disabled we need to add the external webserver user to
+##! the GitLab webserver group.
+# web_server['external_users'] = []
+# web_server['username'] = 'gitlab-www'
+# web_server['group'] = 'gitlab-www'
+# web_server['uid'] = nil
+# web_server['gid'] = nil
+# web_server['shell'] = '/bin/false'
+# web_server['home'] = '/var/opt/gitlab/nginx'
+
+################################################################################
+## GitLab NGINX
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html
+################################################################################
+
+nginx['enable'] = true
+# nginx['client_max_body_size'] = '250m'
+nginx['redirect_http_to_https'] = true
+# nginx['redirect_http_to_https_port'] = 80
+
+##! Most root CA's are included by default
+# nginx['ssl_client_certificate'] = "/etc/gitlab/ssl/ca.crt"
+
+##! enable/disable 2-way SSL client authentication
+# nginx['ssl_verify_client'] = "off"
+
+##! if ssl_verify_client on, verification depth in the client certificates chain
+# nginx['ssl_verify_depth'] = "1"
+
+nginx['ssl_certificate'] = "/etc/gitlab/ssl/nginx.crt"
+nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/nginx.key"
+# nginx['ssl_ciphers'] = "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"
+# nginx['ssl_prefer_server_ciphers'] = "on"
+
+##! **Recommended by: https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html
+##!                   https://cipherli.st/**
+# nginx['ssl_protocols'] = "TLSv1 TLSv1.1 TLSv1.2"
+
+##! **Recommended in: https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_cache'] = "builtin:1000  shared:SSL:10m"
+
+##! **Default according to https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_timeout'] = "5m"
+
+nginx['ssl_dhparam'] = "/etc/gitlab/ssl/dhparam.pem" # Path to dhparams.pem, eg. /etc/gitlab/ssl/dhparams.pem
+# nginx['listen_addresses'] = ['*', '[::]']
+
+##! **Defaults to forcing web browsers to always communicate using only HTTPS**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-http-strict-transport-security
+# nginx['hsts_max_age'] = 31536000
+# nginx['hsts_include_subdomains'] = false
+
+##! **Override only if you use a reverse proxy**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-the-nginx-listen-port
+nginx['listen_port'] = 443
+
+##! **Override only if your reverse proxy internally communicates over HTTP**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#supporting-proxied-ssl
+# nginx['listen_https'] = nil
+
+# nginx['custom_gitlab_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# nginx['custom_nginx_config'] = "include /etc/nginx/conf.d/example.conf;"
+# nginx['proxy_read_timeout'] = 3600
+# nginx['proxy_connect_timeout'] = 300
+# nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host_with_default",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on",
+#  "Upgrade" => "$http_upgrade",
+#  "Connection" => "$connection_upgrade"
+# }
+# nginx['proxy_cache_path'] = 'proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2'
+# nginx['proxy_cache'] = 'gitlab'
+# nginx['http2_enabled'] = true
+# nginx['real_ip_trusted_addresses'] = []
+# nginx['real_ip_header'] = nil
+# nginx['real_ip_recursive'] = nil
+# nginx['custom_error_pages'] = {
+#   '404' => {
+#     'title' => 'Example title',
+#     'header' => 'Example header',
+#     'message' => 'Example message'
+#   }
+# }
+
+### Advanced settings
+# nginx['dir'] = "/var/opt/gitlab/nginx"
+# nginx['log_directory'] = "/var/log/gitlab/nginx"
+# nginx['worker_processes'] = 4
+# nginx['worker_connections'] = 10240
+# nginx['log_format'] = '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"'
+# nginx['sendfile'] = 'on'
+# nginx['tcp_nopush'] = 'on'
+# nginx['tcp_nodelay'] = 'on'
+# nginx['gzip'] = "on"
+# nginx['gzip_http_version'] = "1.0"
+# nginx['gzip_comp_level'] = "2"
+# nginx['gzip_proxied'] = "any"
+# nginx['gzip_types'] = [ "text/plain", "text/css", "application/x-javascript", "text/xml", "application/xml", "application/xml+rss", "text/javascript", "application/json" ]
+# nginx['keepalive_timeout'] = 65
+# nginx['cache_max_size'] = '5000m'
+# nginx['server_names_hash_bucket_size'] = 64
+
+### Nginx status
+# nginx['status'] = {
+#  "enable" => true,
+#  "listen_addresses" => ["127.0.0.1"],
+#  "fqdn" => "dev.example.com",
+#  "port" => 9999,
+#  "options" => {
+#    "stub_status" => "on", # Turn on stats
+#    "server_tokens" => "off", # Don't show the version of NGINX
+#    "access_log" => "off", # Disable logs for stats
+#    "allow" => "127.0.0.1", # Only allow access from localhost
+#    "deny" => "all" # Deny access to anyone else
+#  }
+# }
+
+################################################################################
+## GitLab Logging
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html
+################################################################################
+
+# logging['svlogd_size'] = 200 * 1024 * 1024 # rotate after 200 MB of log data
+# logging['svlogd_num'] = 30 # keep 30 rotated log files
+# logging['svlogd_timeout'] = 24 * 60 * 60 # rotate after 24 hours
+# logging['svlogd_filter'] = "gzip" # compress logs with gzip
+# logging['svlogd_udp'] = nil # transmit log messages via UDP
+# logging['svlogd_prefix'] = nil # custom prefix for log messages
+# logging['logrotate_frequency'] = "daily" # rotate logs daily
+# logging['logrotate_size'] = nil # do not rotate by size by default
+# logging['logrotate_rotate'] = 30 # keep 30 rotated logs
+# logging['logrotate_compress'] = "compress" # see 'man logrotate'
+# logging['logrotate_method'] = "copytruncate" # see 'man logrotate'
+# logging['logrotate_postrotate'] = nil # no postrotate command by default
+# logging['logrotate_dateformat'] = nil # use date extensions for rotated files rather than numbers e.g. a value of "-%Y-%m-%d" would give rotated files like production.log-2016-03-09.gz
+
+### UDP log forwarding
+##! Docs: http://docs.gitlab.com/omnibus/settings/logs.html#udp-log-forwarding
+
+##! remote host to ship log messages to via UDP
+# logging['udp_log_shipping_host'] = nil
+
+##! remote port to ship log messages to via UDP
+# logging['udp_log_shipping_port'] = 514
+
+################################################################################
+## Logrotate
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html#logrotate
+##! You can disable built in logrotate feature.
+################################################################################
+# logrotate['enable'] = true
+
+################################################################################
+## Users and groups accounts
+##! Disable management of users and groups accounts.
+##! **Set only if creating accounts manually**
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-user-and-group-account-management
+################################################################################
+
+# manage_accounts['enable'] = false
+
+################################################################################
+## Storage directories
+##! Disable managing storage directories
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-storage-directories-management
+################################################################################
+
+##! **Set only if the select directories are created manually**
+# manage_storage_directories['enable'] = false
+# manage_storage_directories['manage_etc'] = false
+
+################################################################################
+## Runtime directory
+##! Docs: https://docs.gitlab.com//omnibus/settings/configuration.html#configuring-runtime-directory
+################################################################################
+
+# runtime_dir '/run'
+
+################################################################################
+## Git
+##! Advanced setting for configuring git system settings for omnibus-gitlab
+##! internal git
+################################################################################
+
+##! For multiple options under one header use array of comma separated values,
+##! eg.:
+##! { "receive" => ["fsckObjects = true"], "alias" => ["st = status", "co = checkout"] }
+
+# omnibus_gitconfig['system'] = {
+#  "pack" => ["threads = 1"],
+#  "receive" => ["fsckObjects = true"],
+#  "repack" => ["writeBitmaps = true"],
+#  "transfer" => ["hideRefs=^refs/tmp/", "hideRefs=^refs/keep-around/"],
+# }
+
+################################################################################
+## GitLab Pages
+##! Docs: https://docs.gitlab.com/ce/pages/administration.html
+################################################################################
+
+##! Define to enable GitLab Pages
+# pages_external_url "http://pages.example.com/"
+# gitlab_pages['enable'] = false
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTP
+# gitlab_pages['external_http'] = []
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTPS
+# gitlab_pages['external_https'] = []
+
+# gitlab_pages['listen_proxy'] = "localhost:8090"
+# gitlab_pages['redirect_http'] = true
+# gitlab_pages['use_http2'] = true
+# gitlab_pages['dir'] = "/var/opt/gitlab/gitlab-pages"
+# gitlab_pages['log_directory'] = "/var/log/gitlab/gitlab-pages"
+
+##! Prometheus metrics for Pages docs: https://gitlab.com/gitlab-org/gitlab-pages/#enable-prometheus-metrics
+# gitlab_pages['metrics_address'] = ":9235"
+
+################################################################################
+## GitLab Pages NGINX
+################################################################################
+
+# All the settings defined in the "GitLab Nginx" section are also available in this "GitLab Pages NGINX" section
+# You just have to change the key "nginx['some_settings']" with "pages_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "GitLab Pages NGINX"
+# pages_nginx['enable'] = false
+
+# gitlab_rails['pages_path'] = "/mnt/storage/pages"
+
+################################################################################
+## GitLab CI
+##! Docs: https://docs.gitlab.com/ce/ci/quick_start/README.html
+################################################################################
+
+# gitlab_ci['gitlab_ci_all_broken_builds'] = true
+# gitlab_ci['gitlab_ci_add_pusher'] = true
+# gitlab_ci['builds_directory'] = '/var/opt/gitlab/gitlab-ci/builds'
+
+################################################################################
+## GitLab Mattermost
+##! Docs: https://docs.gitlab.com/omnibus/gitlab-mattermost
+################################################################################
+
+# mattermost_external_url 'http://mattermost.example.com'
+
+# mattermost['enable'] = false
+# mattermost['username'] = 'mattermost'
+# mattermost['group'] = 'mattermost'
+# mattermost['uid'] = nil
+# mattermost['gid'] = nil
+# mattermost['home'] = '/var/opt/gitlab/mattermost'
+# mattermost['database_name'] = 'mattermost_production'
+
+# mattermost['service_use_ssl'] = false
+# mattermost['service_address'] = "127.0.0.1"
+# mattermost['service_port'] = "8065"
+# mattermost['service_site_url'] = nil
+# mattermost['service_maximum_login_attempts'] = 10
+# mattermost['service_google_developer_key'] = nil
+# mattermost['service_enable_incoming_webhooks'] = true
+# mattermost['service_enable_post_username_override'] = true
+# mattermost['service_enable_post_icon_override'] = true
+# mattermost['service_enable_testing'] = false
+# mattermost['service_enable_security_fix_alert'] = true
+# mattermost['service_enable_insecure_outgoing_connections'] = false
+# mattermost['service_allow_cors_from'] = ""
+# mattermost['service_enable_outgoing_webhooks'] = true
+# mattermost['service_enable_commands'] = true
+# mattermost['service_enable_custom_emoji'] = false
+# mattermost['service_enable_only_admin_integrations'] = true
+# mattermost['service_enable_oauth_service_provider'] = false
+# mattermost['service_enable_developer'] = false
+# mattermost['service_session_length_web_in_days'] = 30
+# mattermost['service_session_length_mobile_in_days'] = 30
+# mattermost['service_session_length_sso_in_days'] = 30
+# mattermost['service_session_cache_in_minutes'] = 10
+# mattermost['service_connection_security'] = nil
+# mattermost['service_tls_cert_file'] = nil
+# mattermost['service_tls_key_file'] = nil
+# mattermost['service_use_lets_encrypt'] = false
+# mattermost['service_lets_encrypt_cert_cache_file'] = "./config/letsencrypt.cache"
+# mattermost['service_forward_80_to_443'] = false
+# mattermost['service_read_timeout'] = 300
+# mattermost['service_write_timeout'] = 300
+# mattermost['service_time_between_user_typing_updates_milliseconds'] = 5000
+# mattermost['service_enable_link_previews'] = false
+# mattermost['service_enable_user_typing_messages'] = true
+# mattermost['service_enable_post_search'] = true
+# mattermost['service_enable_user_statuses'] = true
+# mattermost['service_enable_emoji_picker'] = true
+# mattermost['service_enable_channel_viewed_messages'] = true
+# mattermost['service_enable_apiv3'] = true
+# mattermost['service_goroutine_health_threshold'] = -1
+# mattermost['service_user_access_tokens'] = false
+
+# mattermost['team_site_name'] = "GitLab Mattermost"
+# mattermost['team_max_users_per_team'] = 150
+# mattermost['team_enable_team_creation'] = true
+# mattermost['team_enable_user_creation'] = true
+# mattermost['team_enable_open_server'] = false
+# mattermost['team_allow_public_link'] = true
+# mattermost['team_allow_valet_default'] = false
+# mattermost['team_restrict_creation_to_domains'] = "gmail.com"
+# mattermost['team_restrict_team_names'] = true
+# mattermost['team_restrict_direct_message'] = "any"
+# mattermost['team_max_channels_per_team'] = 2000
+# mattermost['team_user_status_away_timeout'] = 300
+# mattermost['team_teammate_name_display'] = "full_name"
+
+# mattermost['sql_driver_name'] = 'mysql'
+# mattermost['sql_data_source'] = "mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"
+# mattermost['sql_data_source_replicas'] = ["mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"]
+# mattermost['sql_max_idle_conns'] = 10
+# mattermost['sql_max_open_conns'] = 10
+# mattermost['sql_trace'] = false
+# mattermost['sql_data_source_search_replicas'] = []
+# mattermost['sql_query_timeout'] = 30
+
+
+# mattermost['log_file_directory'] = '/var/log/gitlab/mattermost'
+# mattermost['log_console_enable'] = true
+# mattermost['log_console_level'] = 'INFO'
+# mattermost['log_enable_file'] = false
+# mattermost['log_file_level'] = 'INFO'
+# mattermost['log_file_format'] = nil
+# mattermost['log_enable_diagnostics'] = true
+
+# mattermost['gitlab_enable'] = false
+# mattermost['gitlab_id'] = "12345656"
+# mattermost['gitlab_secret'] = "123456789"
+# mattermost['gitlab_scope'] = ""
+# mattermost['gitlab_auth_endpoint'] = "http://gitlab.example.com/oauth/authorize"
+# mattermost['gitlab_token_endpoint'] = "http://gitlab.example.com/oauth/token"
+# mattermost['gitlab_user_api_endpoint'] = "http://gitlab.example.com/api/v4/user"
+
+# mattermost['aws'] = {'S3AccessKeyId' => '123', 'S3SecretAccessKey' => '123', 'S3Bucket' => 'aa', 'S3Region' => 'bb'}
+
+# mattermost['email_enable_sign_up_with_email'] = true
+# mattermost['email_enable_sign_in_with_email'] = true
+# mattermost['email_enable_sign_in_with_username'] = false
+# mattermost['email_send_email_notifications'] = false
+# mattermost['email_require_email_verification'] = false
+# mattermost['email_smtp_username'] = nil
+# mattermost['email_smtp_password'] = nil
+# mattermost['email_smtp_server'] = nil
+# mattermost['email_smtp_port'] = nil
+# mattermost['email_connection_security'] = nil
+# mattermost['email_feedback_name'] = nil
+# mattermost['email_feedback_email'] = nil
+# mattermost['email_feedback_organization'] = nil
+# mattermost['email_send_push_notifications'] = true
+# mattermost['email_push_notification_server'] = ""
+# mattermost['email_push_notification_contents'] = "generic"
+# mattermost['email_enable_batching'] = false
+# mattermost['email_batching_buffer_size'] = 256
+# mattermost['email_batching_interval'] = 30
+# mattermost['email_skip_server_certificate_verification'] = false
+# mattermost['email_smtp_auth'] = false
+# mattermost['email_notification_content_type'] = "full"
+
+# mattermost['file_max_file_size'] = 52428800
+# mattermost['file_driver_name'] = "local"
+# mattermost['file_directory'] = "/var/opt/gitlab/mattermost/data"
+# mattermost['file_enable_public_link'] = true
+# mattermost['file_initial_font'] = 'luximbi.ttf'
+# mattermost['file_amazon_s3_access_key_id'] = nil
+# mattermost['file_amazon_s3_bucket'] = nil
+# mattermost['file_amazon_s3_secret_access_key'] = nil
+# mattermost['file_amazon_s3_region'] = nil
+# mattermost["file_amazon_s3_endpoint"] = nil
+# mattermost["file_amazon_s3_bucket_endpoint"] = nil
+# mattermost["file_amazon_s3_location_constraint"] = false
+# mattermost["file_amazon_s3_lowercase_bucket"] = false
+# mattermost["file_amazon_s3_ssl"] = true
+# mattermost["file_amazon_s3_sign_v2"] = false
+# mattermost['file_enable_file_attachments'] = true
+
+# mattermost['ratelimit_enable_rate_limiter'] = false
+# mattermost['ratelimit_per_sec'] = 10
+# mattermost['ratelimit_memory_store_size'] = 10000
+# mattermost['ratelimit_vary_by_remote_addr'] = true
+# mattermost['ratelimit_vary_by_header'] = nil
+# mattermost['ratelimit_max_burst'] = 100
+
+# mattermost['support_terms_of_service_link'] = "/static/help/terms.html"
+# mattermost['support_privacy_policy_link'] = "/static/help/privacy.html"
+# mattermost['support_about_link'] = "/static/help/about.html"
+# mattermost['support_report_a_problem_link'] =  "/static/help/report_problem.html"
+# mattermost['support_email'] =  "support@example.com"
+
+# mattermost['privacy_show_email_address'] = true
+# mattermost['privacy_show_full_name'] = true
+
+# mattermost['localization_server_locale'] = "en"
+# mattermost['localization_client_locale'] = "en"
+# mattermost['localization_available_locales'] = "en,es,fr,ja,pt-BR"
+
+# mattermost['webrtc_enable'] = false
+# mattermost['webrtc_gateway_websocket_url'] = nil
+# mattermost['webrtc_gateway_admin_url'] = nil
+# mattermost['webrtc_gateway_admin_secret'] = nil
+# mattermost['webrtc_gateway_stun_uri'] = nil
+# mattermost['webrtc_gateway_turn_uri'] = nil
+# mattermost['webrtc_gateway_turn_username'] = nil
+# mattermost['webrtc_gateway_turn_shared_key'] = nil
+
+################################################################################
+## Mattermost NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Mattermost NGINX" section
+# You just have to change the key "nginx['some_settings']" with "mattermost_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Mattermost NGINX"
+# mattermost_nginx['enable'] = false
+
+# mattermost_nginx['custom_gitlab_mattermost_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# mattermost_nginx['proxy_set_headers'] = {
+#   "Host" => "$http_host",
+#   "X-Real-IP" => "$remote_addr",
+#   "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#   "X-Frame-Options" => "SAMEORIGIN",
+#   "X-Forwarded-Proto" => "https",
+#   "X-Forwarded-Ssl" => "on",
+#   "Upgrade" => "$http_upgrade",
+#   "Connection" => "$connection_upgrade"
+# }
+
+
+################################################################################
+## Registry NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Registry NGINX" section
+# You just have to change the key "nginx['some_settings']" with "registry_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Registry NGINX"
+# registry_nginx['enable'] = false
+
+# registry_nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on"
+# }
+
+################################################################################
+## Prometheus
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/
+################################################################################
+
+# prometheus['enable'] = true
+# prometheus['monitor_kubernetes'] = true
+# prometheus['username'] = 'gitlab-prometheus'
+# prometheus['uid'] = nil
+# prometheus['gid'] = nil
+# prometheus['shell'] = '/bin/sh'
+# prometheus['home'] = '/var/opt/gitlab/prometheus'
+# prometheus['log_directory'] = '/var/log/gitlab/prometheus'
+# prometheus['scrape_interval'] = 15
+# prometheus['scrape_timeout'] = 15
+# prometheus['chunk_encoding_version'] = 2
+#
+### Custom scrape configs
+#
+# Prometheus can scrape additional jobs via scrape_configs.  The default automatically
+# includes all of the exporters supported by the omnibus config.
+#
+# See: https://prometheus.io/docs/operating/configuration/#<scrape_config>
+#
+# Example:
+#
+# prometheus['scrape_configs'] = [
+#   {
+#     'job_name': 'example',
+#     'static_configs' => [
+#       'targets' => ['hostname:port'],
+#     ],
+#   },
+# ]
+#
+### Prometheus Memory Management
+#
+# Prometheus needs to be configured for how much memory is used.
+# * This sets the target heap size.
+# * This value accounts for approximately 2/3 of the memory used by the server.
+# * The recommended memory is 4kb per unique metrics time-series.
+# See: https://prometheus.io/docs/operating/storage/#memory-usage
+#
+# prometheus['target_heap_size'] = (
+#   # Use 25mb + 2% of total memory for Prometheus memory.
+#   26_214_400 + (node['memory']['total'].to_i * 1024 * 0.02 )
+# ).to_i
+#
+# prometheus['flags'] = {
+#   'storage.local.path' => "#{node['gitlab']['prometheus']['home']}/data",
+#   'storage.local.chunk-encoding-version' => user_config['chunk-encoding-version'],
+#   'storage.local.target-heap-size' => node['gitlab']['prometheus']['target-heap-size'],
+#   'config.file' => "#{node['gitlab']['prometheus']['home']}/prometheus.yml"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# prometheus['listen_address'] = 'localhost:9090'
+
+################################################################################
+## Prometheus Node Exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/node_exporter.html
+################################################################################
+
+# node_exporter['enable'] = true
+# node_exporter['home'] = '/var/opt/gitlab/node-exporter'
+# node_exporter['log_directory'] = '/var/log/gitlab/node-exporter'
+# node_exporter['flags'] = {
+#   'collector.textfile.directory' => "#{node['gitlab']['node-exporter']['home']}/textfile_collector"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# node_exporter['listen_address'] = 'localhost:9100'
+
+################################################################################
+## Prometheus Redis exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/redis_exporter.html
+################################################################################
+
+# redis_exporter['enable'] = true
+# redis_exporter['log_directory'] = '/var/log/gitlab/redis-exporter'
+# redis_exporter['flags'] = {
+#   'redis.addr' => "unix://#{node['gitlab']['gitlab-rails']['redis_socket']}",
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# redis_exporter['listen_address'] = 'localhost:9121'
+
+################################################################################
+## Prometheus Postgres exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/postgres_exporter.html
+################################################################################
+
+# postgres_exporter['enable'] = true
+# postgres_exporter['home'] = '/var/opt/gitlab/postgres-exporter'
+# postgres_exporter['log_directory'] = '/var/log/gitlab/postgres-exporter'
+# postgres_exporter['flags'] = {}
+# postgres_exporter['listen_address'] = 'localhost:9187'
+
+################################################################################
+## Prometheus Gitlab monitor
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/gitlab_monitor_exporter.html
+################################################################################
+
+
+# gitlab_monitor['enable'] = true
+# gitlab_monitor['log_directory'] = "/var/log/gitlab/gitlab-monitor"
+# gitlab_monitor['home'] = "/var/opt/gitlab/gitlab-monitor"
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# gitlab_monitor['listen_address'] = 'localhost'
+# gitlab_monitor['listen_port'] = '9168'
+
+# To completely disable prometheus, and all of it's exporters, set to false
+# prometheus_monitoring['enable'] = true
+
+################################################################################
+## Gitaly
+##! Docs:
+################################################################################
+
+
+# gitaly['enable'] = false
+# gitaly['dir'] = "/var/opt/gitlab/gitaly"
+# gitaly['log_directory'] = "/var/log/gitlab/gitaly"
+# gitaly['bin_path'] = "/opt/gitlab/embedded/bin/gitaly"
+# gitaly['env_directory'] = "/opt/gitlab/etc/gitaly"
+# gitaly['env'] = {
+#  'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin",
+#  'HOME' => '/var/opt/gitlab'
+# }
+# gitaly['socket_path'] = "/var/opt/gitlab/gitaly/gitaly.socket"
+# gitaly['listen_addr'] = "localhost:8075"
+# gitaly['prometheus_listen_addr'] = "localhost:9175"
+# gitaly['logging_format'] = "json"
+# gitaly['logging_sentry_dsn'] = "https://<key>:<secret>@sentry.io/<project>"
+# gitaly['prometheus_grpc_latency_buckets'] = "[0.001, 0.005, 0.025, 0.1, 0.5, 1.0, 10.0, 30.0, 60.0, 300.0, 1500.0]"
+# gitaly['auth_token'] = '<secret>'
+# gitaly['auth_transitioning'] = false # When true, auth is logged to Prometheus but NOT enforced
+
+
+################################################################################
+################################################################################
+##                  Configuration Settings for GitLab EE only                 ##
+################################################################################
+################################################################################
+
+
+################################################################################
+## Auxiliary cron jobs applicable to GitLab EE only
+################################################################################
+#
+# gitlab_rails['geo_bulk_notify_worker_cron'] = "*/10 * * * * *"
+# gitlab_rails['geo_file_download_dispatch_worker_cron'] = "*/10 * * * *"
+# gitlab_rails['geo_repository_sync_worker_cron'] = "*/5 * * * *"
+# gitlab_rails['ldap_sync_worker_cron'] = "30 1 * * *"
+# gitlab_rails['ldap_group_sync_worker_cron'] = "0 * * * *"
+# gitlab_rails['historical_data_worker_cron'] = "0 12 * * *"
+
+################################################################################
+## Kerberos (EE Only)
+##! Docs: https://docs.gitlab.com/ee/integration/kerberos.html#http-git-access
+################################################################################
+
+# gitlab_rails['kerberos_enabled'] = true
+# gitlab_rails['kerberos_keytab'] = /etc/http.keytab
+# gitlab_rails['kerberos_service_principal_name'] = HTTP/gitlab.example.com@EXAMPLE.COM
+# gitlab_rails['kerberos_use_dedicated_port'] = true
+# gitlab_rails['kerberos_port'] = 8443
+# gitlab_rails['kerberos_https'] = true
+
+################################################################################
+## GitLab Sentinel (EE Only)
+##! Docs: http://docs.gitlab.com/ce/administration/high_availability/redis.html#high-availability-with-sentinel
+################################################################################
+
+##! **Make sure you configured all redis['master_*'] keys above before
+##!   continuing.**
+
+##! To enable Sentinel and disable all other services in this machine,
+##! uncomment the line below (if you've enabled Redis role, it will keep it).
+##! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_sentinel_role['enable'] = true
+
+# sentinel['enable'] = true
+
+##! Bind to all interfaces, uncomment to specify an IP and bind to a single one
+# sentinel['bind'] = '0.0.0.0'
+
+##! Uncomment to change default port
+# sentinel['port'] = 26379
+
+##! Quorum must reflect the amount of voting sentinels it take to start a
+##! failover.
+##! **Value must NOT be greater then the amount of sentinels.**
+##! The quorum can be used to tune Sentinel in two ways:
+##! 1. If a the quorum is set to a value smaller than the majority of Sentinels
+##!    we deploy, we are basically making Sentinel more sensible to master
+##!    failures, triggering a failover as soon as even just a minority of
+##!    Sentinels is no longer able to talk with the master.
+##! 2. If a quorum is set to a value greater than the majority of Sentinels, we
+##!    are making Sentinel able to failover only when there are a very large
+##!    number (larger than majority) of well connected Sentinels which agree
+##!    about the master being down.
+# sentinel['quorum'] = 1
+
+### Consider unresponsive server down after x amount of ms.
+# sentinel['down_after_milliseconds'] = 10000
+
+### Specifies the failover timeout in milliseconds.
+##! It is used in many ways:
+##!
+##! - The time needed to re-start a failover after a previous failover was
+##!   already tried against the same master by a given Sentinel, is two
+##!   times the failover timeout.
+##!
+##! - The time needed for a slave replicating to a wrong master according
+##!   to a Sentinel current configuration, to be forced to replicate
+##!   with the right master, is exactly the failover timeout (counting since
+##!   the moment a Sentinel detected the misconfiguration).
+##!
+##! - The time needed to cancel a failover that is already in progress but
+##!   did not produced any configuration change (SLAVEOF NO ONE yet not
+##!   acknowledged by the promoted slave).
+##!
+##! - The maximum time a failover in progress waits for all the slaves to be
+##!   reconfigured as slaves of the new master. However even after this time
+##!   the slaves will be reconfigured by the Sentinels anyway, but not with
+##!   the exact parallel-syncs progression as specified.
+# sentinel['failover_timeout'] = 60000
+
+################################################################################
+## GitLab Sidekiq Cluster (EE only)
+################################################################################
+
+##! GitLab Enterprise Edition allows one to start an extra set of Sidekiq processes
+##! besides the default one. These processes can be used to consume a dedicated set
+##! of queues. This can be used to ensure certain queues always have dedicated
+##! workers, no matter the amount of jobs that need to be processed.
+
+# sidekiq_cluster['enable'] = false
+# sidekiq_cluster['ha'] = false
+# sidekiq_cluster['log_directory'] = "/var/log/gitlab/sidekiq-cluster"
+# sidekiq_cluster['interval'] = 5 # The number of seconds to wait between worker checks
+
+##! Each entry in the queue_groups array denotes a group of queues that have to be processed by a
+##! Sidekiq process. Multiple queues can be processed by the same process by
+##! separating them with a comma within the group entry
+
+# sidekiq_cluster['queue_groups'] = [
+#   "process_commit,post_receive",
+#   "gitlab_shell"
+# ]
+#
+
+##! If negate is enabled then sidekiq-cluster will process all the queues that
+##! don't match those in queue_groups.
+
+# sidekiq_cluster['negate'] = false
+
+################################################################################
+## Additional Database Settings (EE only)
+##! Docs: https://docs.gitlab.com/ee/administration/database_load_balancing.html
+################################################################################
+# gitlab_rails['db_load_balancing'] = { 'hosts' => ['secondary1.example.com'] }
+
+################################################################################
+## GitLab Geo
+##! Docs: https://docs.gitlab.com/ee/gitlab-geo
+################################################################################
+# geo_primary_role['enable'] = false
+# geo_secondary_role['enable'] = false
+
+################################################################################
+## GitLab Geo Secondary (EE only)
+################################################################################
+# geo_secondary['auto_migrate'] = true
+# geo_secondary['db_adapter'] = "postgresql"
+# geo_secondary['db_encoding'] = "unicode"
+# geo_secondary['db_collation'] = nil
+# geo_secondary['db_database'] = "gitlabhq_geo_production"
+# geo_secondary['db_pool'] = 10
+# geo_secondary['db_username'] = "gitlab_geo"
+# geo_secondary['db_password'] = nil
+# geo_secondary['db_host'] = "/var/opt/gitlab/geo-postgresql"
+# geo_secondary['db_port'] = 5431
+# geo_secondary['db_socket'] = nil
+# geo_secondary['db_sslmode'] = nil
+# geo_secondary['db_sslrootcert'] = nil
+# geo_secondary['db_sslca'] = nil
+
+################################################################################
+## GitLab Geo Secondary Tracking Database (EE only)
+################################################################################
+
+# geo_postgresql['enable'] = false
+# geo_postgresql['ha'] = false
+# geo_postgresql['dir'] = '/var/opt/gitlab/geo-postgresql'
+# geo_postgresql['data_dir'] = '/var/opt/gitlab/geo-postgresql/data'
+
+################################################################################
+# Pgbouncer (EE only)
+# See [GitLab PgBouncer documentation](http://docs.gitlab.com/omnibus/settings/database.html#enabling-pgbouncer-ee-only)
+# See the [PgBouncer page](https://pgbouncer.github.io/config.html) for details
+################################################################################
+# pgbouncer['enable'] = false
+# pgbouncer['log_directory'] = '/var/log/gitlab/pgbouncer'
+# pgbouncer['data_directory'] = '/var/opt/gitlab/pgbouncer'
+# pgbouncer['listen_addr'] = '0.0.0.0'
+# pgbouncer['listen_port'] = '6432'
+# pgbouncer['pool_mode'] = 'session'
+# pgbouncer['server_reset_query'] = 'DISCARD ALL'
+# pgbouncer['max_client_conn'] = '100'
+# pgbouncer['default_pool_size'] = '20'
+# pgbouncer['min_pool_size'] = '0'
+# pgbouncer['reserve_pool_size'] = '0'
+# pgbouncer['reserve_pool_timeout'] = '5.0'
+# pgbouncer['server_round_robin'] = '0'
+# pgbouncer['log_connections'] = '0'
+# pgbouncer['server_idle_timeout'] = '600.0'
+# pgbouncer['dns_max_ttl'] = '15.0'
+# pgbouncer['dns_zone_check_period'] = '0'
+# pgbouncer['dns_nxdomain_ttl'] = '15.0'
+# pgbouncer['admin_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['stats_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['ignore_startup_parameters'] = 'extra_float_digits'
+# pgbouncer['databases'] = {
+#   DATABASE_NAME: {
+#     host: HOSTNAME,
+#     port: PORT
+#     user: USERNAME,
+#     password: PASSWORD
+###! generate this with `echo -n '$password + $username' | md5sum`
+#   }
+#   ...
+# }
+# pgbouncer['auth_type'] = 'md5'
+# pgbouncer['auth_hba_file'] = nil
+# pgbouncer['auth_query'] = 'SELECT username, password FROM public.pg_shadow_lookup($1)'
+# pgbouncer['users'] = [
+#   {
+#     name: USERNAME,
+#     password: MD5_PASSWORD_HASH
+#   }
+# ]
+# postgresql['pgbouncer_user'] = nil
+# postgresql['pgbouncer_user_password'] = nil
+#
+
+################################################################################
+# Repmgr (EE only)
+################################################################################
+# repmgr['cluster'] = 'gitlab_cluster'
+# repmgr['database'] = 'gitlab_repmgr'
+# repmgr['host'] = nil
+# repmgr['node_number'] = nil
+# repmgr['port'] = 5432
+# repmgr['trust_auth_cidr_addresses'] = []
+# repmgr['user'] = 'gitlab_repmgr'
+
+################################################################################
+# Consul (EEP only)
+################################################################################
+# consul['enable'] = false
+# consul['dir'] = '/var/opt/gitlab/consul'
+# consul['user'] = 'gitlab-consul'
+# consul['config_file'] = '/var/opt/gitlab/consul/config.json'
+# consul['config_dir'] = '/var/opt/gitlab/consul/config.d'
+# consul['data_dir'] = '/var/opt/gitlab/consul/data'
+# consul['log_directory'] = '/var/log/gitlab/consul'
+# consul['script_directory'] = '/var/opt/gitlab/consul/scripts'
+# consul['configuration'] = {
+#   'client_addr' => nil,
+#   'datacenter' => 'gitlab_consul',
+#   'enable_script_checks' => true,
+#   'server' => false
+# }
+# consul['services'] = []
+# consul['service_config'] = {
+#   'postgresql' => {
+#     'service' => {
+#       'name' => "postgresql",
+#       'address' => '',
+#       'port' => 5432,
+#       'checks' => [
+#         {
+#           'script' => "/var/opt/gitlab/consul/scripts/check_postgresql",
+#           'interval' => "10s"
+#         }
+#       ]
+#     }
+#   }
+# }
+# consul['watchers'] = {
+#   'postgresql' => {
+#     enable: false,
+#     handler: 'failover_pgbouncer'
+#   }
+# }
diff --git a/roles/gitlab-omnibus-9/gitlab.rb.template b/roles/gitlab-omnibus-9/gitlab.rb.template
new file mode 100644
index 00000000..14cbbd37
--- /dev/null
+++ b/roles/gitlab-omnibus-9/gitlab.rb.template
@@ -0,0 +1,1622 @@
+## GitLab configuration settings
+##! This file is generated during initial installation and **is not** modified
+##! during upgrades.
+##! Check out the latest version of this file to know about the different
+##! settings that can be configured by this file, which may be found at:
+##! https://gitlab.com/gitlab-org/omnibus-gitlab/raw/master/files/gitlab-config-template/gitlab.rb.template
+
+
+## GitLab URL
+##! URL on which GitLab will be reachable.
+##! For more details on configuring external_url see:
+##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab
+external_url 'GENERATED_EXTERNAL_URL'
+
+## Legend
+##! The following notations at the beginning of each line may be used to
+##! differentiate between components of this file and to easily select them using
+##! a regex.
+##! ## Titles, subtitles etc
+##! ##! More information - Description, Docs, Links, Issues etc.
+##! Configuration settings have a single # followed by a single space at the
+##! beginning; Remove them to enable the setting.
+
+##! **Configuration settings below are optional.**
+##! **The values currently assigned are only examples and ARE NOT the default
+##!   values.**
+
+
+################################################################################
+################################################################################
+##                Configuration Settings for GitLab CE and EE                 ##
+################################################################################
+################################################################################
+
+################################################################################
+## gitlab.yml configuration
+##! Docs: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/gitlab.yml.md
+################################################################################
+# gitlab_rails['gitlab_ssh_host'] = 'ssh.host_example.com'
+# gitlab_rails['time_zone'] = 'UTC'
+
+### Email Settings
+# gitlab_rails['gitlab_email_enabled'] = true
+# gitlab_rails['gitlab_email_from'] = 'example@example.com'
+# gitlab_rails['gitlab_email_display_name'] = 'Example'
+# gitlab_rails['gitlab_email_reply_to'] = 'noreply@example.com'
+# gitlab_rails['gitlab_email_subject_suffix'] = ''
+
+### GitLab user privileges
+# gitlab_rails['gitlab_default_can_create_group'] = true
+# gitlab_rails['gitlab_username_changing_enabled'] = true
+
+### Default Theme
+# gitlab_rails['gitlab_default_theme'] = 2
+
+### Default project feature settings
+# gitlab_rails['gitlab_default_projects_features_issues'] = true
+# gitlab_rails['gitlab_default_projects_features_merge_requests'] = true
+# gitlab_rails['gitlab_default_projects_features_wiki'] = true
+# gitlab_rails['gitlab_default_projects_features_snippets'] = true
+# gitlab_rails['gitlab_default_projects_features_builds'] = true
+# gitlab_rails['gitlab_default_projects_features_container_registry'] = true
+
+### Automatic issue closing
+###! See https://docs.gitlab.com/ce/customization/issue_closing.html for more
+###! information about this pattern.
+# gitlab_rails['gitlab_issue_closing_pattern'] = "((?:[Cc]los(?:e[sd]?|ing)|[Ff]ix(?:e[sd]|ing)?|[Rr]esolv(?:e[sd]?|ing))(:?) +(?:(?:issues? +)?%{issue_ref}(?:(?:, *| +and +)?)|([A-Z][A-Z0-9_]+-\d+))+)"
+
+### Download location
+###! When a user clicks e.g. 'Download zip' on a project, a temporary zip file
+###! is created in the following directory.
+# gitlab_rails['gitlab_repository_downloads_path'] = 'tmp/repositories'
+
+### Gravatar Settings
+# gitlab_rails['gravatar_plain_url'] = 'http://www.gravatar.com/avatar/%{hash}?s=%{size}&d=identicon'
+# gitlab_rails['gravatar_ssl_url'] = 'https://secure.gravatar.com/avatar/%{hash}?s=%{size}&d=identicon'
+
+### Auxiliary jobs
+###! Periodically executed jobs, to self-heal Gitlab, do external
+###! synchronizations, etc.
+###! Docs: https://github.com/ondrejbartas/sidekiq-cron#adding-cron-job
+###!       https://docs.gitlab.com/ce/ci/yaml/README.html#artifacts:expire_in
+# gitlab_rails['stuck_ci_jobs_worker_cron'] = "0 0 * * *"
+# gitlab_rails['expire_build_artifacts_worker_cron'] = "50 * * * *"
+# gitlab_rails['pipeline_schedule_worker_cron'] = "41 * * * *"
+# gitlab_rails['repository_check_worker_cron'] = "20 * * * *"
+# gitlab_rails['admin_email_worker_cron'] = "0 0 * * 0"
+# gitlab_rails['repository_archive_cache_worker_cron'] = "0 * * * *"
+
+### Webhook Settings
+###! Number of seconds to wait for HTTP response after sending webhook HTTP POST
+###! request (default: 10)
+# gitlab_rails['webhook_timeout'] = 10
+
+### Trusted proxies
+###! Customize if you have GitLab behind a reverse proxy which is running on a
+###! different machine.
+###! **Add the IP address for your reverse proxy to the list, otherwise users
+###!   will appear signed in from that address.**
+# gitlab_rails['trusted_proxies'] = []
+
+### Monitoring settings
+###! IP whitelist controlling access to monitoring endpoints
+# gitlab_rails['monitoring_whitelist'] = ['127.0.0.0/8']
+###! Time between sampling of unicorn socket metrics, in seconds
+# gitlab_rails['monitoring_unicorn_sampler_interval'] = 10
+
+### Reply by email
+###! Allow users to comment on issues and merge requests by replying to
+###! notification emails.
+###! Docs: https://docs.gitlab.com/ce/administration/reply_by_email.html
+# gitlab_rails['incoming_email_enabled'] = true
+
+#### Incoming Email Address
+####! The email address including the `%{key}` placeholder that will be replaced
+####! to reference the item being replied to.
+####! **The placeholder can be omitted but if present, it must appear in the
+####!   "user" part of the address (before the `@`).**
+# gitlab_rails['incoming_email_address'] = "gitlab-incoming+%{key}@gmail.com"
+
+#### Email account username
+####! **With third party providers, this is usually the full email address.**
+####! **With self-hosted email servers, this is usually the user part of the
+####!   email address.**
+# gitlab_rails['incoming_email_email'] = "gitlab-incoming@gmail.com"
+
+#### Email account password
+# gitlab_rails['incoming_email_password'] = "[REDACTED]"
+
+#### IMAP Settings
+# gitlab_rails['incoming_email_host'] = "imap.gmail.com"
+# gitlab_rails['incoming_email_port'] = 993
+# gitlab_rails['incoming_email_ssl'] = true
+# gitlab_rails['incoming_email_start_tls'] = false
+
+#### Incoming Mailbox Settings
+####! The mailbox where incoming mail will end up. Usually "inbox".
+# gitlab_rails['incoming_email_mailbox_name'] = "inbox"
+####! The IDLE command timeout.
+# gitlab_rails['incoming_email_idle_timeout'] = 60
+
+### Job Artifacts
+# gitlab_rails['artifacts_enabled'] = true
+# gitlab_rails['artifacts_path'] = "/mnt/storage/artifacts"
+# gitlab_rails['artifacts_object_store_enabled'] = false
+# gitlab_rails['artifacts_object_store_remote_directory'] = "artifacts"
+# gitlab_rails['artifacts_object_store_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AWS_ACCESS_KEY_ID',
+#   'aws_secret_access_key' => 'AWS_SECRET_ACCESS_KEY'
+# }
+
+### Git LFS
+# gitlab_rails['lfs_enabled'] = true
+# gitlab_rails['lfs_storage_path'] = "/mnt/storage/lfs-objects"
+
+### Usage Statistics
+# gitlab_rails['usage_ping_enabled'] = true
+
+### GitLab Mattermost
+###! These settings are void if Mattermost is installed on the same omnibus
+###! install
+# gitlab_rails['mattermost_host'] = "https://mattermost.example.com"
+
+### LDAP Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html
+###! **Be careful not to break the indentation in the ldap_servers block. It is
+###!   in yaml format and the spaces must be retained. Using tabs will not work.**
+
+# gitlab_rails['ldap_enabled'] = false
+
+###! **remember to close this block with 'EOS' below**
+# gitlab_rails['ldap_servers'] = YAML.load <<-'EOS'
+#   main: # 'main' is the GitLab 'provider ID' of this LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+#     verify_certificates: true
+#     ca_file: ''
+#     ssl_version: ''
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+#
+#   secondary: # 'secondary' is the GitLab 'provider ID' of second LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+#     verify_certificates: true
+#     ca_file: ''
+#     ssl_version: ''
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+# EOS
+
+### OmniAuth Settings
+###! Docs: https://docs.gitlab.com/ce/integration/omniauth.html
+# gitlab_rails['omniauth_enabled'] = false
+# gitlab_rails['omniauth_allow_single_sign_on'] = ['saml']
+# gitlab_rails['omniauth_sync_email_from_provider'] = 'saml'
+# gitlab_rails['omniauth_auto_sign_in_with_provider'] = 'saml'
+# gitlab_rails['omniauth_block_auto_created_users'] = true
+# gitlab_rails['omniauth_auto_link_ldap_user'] = false
+# gitlab_rails['omniauth_auto_link_saml_user'] = false
+# gitlab_rails['omniauth_external_providers'] = ['twitter', 'google_oauth2']
+# gitlab_rails['omniauth_providers'] = [
+#   {
+#     "name" => "google_oauth2",
+#     "app_id" => "YOUR APP ID",
+#     "app_secret" => "YOUR APP SECRET",
+#     "args" => { "access_type" => "offline", "approval_prompt" => "" }
+#   }
+# ]
+
+### Backup Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/backups.html
+
+# gitlab_rails['manage_backup_path'] = true
+# gitlab_rails['backup_path'] = "/var/opt/gitlab/backups"
+
+###! Docs: https://docs.gitlab.com/ce/raketasks/backup_restore.html#backup-archive-permissions
+# gitlab_rails['backup_archive_permissions'] = 0644
+
+# gitlab_rails['backup_pg_schema'] = 'public'
+
+###! The duration in seconds to keep backups before they are allowed to be deleted
+# gitlab_rails['backup_keep_time'] = 604800
+
+# gitlab_rails['backup_upload_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AKIAKIAKI',
+#   'aws_secret_access_key' => 'secret123'
+# }
+# gitlab_rails['backup_upload_remote_directory'] = 'my.s3.bucket'
+# gitlab_rails['backup_multipart_chunk_size'] = 104857600
+
+###! **Turns on AWS Server-Side Encryption with Amazon S3-Managed Keys for
+###!   backups**
+# gitlab_rails['backup_encryption'] = 'AES256'
+
+###! **Specifies Amazon S3 storage class to use for backups. Valid values
+###!   include 'STANDARD', 'STANDARD_IA', 'GLACIER', and
+###!   'REDUCED_REDUNDANCY'**
+# gitlab_rails['backup_storage_class'] = 'STANDARD'
+
+### For setting up different data storing directory
+###! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#storing-git-data-in-an-alternative-directory
+###! **If you want to use a single non-default directory to store git data use a
+###!   path that doesn't contain symlinks.**
+# git_data_dirs({
+#   "default" => {
+#     "path" => "/mnt/nfs-01/git-data",
+#     "failure_count_threshold" => 10,
+#     "failure_wait_time" => 30,
+#     "failure_reset_time" => 1800,
+#     "storage_timeout" => 5
+#    }
+# })
+
+### Gitaly settings
+# gitlab_rails['gitaly_token'] = 'secret token'
+
+### For storing GitLab application uploads, eg. LFS objects, build artifacts
+###! Docs: https://docs.gitlab.com/ce/development/shared_files.html
+# gitlab_rails['shared_path'] = '/var/opt/gitlab/gitlab-rails/shared'
+
+### GitLab Shell settings for GitLab
+# gitlab_rails['gitlab_shell_ssh_port'] = 22
+# gitlab_rails['git_max_size'] = 20971520
+# gitlab_rails['git_timeout'] = 10
+# gitlab_rails['gitlab_shell_git_timeout'] = 800
+
+### Extra customization
+# gitlab_rails['extra_google_analytics_id'] = '_your_tracking_id'
+# gitlab_rails['extra_piwik_url'] = '_your_piwik_url'
+# gitlab_rails['extra_piwik_site_id'] = '_your_piwik_site_id'
+
+##! Docs: https://docs.gitlab.com/omnibus/settings/environment-variables.html
+# gitlab_rails['env'] = {
+#   'BUNDLE_GEMFILE' => "/opt/gitlab/embedded/service/gitlab-rails/Gemfile",
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+# gitlab_rails['rack_attack_git_basic_auth'] = {
+#   'enabled' => true,
+#   'ip_whitelist' => ["127.0.0.1"],
+#   'maxretry' => 10,
+#   'findtime' => 60,
+#   'bantime' => 3600
+# }
+
+# gitlab_rails['rack_attack_protected_paths'] = [
+#   '/users/password',
+#   '/users/sign_in',
+#   '/api/#{API::API.version}/session.json',
+#   '/api/#{API::API.version}/session',
+#   '/users',
+#   '/users/confirmation',
+#   '/unsubscribes/',
+#   '/import/github/personal_access_token'
+# ]
+
+###! **We do not recommend changing these directories.**
+# gitlab_rails['dir'] = "/var/opt/gitlab/gitlab-rails"
+# gitlab_rails['log_directory'] = "/var/log/gitlab/gitlab-rails"
+
+### GitLab application settings
+# gitlab_rails['uploads_directory'] = "/var/opt/gitlab/gitlab-rails/uploads"
+# gitlab_rails['rate_limit_requests_per_period'] = 10
+# gitlab_rails['rate_limit_period'] = 60
+
+#### Change the initial default admin password and shared runner registraion tokens.
+####! **Only applicable on initial setup, changing these settings after database
+####!   is created and seeded won't yield any change.**
+# gitlab_rails['initial_root_password'] = "password"
+# gitlab_rails['initial_shared_runners_registration_token'] = "token"
+
+#### Enable or disable automatic database migrations
+# gitlab_rails['auto_migrate'] = true
+
+#### This is advanced feature used by large gitlab deployments where loading
+#### whole RAILS env takes a lot of time.
+# gitlab_rails['rake_cache_clear'] = true
+
+### GitLab database settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/database.html
+###! **Only needed if you use an external database.**
+# gitlab_rails['db_adapter'] = "postgresql"
+# gitlab_rails['db_encoding'] = "unicode"
+# gitlab_rails['db_collation'] = nil
+# gitlab_rails['db_database'] = "gitlabhq_production"
+# gitlab_rails['db_pool'] = 10
+# gitlab_rails['db_username'] = "gitlab"
+# gitlab_rails['db_password'] = nil
+# gitlab_rails['db_host'] = nil
+# gitlab_rails['db_port'] = 5432
+# gitlab_rails['db_socket'] = nil
+# gitlab_rails['db_sslmode'] = nil
+# gitlab_rails['db_sslrootcert'] = nil
+# gitlab_rails['db_prepared_statements'] = true
+# gitlab_rails['db_statements_limit'] = 1000
+
+
+### GitLab Redis settings
+###! Connect to your own Redis instance
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+
+#### Redis TCP connection
+# gitlab_rails['redis_host'] = "127.0.0.1"
+# gitlab_rails['redis_port'] = 6379
+# gitlab_rails['redis_password'] = nil
+# gitlab_rails['redis_database'] = 0
+
+#### Redis local UNIX socket (will be disabled if TCP method is used)
+# gitlab_rails['redis_socket'] = "/var/opt/gitlab/redis/redis.socket"
+
+#### Sentinel support
+####! To have Sentinel working, you must enable Redis TCP connection support
+####! above and define a few Sentinel hosts below (to get a reliable setup
+####! at least 3 hosts).
+####! **You don't need to list every sentinel host, but the ones not listed will
+####!   not be used in a fail-over situation to query for the new master.**
+# gitlab_rails['redis_sentinels'] = [
+#   {'host' => '127.0.0.1', 'port' => 26379},
+# ]
+
+### GitLab email server settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html
+###! **Use smtp instead of sendmail/postfix.**
+
+# gitlab_rails['smtp_enable'] = true
+# gitlab_rails['smtp_address'] = "smtp.server"
+# gitlab_rails['smtp_port'] = 465
+# gitlab_rails['smtp_user_name'] = "smtp user"
+# gitlab_rails['smtp_password'] = "smtp password"
+# gitlab_rails['smtp_domain'] = "example.com"
+# gitlab_rails['smtp_authentication'] = "login"
+# gitlab_rails['smtp_enable_starttls_auto'] = true
+# gitlab_rails['smtp_tls'] = false
+
+###! **Can be: 'none', 'peer', 'client_once', 'fail_if_no_peer_cert'**
+###! Docs: http://api.rubyonrails.org/classes/ActionMailer/Base.html
+# gitlab_rails['smtp_openssl_verify_mode'] = 'none'
+
+# gitlab_rails['smtp_ca_path'] = "/etc/ssl/certs"
+# gitlab_rails['smtp_ca_file'] = "/etc/ssl/certs/ca-certificates.crt"
+
+################################################################################
+## Container Registry settings
+##! Docs: https://docs.gitlab.com/ce/administration/container_registry.html
+################################################################################
+
+# registry_external_url 'https://registry.gitlab.example.com'
+
+### Settings used by GitLab application
+# gitlab_rails['registry_enabled'] = true
+# gitlab_rails['registry_host'] = "registry.gitlab.example.com"
+# gitlab_rails['registry_port'] = "5005"
+# gitlab_rails['registry_path'] = "/var/opt/gitlab/gitlab-rails/shared/registry"
+
+###! **Do not change the following 3 settings unless you know what you are
+###!   doing**
+# gitlab_rails['registry_api_url'] = "http://localhost:5000"
+# gitlab_rails['registry_key_path'] = "/var/opt/gitlab/gitlab-rails/certificate.key"
+# gitlab_rails['registry_issuer'] = "omnibus-gitlab-issuer"
+
+### Settings used by Registry application
+# registry['enable'] = true
+# registry['username'] = "registry"
+# registry['group'] = "registry"
+# registry['uid'] = nil
+# registry['gid'] = nil
+# registry['dir'] = "/var/opt/gitlab/registry"
+# registry['registry_http_addr'] = "localhost:5000"
+# registry['debug_addr'] = "localhost:5001"
+# registry['log_directory'] = "/var/log/gitlab/registry"
+# registry['log_level'] = "info"
+# registry['rootcertbundle'] = "/var/opt/gitlab/registry/certificate.crt"
+# registry['storage_delete_enabled'] = true
+
+### Registry backend storage
+###! Docs: https://docs.gitlab.com/ce/administration/container_registry.html#container-registry-storage-driver
+# registry['storage'] = {
+#   's3' => {
+#     'accesskey' => 'AKIAKIAKI',
+#     'secretkey' => 'secret123',
+#     'bucket' => 'gitlab-registry-bucket-AKIAKIAKI'
+#   }
+# }
+
+### Registry notifications endpoints
+# registry['notifications'] = [
+#   {
+#     'name' => 'test_endpoint',
+#     'url' => 'https://gitlab.example.com/notify2',
+#     'timeout' => '500ms',
+#     'threshold' => 5,
+#     'backoff' => '1s',
+#     'headers' => {
+#       "Authorization" => ["AUTHORIZATION_EXAMPLE_TOKEN"]
+#     }
+#   }
+# ]
+### Default registry notifications
+# registry['default_notifications_timeout'] = "500ms"
+# registry['default_notifications_threshold'] = 5
+# registry['default_notifications_backoff'] = "1s"
+# registry['default_notifications_headers'] = {}
+
+
+
+################################################################################
+## GitLab Workhorse
+##! Docs: https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/README.md
+################################################################################
+
+# gitlab_workhorse['enable'] = true
+# gitlab_workhorse['ha'] = false
+# gitlab_workhorse['listen_network'] = "unix"
+# gitlab_workhorse['listen_umask'] = 000
+# gitlab_workhorse['listen_addr'] = "/var/opt/gitlab/gitlab-workhorse/socket"
+# gitlab_workhorse['auth_backend'] = "http://localhost:8080"
+
+##! the empty string is the default in gitlab-workhorse option parser
+# gitlab_workhorse['auth_socket'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['pprof_listen_addr'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['prometheus_listen_addr'] = "''"
+
+# gitlab_workhorse['dir'] = "/var/opt/gitlab/gitlab-workhorse"
+# gitlab_workhorse['log_directory'] = "/var/log/gitlab/gitlab-workhorse"
+# gitlab_workhorse['proxy_headers_timeout'] = "1m0s"
+
+##! limit number of concurrent API requests, defaults to 0 which is unlimited
+# gitlab_workhorse['api_limit'] = 0
+
+##! limit number of API requests allowed to be queued, defaults to 0 which
+##! disables queuing
+# gitlab_workhorse['api_queue_limit'] = 0
+
+##! duration after which we timeout requests if they sit too long in the queue
+# gitlab_workhorse['api_queue_duration'] = "30s"
+
+##! Long polling duration for job requesting for runners
+# gitlab_workhorse['api_ci_long_polling_duration'] = "60s"
+
+# gitlab_workhorse['env'] = {
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+################################################################################
+## GitLab User Settings
+##! Modify default git user.
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#changing-the-name-of-the-git-user-group
+################################################################################
+
+# user['username'] = "git"
+# user['group'] = "git"
+# user['uid'] = nil
+# user['gid'] = nil
+
+##! The shell for the git user
+# user['shell'] = "/bin/sh"
+
+##! The home directory for the git user
+# user['home'] = "/var/opt/gitlab"
+
+# user['git_user_name'] = "GitLab"
+# user['git_user_email'] = "gitlab@#{node['fqdn']}"
+
+################################################################################
+## GitLab Unicorn
+##! Tweak unicorn settings.
+##! Docs: https://docs.gitlab.com/omnibus/settings/unicorn.html
+################################################################################
+
+# unicorn['worker_timeout'] = 60
+###! Minimum worker_processes is 2 at this moment
+###! See https://gitlab.com/gitlab-org/gitlab-ce/issues/18771
+# unicorn['worker_processes'] = 2
+
+### Advanced settings
+# unicorn['listen'] = '127.0.0.1'
+# unicorn['port'] = 8080
+# unicorn['socket'] = '/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket'
+# unicorn['pidfile'] = '/opt/gitlab/var/unicorn/unicorn.pid'
+# unicorn['tcp_nopush'] = true
+# unicorn['backlog_socket'] = 1024
+
+###! **Make sure somaxconn is equal or higher then backlog_socket**
+# unicorn['somaxconn'] = 1024
+
+###! **We do not recommend changing this setting**
+# unicorn['log_directory'] = "/var/log/gitlab/unicorn"
+
+### **Only change these settings if you understand well what they mean**
+###! Docs: https://about.gitlab.com/2015/06/05/how-gitlab-uses-unicorn-and-unicorn-worker-killer/
+###!       https://github.com/kzk/unicorn-worker-killer
+# unicorn['worker_memory_limit_min'] = "400 * 1 << 20"
+# unicorn['worker_memory_limit_max'] = "650 * 1 << 20"
+
+################################################################################
+## GitLab Sidekiq
+################################################################################
+
+# sidekiq['log_directory'] = "/var/log/gitlab/sidekiq"
+# sidekiq['shutdown_timeout'] = 4
+# sidekiq['concurrency'] = 25
+
+################################################################################
+## gitlab-shell
+################################################################################
+
+# gitlab_shell['audit_usernames'] = false
+# gitlab_shell['log_level'] = 'INFO'
+# gitlab_shell['http_settings'] = { user: 'username', password: 'password', ca_file: '/etc/ssl/cert.pem', ca_path: '/etc/pki/tls/certs', self_signed_cert: false}
+# gitlab_shell['log_directory'] = "/var/log/gitlab/gitlab-shell/"
+# gitlab_shell['custom_hooks_dir'] = "/opt/gitlab/embedded/service/gitlab-shell/hooks"
+
+# gitlab_shell['auth_file'] = "/var/opt/gitlab/.ssh/authorized_keys"
+
+### Git trace log file.
+###! If set, git commands receive GIT_TRACE* environment variables
+###! Docs: https://git-scm.com/book/es/v2/Git-Internals-Environment-Variables#Debugging
+###! An absolute path starting with /  the trace output will be appended to
+###! that file. It needs to exist so we can check permissions and avoid
+###! throwing warnings to the users.
+# gitlab_shell['git_trace_log_file'] = "/var/log/gitlab/gitlab-shell/gitlab-shell-git-trace.log"
+
+##! **We do not recommend changing this directory.**
+# gitlab_shell['dir'] = "/var/opt/gitlab/gitlab-shell"
+
+################################################################
+## GitLab PostgreSQL
+################################################################
+
+###! Changing any of these settings requires a restart of postgresql.
+###! By default, reconfigure reloads postgresql if it is running. If you
+###! change any of these settings, be sure to run `gitlab-ctl restart postgresql`
+###! after reconfigure in order for the changes to take effect.
+# postgresql['enable'] = true
+# postgresql['listen_address'] = nil
+# postgresql['port'] = 5432
+# postgresql['data_dir'] = "/var/opt/gitlab/postgresql/data"
+
+##! **recommend value is 1/4 of total RAM, up to 14GB.**
+# postgresql['shared_buffers'] = "256MB"
+
+### Advanced settings
+# postgresql['ha'] = false
+# postgresql['dir'] = "/var/opt/gitlab/postgresql"
+# postgresql['log_directory'] = "/var/log/gitlab/postgresql"
+# postgresql['username'] = "gitlab-psql"
+# postgresql['uid'] = nil
+# postgresql['gid'] = nil
+# postgresql['shell'] = "/bin/sh"
+# postgresql['home'] = "/var/opt/gitlab/postgresql"
+# postgresql['user_path'] = "/opt/gitlab/embedded/bin:/opt/gitlab/bin:$PATH"
+# postgresql['sql_user'] = "gitlab"
+# postgresql['max_connections'] = 200
+# postgresql['md5_auth_cidr_addresses'] = []
+# postgresql['trust_auth_cidr_addresses'] = []
+# postgresql['wal_buffers'] = "-1"
+# postgresql['autovacuum_max_workers'] = "3"
+# postgresql['autovacuum_freeze_max_age'] = "200000000"
+# postgresql['track_activity_query_size'] = "1024"
+# postgresql['shared_preload_libraries'] = nil
+# postgresql['dynamic_shared_memory_type'] = nil
+# postgresql['hot_standby'] = "off"
+
+### Replication settings
+###! Note, some replication settings do not require a full restart. They are documented below.
+# postgresql['wal_level'] = "hot_standby"
+# postgresql['max_wal_senders'] = 5
+# postgresql['max_replication_slots'] = 0
+# postgresql['max_locks_per_transaction'] = 128
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_mode'] = "off"
+
+###! Changing any of these settings only requires a reload of postgresql. You do not need to
+###! restart postgresql if you change any of these and run reconfigure.
+# postgresql['work_mem'] = "16MB"
+# postgresql['maintenance_work_mem'] = "16MB"
+# postgresql['checkpoint_segments'] = 10
+# postgresql['checkpoint_timeout'] = "5min"
+# postgresql['checkpoint_completion_target'] = 0.9
+# postgresql['checkpoint_warning'] = "30s"
+# postgresql['effective_cache_size'] = "1MB"
+# postgresql['shmmax'] =  17179869184 # or 4294967295
+# postgresql['shmall'] =  4194304 # or 1048575
+# postgresql['autovacuum'] = "on"
+# postgresql['log_autovacuum_min_duration'] = "-1"
+# postgresql['autovacuum_naptime'] = "1min"
+# postgresql['autovacuum_vacuum_threshold'] = "50"
+# postgresql['autovacuum_analyze_threshold'] = "50"
+# postgresql['autovacuum_vacuum_scale_factor'] = "0.02"
+# postgresql['autovacuum_analyze_scale_factor'] = "0.01"
+# postgresql['autovacuum_vacuum_cost_delay'] = "20ms"
+# postgresql['autovacuum_vacuum_cost_limit'] = "-1"
+# postgresql['statement_timeout'] = "60000"
+# postgresql['idle_in_transaction_session_timeout'] = "60000"
+# postgresql['log_line_prefix'] = "%a"
+
+### Available in PostgreSQL 9.6 and later
+# postgresql['min_wal_size'] = 80MB
+# postgresql['max_wal_size'] = 1GB
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_command'] = nil
+# default['gitlab']['postgresql']['archive_timeout'] = "60"
+
+### Replication settings
+# postgresql['sql_replication_user'] = "gitlab_replicator"
+# postgresql['wal_keep_segments'] = 10
+# postgresql['max_standby_archive_delay'] = "30s"
+# postgresql['max_standby_streaming_delay'] = "30s"
+# postgresql['synchronous_commit'] = on
+# postgresql['synchronous_standby_names'] = ''
+# postgresql['hot_standby_feedback'] = 'off'
+# postgresql['random_page_cost'] = 2.0
+# postgresql['log_temp_files'] = -1
+# postgresql['log_checkpoints'] = 'off'
+# To add custom entries to pg_hba.conf use the following
+# postgresql['custom_pg_hba_entries'][APPLICATION] = { # APPLICATION should identify what the settings are used for
+#   type: example,
+#   database: example,
+#   user: example,
+#   cidr: example,
+#   method: example,
+#   option: exmple
+# }
+# See https://www.postgresql.org/docs/9.6/static/auth-pg-hba-conf.html for an explanation
+# of the values
+
+
+################################################################################
+## GitLab Redis
+##! **Can be disabled if you are using your own Redis instance.**
+##! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+################################################################################
+
+# redis['enable'] = true
+# redis['username'] = "gitlab-redis"
+# redis['maxclients'] = "10000"
+# redis['tcp_timeout'] = "60"
+# redis['tcp_keepalive'] = "300"
+# redis['uid'] = nil
+# redis['gid'] = nil
+
+###! **To enable only Redis service in this machine, uncomment
+###!   one of the lines below (choose master or slave instance types).**
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+###!       https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_master_role['enable'] = true
+# redis_slave_role['enable'] = true
+
+### Redis TCP support (will disable UNIX socket transport)
+# redis['bind'] = '0.0.0.0' # or specify an IP to bind to a single one
+# redis['port'] = 6379
+# redis['password'] = 'redis-password-goes-here'
+
+### Redis Sentinel support
+###! **You need a master slave Redis replication to be able to do failover**
+###! **Please read the documentation before enabling it to understand the
+###!   caveats:**
+###! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+
+### Replication support
+#### Slave Redis instance
+# redis['master'] = false # by default this is true
+
+#### Slave and Sentinel shared configuration
+####! **Both need to point to the master Redis instance to get replication and
+####!   heartbeat monitoring**
+# redis['master_name'] = 'gitlab-redis'
+# redis['master_ip'] = nil
+# redis['master_port'] = 6379
+
+####! **Master password should have the same value defined in
+####!   redis['password'] to enable the instance to transition to/from
+####!   master/slave in a failover event.**
+# redis['master_password'] = 'redis-password-goes-here'
+
+####! Increase these values when your slaves can't catch up with master
+# redis['client_output_buffer_limit_normal'] = '0 0 0'
+# redis['client_output_buffer_limit_slave'] = '256mb 64mb 60'
+# redis['client_output_buffer_limit_pubsub'] = '32mb 8mb 60'
+
+################################################################################
+## GitLab Web server
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#using-a-non-bundled-web-server
+################################################################################
+
+##! When bundled nginx is disabled we need to add the external webserver user to
+##! the GitLab webserver group.
+# web_server['external_users'] = []
+# web_server['username'] = 'gitlab-www'
+# web_server['group'] = 'gitlab-www'
+# web_server['uid'] = nil
+# web_server['gid'] = nil
+# web_server['shell'] = '/bin/false'
+# web_server['home'] = '/var/opt/gitlab/nginx'
+
+################################################################################
+## GitLab NGINX
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html
+################################################################################
+
+# nginx['enable'] = true
+# nginx['client_max_body_size'] = '250m'
+# nginx['redirect_http_to_https'] = false
+# nginx['redirect_http_to_https_port'] = 80
+
+##! Most root CA's are included by default
+# nginx['ssl_client_certificate'] = "/etc/gitlab/ssl/ca.crt"
+
+##! enable/disable 2-way SSL client authentication
+# nginx['ssl_verify_client'] = "off"
+
+##! if ssl_verify_client on, verification depth in the client certificates chain
+# nginx['ssl_verify_depth'] = "1"
+
+# nginx['ssl_certificate'] = "/etc/gitlab/ssl/#{node['fqdn']}.crt"
+# nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/#{node['fqdn']}.key"
+# nginx['ssl_ciphers'] = "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"
+# nginx['ssl_prefer_server_ciphers'] = "on"
+
+##! **Recommended by: https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html
+##!                   https://cipherli.st/**
+# nginx['ssl_protocols'] = "TLSv1 TLSv1.1 TLSv1.2"
+
+##! **Recommended in: https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_cache'] = "builtin:1000  shared:SSL:10m"
+
+##! **Default according to https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_timeout'] = "5m"
+
+# nginx['ssl_dhparam'] = nil # Path to dhparams.pem, eg. /etc/gitlab/ssl/dhparams.pem
+# nginx['listen_addresses'] = ['*', '[::]']
+
+##! **Defaults to forcing web browsers to always communicate using only HTTPS**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-http-strict-transport-security
+# nginx['hsts_max_age'] = 31536000
+# nginx['hsts_include_subdomains'] = false
+
+##! **Override only if you use a reverse proxy**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-the-nginx-listen-port
+# nginx['listen_port'] = nil
+
+##! **Override only if your reverse proxy internally communicates over HTTP**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#supporting-proxied-ssl
+# nginx['listen_https'] = nil
+
+# nginx['custom_gitlab_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# nginx['custom_nginx_config'] = "include /etc/nginx/conf.d/example.conf;"
+# nginx['proxy_read_timeout'] = 3600
+# nginx['proxy_connect_timeout'] = 300
+# nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host_with_default",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on",
+#  "Upgrade" => "$http_upgrade",
+#  "Connection" => "$connection_upgrade"
+# }
+# nginx['proxy_cache_path'] = 'proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2'
+# nginx['proxy_cache'] = 'gitlab'
+# nginx['http2_enabled'] = true
+# nginx['real_ip_trusted_addresses'] = []
+# nginx['real_ip_header'] = nil
+# nginx['real_ip_recursive'] = nil
+# nginx['custom_error_pages'] = {
+#   '404' => {
+#     'title' => 'Example title',
+#     'header' => 'Example header',
+#     'message' => 'Example message'
+#   }
+# }
+
+### Advanced settings
+# nginx['dir'] = "/var/opt/gitlab/nginx"
+# nginx['log_directory'] = "/var/log/gitlab/nginx"
+# nginx['worker_processes'] = 4
+# nginx['worker_connections'] = 10240
+# nginx['log_format'] = '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"'
+# nginx['sendfile'] = 'on'
+# nginx['tcp_nopush'] = 'on'
+# nginx['tcp_nodelay'] = 'on'
+# nginx['gzip'] = "on"
+# nginx['gzip_http_version'] = "1.0"
+# nginx['gzip_comp_level'] = "2"
+# nginx['gzip_proxied'] = "any"
+# nginx['gzip_types'] = [ "text/plain", "text/css", "application/x-javascript", "text/xml", "application/xml", "application/xml+rss", "text/javascript", "application/json" ]
+# nginx['keepalive_timeout'] = 65
+# nginx['cache_max_size'] = '5000m'
+# nginx['server_names_hash_bucket_size'] = 64
+
+### Nginx status
+# nginx['status'] = {
+#  "enable" => true,
+#  "listen_addresses" => ["127.0.0.1"],
+#  "fqdn" => "dev.example.com",
+#  "port" => 9999,
+#  "options" => {
+#    "stub_status" => "on", # Turn on stats
+#    "server_tokens" => "off", # Don't show the version of NGINX
+#    "access_log" => "off", # Disable logs for stats
+#    "allow" => "127.0.0.1", # Only allow access from localhost
+#    "deny" => "all" # Deny access to anyone else
+#  }
+# }
+
+################################################################################
+## GitLab Logging
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html
+################################################################################
+
+# logging['svlogd_size'] = 200 * 1024 * 1024 # rotate after 200 MB of log data
+# logging['svlogd_num'] = 30 # keep 30 rotated log files
+# logging['svlogd_timeout'] = 24 * 60 * 60 # rotate after 24 hours
+# logging['svlogd_filter'] = "gzip" # compress logs with gzip
+# logging['svlogd_udp'] = nil # transmit log messages via UDP
+# logging['svlogd_prefix'] = nil # custom prefix for log messages
+# logging['logrotate_frequency'] = "daily" # rotate logs daily
+# logging['logrotate_size'] = nil # do not rotate by size by default
+# logging['logrotate_rotate'] = 30 # keep 30 rotated logs
+# logging['logrotate_compress'] = "compress" # see 'man logrotate'
+# logging['logrotate_method'] = "copytruncate" # see 'man logrotate'
+# logging['logrotate_postrotate'] = nil # no postrotate command by default
+# logging['logrotate_dateformat'] = nil # use date extensions for rotated files rather than numbers e.g. a value of "-%Y-%m-%d" would give rotated files like production.log-2016-03-09.gz
+
+### UDP log forwarding
+##! Docs: http://docs.gitlab.com/omnibus/settings/logs.html#udp-log-forwarding
+
+##! remote host to ship log messages to via UDP
+# logging['udp_log_shipping_host'] = nil
+
+##! remote port to ship log messages to via UDP
+# logging['udp_log_shipping_port'] = 514
+
+################################################################################
+## Logrotate
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html#logrotate
+##! You can disable built in logrotate feature.
+################################################################################
+# logrotate['enable'] = true
+
+################################################################################
+## Users and groups accounts
+##! Disable management of users and groups accounts.
+##! **Set only if creating accounts manually**
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-user-and-group-account-management
+################################################################################
+
+# manage_accounts['enable'] = false
+
+################################################################################
+## Storage directories
+##! Disable managing storage directories
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-storage-directories-management
+################################################################################
+
+##! **Set only if the select directories are created manually**
+# manage_storage_directories['enable'] = false
+# manage_storage_directories['manage_etc'] = false
+
+################################################################################
+## Runtime directory
+##! Docs: https://docs.gitlab.com//omnibus/settings/configuration.html#configuring-runtime-directory
+################################################################################
+
+# runtime_dir '/run'
+
+################################################################################
+## Git
+##! Advanced setting for configuring git system settings for omnibus-gitlab
+##! internal git
+################################################################################
+
+##! For multiple options under one header use array of comma separated values,
+##! eg.:
+##! { "receive" => ["fsckObjects = true"], "alias" => ["st = status", "co = checkout"] }
+
+# omnibus_gitconfig['system'] = {
+#  "pack" => ["threads = 1"],
+#  "receive" => ["fsckObjects = true"],
+#  "repack" => ["writeBitmaps = true"],
+#  "transfer" => ["hideRefs=^refs/tmp/", "hideRefs=^refs/keep-around/"],
+# }
+
+################################################################################
+## GitLab Pages
+##! Docs: https://docs.gitlab.com/ce/pages/administration.html
+################################################################################
+
+##! Define to enable GitLab Pages
+# pages_external_url "http://pages.example.com/"
+# gitlab_pages['enable'] = false
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTP
+# gitlab_pages['external_http'] = []
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTPS
+# gitlab_pages['external_https'] = []
+
+# gitlab_pages['listen_proxy'] = "localhost:8090"
+# gitlab_pages['redirect_http'] = true
+# gitlab_pages['use_http2'] = true
+# gitlab_pages['dir'] = "/var/opt/gitlab/gitlab-pages"
+# gitlab_pages['log_directory'] = "/var/log/gitlab/gitlab-pages"
+
+##! Prometheus metrics for Pages docs: https://gitlab.com/gitlab-org/gitlab-pages/#enable-prometheus-metrics
+# gitlab_pages['metrics_address'] = ":9235"
+
+################################################################################
+## GitLab Pages NGINX
+################################################################################
+
+# All the settings defined in the "GitLab Nginx" section are also available in this "GitLab Pages NGINX" section
+# You just have to change the key "nginx['some_settings']" with "pages_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "GitLab Pages NGINX"
+# pages_nginx['enable'] = false
+
+# gitlab_rails['pages_path'] = "/mnt/storage/pages"
+
+################################################################################
+## GitLab CI
+##! Docs: https://docs.gitlab.com/ce/ci/quick_start/README.html
+################################################################################
+
+# gitlab_ci['gitlab_ci_all_broken_builds'] = true
+# gitlab_ci['gitlab_ci_add_pusher'] = true
+# gitlab_ci['builds_directory'] = '/var/opt/gitlab/gitlab-ci/builds'
+
+################################################################################
+## GitLab Mattermost
+##! Docs: https://docs.gitlab.com/omnibus/gitlab-mattermost
+################################################################################
+
+# mattermost_external_url 'http://mattermost.example.com'
+
+# mattermost['enable'] = false
+# mattermost['username'] = 'mattermost'
+# mattermost['group'] = 'mattermost'
+# mattermost['uid'] = nil
+# mattermost['gid'] = nil
+# mattermost['home'] = '/var/opt/gitlab/mattermost'
+# mattermost['database_name'] = 'mattermost_production'
+
+# mattermost['service_use_ssl'] = false
+# mattermost['service_address'] = "127.0.0.1"
+# mattermost['service_port'] = "8065"
+# mattermost['service_site_url'] = nil
+# mattermost['service_maximum_login_attempts'] = 10
+# mattermost['service_google_developer_key'] = nil
+# mattermost['service_enable_incoming_webhooks'] = true
+# mattermost['service_enable_post_username_override'] = true
+# mattermost['service_enable_post_icon_override'] = true
+# mattermost['service_enable_testing'] = false
+# mattermost['service_enable_security_fix_alert'] = true
+# mattermost['service_enable_insecure_outgoing_connections'] = false
+# mattermost['service_allow_cors_from'] = ""
+# mattermost['service_enable_outgoing_webhooks'] = true
+# mattermost['service_enable_commands'] = true
+# mattermost['service_enable_custom_emoji'] = false
+# mattermost['service_enable_only_admin_integrations'] = true
+# mattermost['service_enable_oauth_service_provider'] = false
+# mattermost['service_enable_developer'] = false
+# mattermost['service_session_length_web_in_days'] = 30
+# mattermost['service_session_length_mobile_in_days'] = 30
+# mattermost['service_session_length_sso_in_days'] = 30
+# mattermost['service_session_cache_in_minutes'] = 10
+# mattermost['service_connection_security'] = nil
+# mattermost['service_tls_cert_file'] = nil
+# mattermost['service_tls_key_file'] = nil
+# mattermost['service_use_lets_encrypt'] = false
+# mattermost['service_lets_encrypt_cert_cache_file'] = "./config/letsencrypt.cache"
+# mattermost['service_forward_80_to_443'] = false
+# mattermost['service_read_timeout'] = 300
+# mattermost['service_write_timeout'] = 300
+# mattermost['service_time_between_user_typing_updates_milliseconds'] = 5000
+# mattermost['service_enable_link_previews'] = false
+# mattermost['service_enable_user_typing_messages'] = true
+# mattermost['service_enable_post_search'] = true
+# mattermost['service_enable_user_statuses'] = true
+# mattermost['service_enable_emoji_picker'] = true
+# mattermost['service_enable_channel_viewed_messages'] = true
+# mattermost['service_enable_apiv3'] = true
+# mattermost['service_goroutine_health_threshold'] = -1
+# mattermost['service_user_access_tokens'] = false
+
+# mattermost['team_site_name'] = "GitLab Mattermost"
+# mattermost['team_max_users_per_team'] = 150
+# mattermost['team_enable_team_creation'] = true
+# mattermost['team_enable_user_creation'] = true
+# mattermost['team_enable_open_server'] = false
+# mattermost['team_allow_public_link'] = true
+# mattermost['team_allow_valet_default'] = false
+# mattermost['team_restrict_creation_to_domains'] = "gmail.com"
+# mattermost['team_restrict_team_names'] = true
+# mattermost['team_restrict_direct_message'] = "any"
+# mattermost['team_max_channels_per_team'] = 2000
+# mattermost['team_user_status_away_timeout'] = 300
+# mattermost['team_teammate_name_display'] = "full_name"
+
+# mattermost['sql_driver_name'] = 'mysql'
+# mattermost['sql_data_source'] = "mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"
+# mattermost['sql_data_source_replicas'] = ["mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"]
+# mattermost['sql_max_idle_conns'] = 10
+# mattermost['sql_max_open_conns'] = 10
+# mattermost['sql_trace'] = false
+# mattermost['sql_data_source_search_replicas'] = []
+# mattermost['sql_query_timeout'] = 30
+
+
+# mattermost['log_file_directory'] = '/var/log/gitlab/mattermost'
+# mattermost['log_console_enable'] = true
+# mattermost['log_console_level'] = 'INFO'
+# mattermost['log_enable_file'] = false
+# mattermost['log_file_level'] = 'INFO'
+# mattermost['log_file_format'] = nil
+# mattermost['log_enable_diagnostics'] = true
+
+# mattermost['gitlab_enable'] = false
+# mattermost['gitlab_id'] = "12345656"
+# mattermost['gitlab_secret'] = "123456789"
+# mattermost['gitlab_scope'] = ""
+# mattermost['gitlab_auth_endpoint'] = "http://gitlab.example.com/oauth/authorize"
+# mattermost['gitlab_token_endpoint'] = "http://gitlab.example.com/oauth/token"
+# mattermost['gitlab_user_api_endpoint'] = "http://gitlab.example.com/api/v4/user"
+
+# mattermost['aws'] = {'S3AccessKeyId' => '123', 'S3SecretAccessKey' => '123', 'S3Bucket' => 'aa', 'S3Region' => 'bb'}
+
+# mattermost['email_enable_sign_up_with_email'] = true
+# mattermost['email_enable_sign_in_with_email'] = true
+# mattermost['email_enable_sign_in_with_username'] = false
+# mattermost['email_send_email_notifications'] = false
+# mattermost['email_require_email_verification'] = false
+# mattermost['email_smtp_username'] = nil
+# mattermost['email_smtp_password'] = nil
+# mattermost['email_smtp_server'] = nil
+# mattermost['email_smtp_port'] = nil
+# mattermost['email_connection_security'] = nil
+# mattermost['email_feedback_name'] = nil
+# mattermost['email_feedback_email'] = nil
+# mattermost['email_feedback_organization'] = nil
+# mattermost['email_send_push_notifications'] = true
+# mattermost['email_push_notification_server'] = ""
+# mattermost['email_push_notification_contents'] = "generic"
+# mattermost['email_enable_batching'] = false
+# mattermost['email_batching_buffer_size'] = 256
+# mattermost['email_batching_interval'] = 30
+# mattermost['email_skip_server_certificate_verification'] = false
+# mattermost['email_smtp_auth'] = false
+# mattermost['email_notification_content_type'] = "full"
+
+# mattermost['file_max_file_size'] = 52428800
+# mattermost['file_driver_name'] = "local"
+# mattermost['file_directory'] = "/var/opt/gitlab/mattermost/data"
+# mattermost['file_enable_public_link'] = true
+# mattermost['file_initial_font'] = 'luximbi.ttf'
+# mattermost['file_amazon_s3_access_key_id'] = nil
+# mattermost['file_amazon_s3_bucket'] = nil
+# mattermost['file_amazon_s3_secret_access_key'] = nil
+# mattermost['file_amazon_s3_region'] = nil
+# mattermost["file_amazon_s3_endpoint"] = nil
+# mattermost["file_amazon_s3_bucket_endpoint"] = nil
+# mattermost["file_amazon_s3_location_constraint"] = false
+# mattermost["file_amazon_s3_lowercase_bucket"] = false
+# mattermost["file_amazon_s3_ssl"] = true
+# mattermost["file_amazon_s3_sign_v2"] = false
+# mattermost['file_enable_file_attachments'] = true
+
+# mattermost['ratelimit_enable_rate_limiter'] = false
+# mattermost['ratelimit_per_sec'] = 10
+# mattermost['ratelimit_memory_store_size'] = 10000
+# mattermost['ratelimit_vary_by_remote_addr'] = true
+# mattermost['ratelimit_vary_by_header'] = nil
+# mattermost['ratelimit_max_burst'] = 100
+
+# mattermost['support_terms_of_service_link'] = "/static/help/terms.html"
+# mattermost['support_privacy_policy_link'] = "/static/help/privacy.html"
+# mattermost['support_about_link'] = "/static/help/about.html"
+# mattermost['support_report_a_problem_link'] =  "/static/help/report_problem.html"
+# mattermost['support_email'] =  "support@example.com"
+
+# mattermost['privacy_show_email_address'] = true
+# mattermost['privacy_show_full_name'] = true
+
+# mattermost['localization_server_locale'] = "en"
+# mattermost['localization_client_locale'] = "en"
+# mattermost['localization_available_locales'] = "en,es,fr,ja,pt-BR"
+
+# mattermost['webrtc_enable'] = false
+# mattermost['webrtc_gateway_websocket_url'] = nil
+# mattermost['webrtc_gateway_admin_url'] = nil
+# mattermost['webrtc_gateway_admin_secret'] = nil
+# mattermost['webrtc_gateway_stun_uri'] = nil
+# mattermost['webrtc_gateway_turn_uri'] = nil
+# mattermost['webrtc_gateway_turn_username'] = nil
+# mattermost['webrtc_gateway_turn_shared_key'] = nil
+
+################################################################################
+## Mattermost NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Mattermost NGINX" section
+# You just have to change the key "nginx['some_settings']" with "mattermost_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Mattermost NGINX"
+# mattermost_nginx['enable'] = false
+
+# mattermost_nginx['custom_gitlab_mattermost_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# mattermost_nginx['proxy_set_headers'] = {
+#   "Host" => "$http_host",
+#   "X-Real-IP" => "$remote_addr",
+#   "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#   "X-Frame-Options" => "SAMEORIGIN",
+#   "X-Forwarded-Proto" => "https",
+#   "X-Forwarded-Ssl" => "on",
+#   "Upgrade" => "$http_upgrade",
+#   "Connection" => "$connection_upgrade"
+# }
+
+
+################################################################################
+## Registry NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Registry NGINX" section
+# You just have to change the key "nginx['some_settings']" with "registry_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Registry NGINX"
+# registry_nginx['enable'] = false
+
+# registry_nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on"
+# }
+
+################################################################################
+## Prometheus
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/
+################################################################################
+
+# prometheus['enable'] = true
+# prometheus['monitor_kubernetes'] = true
+# prometheus['username'] = 'gitlab-prometheus'
+# prometheus['uid'] = nil
+# prometheus['gid'] = nil
+# prometheus['shell'] = '/bin/sh'
+# prometheus['home'] = '/var/opt/gitlab/prometheus'
+# prometheus['log_directory'] = '/var/log/gitlab/prometheus'
+# prometheus['scrape_interval'] = 15
+# prometheus['scrape_timeout'] = 15
+# prometheus['chunk_encoding_version'] = 2
+#
+### Custom scrape configs
+#
+# Prometheus can scrape additional jobs via scrape_configs.  The default automatically
+# includes all of the exporters supported by the omnibus config.
+#
+# See: https://prometheus.io/docs/operating/configuration/#<scrape_config>
+#
+# Example:
+#
+# prometheus['scrape_configs'] = [
+#   {
+#     'job_name': 'example',
+#     'static_configs' => [
+#       'targets' => ['hostname:port'],
+#     ],
+#   },
+# ]
+#
+### Prometheus Memory Management
+#
+# Prometheus needs to be configured for how much memory is used.
+# * This sets the target heap size.
+# * This value accounts for approximately 2/3 of the memory used by the server.
+# * The recommended memory is 4kb per unique metrics time-series.
+# See: https://prometheus.io/docs/operating/storage/#memory-usage
+#
+# prometheus['target_heap_size'] = (
+#   # Use 25mb + 2% of total memory for Prometheus memory.
+#   26_214_400 + (node['memory']['total'].to_i * 1024 * 0.02 )
+# ).to_i
+#
+# prometheus['flags'] = {
+#   'storage.local.path' => "#{node['gitlab']['prometheus']['home']}/data",
+#   'storage.local.chunk-encoding-version' => user_config['chunk-encoding-version'],
+#   'storage.local.target-heap-size' => node['gitlab']['prometheus']['target-heap-size'],
+#   'config.file' => "#{node['gitlab']['prometheus']['home']}/prometheus.yml"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# prometheus['listen_address'] = 'localhost:9090'
+
+################################################################################
+## Prometheus Node Exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/node_exporter.html
+################################################################################
+
+# node_exporter['enable'] = true
+# node_exporter['home'] = '/var/opt/gitlab/node-exporter'
+# node_exporter['log_directory'] = '/var/log/gitlab/node-exporter'
+# node_exporter['flags'] = {
+#   'collector.textfile.directory' => "#{node['gitlab']['node-exporter']['home']}/textfile_collector"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# node_exporter['listen_address'] = 'localhost:9100'
+
+################################################################################
+## Prometheus Redis exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/redis_exporter.html
+################################################################################
+
+# redis_exporter['enable'] = true
+# redis_exporter['log_directory'] = '/var/log/gitlab/redis-exporter'
+# redis_exporter['flags'] = {
+#   'redis.addr' => "unix://#{node['gitlab']['gitlab-rails']['redis_socket']}",
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# redis_exporter['listen_address'] = 'localhost:9121'
+
+################################################################################
+## Prometheus Postgres exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/postgres_exporter.html
+################################################################################
+
+# postgres_exporter['enable'] = true
+# postgres_exporter['home'] = '/var/opt/gitlab/postgres-exporter'
+# postgres_exporter['log_directory'] = '/var/log/gitlab/postgres-exporter'
+# postgres_exporter['flags'] = {}
+# postgres_exporter['listen_address'] = 'localhost:9187'
+
+################################################################################
+## Prometheus Gitlab monitor
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/gitlab_monitor_exporter.html
+################################################################################
+
+
+# gitlab_monitor['enable'] = true
+# gitlab_monitor['log_directory'] = "/var/log/gitlab/gitlab-monitor"
+# gitlab_monitor['home'] = "/var/opt/gitlab/gitlab-monitor"
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# gitlab_monitor['listen_address'] = 'localhost'
+# gitlab_monitor['listen_port'] = '9168'
+
+# To completely disable prometheus, and all of it's exporters, set to false
+# prometheus_monitoring['enable'] = true
+
+################################################################################
+## Gitaly
+##! Docs:
+################################################################################
+
+
+# gitaly['enable'] = false
+# gitaly['dir'] = "/var/opt/gitlab/gitaly"
+# gitaly['log_directory'] = "/var/log/gitlab/gitaly"
+# gitaly['bin_path'] = "/opt/gitlab/embedded/bin/gitaly"
+# gitaly['env_directory'] = "/opt/gitlab/etc/gitaly"
+# gitaly['env'] = {
+#  'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin",
+#  'HOME' => '/var/opt/gitlab'
+# }
+# gitaly['socket_path'] = "/var/opt/gitlab/gitaly/gitaly.socket"
+# gitaly['listen_addr'] = "localhost:8075"
+# gitaly['prometheus_listen_addr'] = "localhost:9175"
+# gitaly['logging_format'] = "json"
+# gitaly['logging_sentry_dsn'] = "https://<key>:<secret>@sentry.io/<project>"
+# gitaly['prometheus_grpc_latency_buckets'] = "[0.001, 0.005, 0.025, 0.1, 0.5, 1.0, 10.0, 30.0, 60.0, 300.0, 1500.0]"
+# gitaly['auth_token'] = '<secret>'
+# gitaly['auth_transitioning'] = false # When true, auth is logged to Prometheus but NOT enforced
+
+
+################################################################################
+################################################################################
+##                  Configuration Settings for GitLab EE only                 ##
+################################################################################
+################################################################################
+
+
+################################################################################
+## Auxiliary cron jobs applicable to GitLab EE only
+################################################################################
+#
+# gitlab_rails['geo_bulk_notify_worker_cron'] = "*/10 * * * * *"
+# gitlab_rails['geo_file_download_dispatch_worker_cron'] = "*/10 * * * *"
+# gitlab_rails['geo_repository_sync_worker_cron'] = "*/5 * * * *"
+# gitlab_rails['ldap_sync_worker_cron'] = "30 1 * * *"
+# gitlab_rails['ldap_group_sync_worker_cron'] = "0 * * * *"
+# gitlab_rails['historical_data_worker_cron'] = "0 12 * * *"
+
+################################################################################
+## Kerberos (EE Only)
+##! Docs: https://docs.gitlab.com/ee/integration/kerberos.html#http-git-access
+################################################################################
+
+# gitlab_rails['kerberos_enabled'] = true
+# gitlab_rails['kerberos_keytab'] = /etc/http.keytab
+# gitlab_rails['kerberos_service_principal_name'] = HTTP/gitlab.example.com@EXAMPLE.COM
+# gitlab_rails['kerberos_use_dedicated_port'] = true
+# gitlab_rails['kerberos_port'] = 8443
+# gitlab_rails['kerberos_https'] = true
+
+################################################################################
+## GitLab Sentinel (EE Only)
+##! Docs: http://docs.gitlab.com/ce/administration/high_availability/redis.html#high-availability-with-sentinel
+################################################################################
+
+##! **Make sure you configured all redis['master_*'] keys above before
+##!   continuing.**
+
+##! To enable Sentinel and disable all other services in this machine,
+##! uncomment the line below (if you've enabled Redis role, it will keep it).
+##! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_sentinel_role['enable'] = true
+
+# sentinel['enable'] = true
+
+##! Bind to all interfaces, uncomment to specify an IP and bind to a single one
+# sentinel['bind'] = '0.0.0.0'
+
+##! Uncomment to change default port
+# sentinel['port'] = 26379
+
+##! Quorum must reflect the amount of voting sentinels it take to start a
+##! failover.
+##! **Value must NOT be greater then the amount of sentinels.**
+##! The quorum can be used to tune Sentinel in two ways:
+##! 1. If a the quorum is set to a value smaller than the majority of Sentinels
+##!    we deploy, we are basically making Sentinel more sensible to master
+##!    failures, triggering a failover as soon as even just a minority of
+##!    Sentinels is no longer able to talk with the master.
+##! 2. If a quorum is set to a value greater than the majority of Sentinels, we
+##!    are making Sentinel able to failover only when there are a very large
+##!    number (larger than majority) of well connected Sentinels which agree
+##!    about the master being down.
+# sentinel['quorum'] = 1
+
+### Consider unresponsive server down after x amount of ms.
+# sentinel['down_after_milliseconds'] = 10000
+
+### Specifies the failover timeout in milliseconds.
+##! It is used in many ways:
+##!
+##! - The time needed to re-start a failover after a previous failover was
+##!   already tried against the same master by a given Sentinel, is two
+##!   times the failover timeout.
+##!
+##! - The time needed for a slave replicating to a wrong master according
+##!   to a Sentinel current configuration, to be forced to replicate
+##!   with the right master, is exactly the failover timeout (counting since
+##!   the moment a Sentinel detected the misconfiguration).
+##!
+##! - The time needed to cancel a failover that is already in progress but
+##!   did not produced any configuration change (SLAVEOF NO ONE yet not
+##!   acknowledged by the promoted slave).
+##!
+##! - The maximum time a failover in progress waits for all the slaves to be
+##!   reconfigured as slaves of the new master. However even after this time
+##!   the slaves will be reconfigured by the Sentinels anyway, but not with
+##!   the exact parallel-syncs progression as specified.
+# sentinel['failover_timeout'] = 60000
+
+################################################################################
+## GitLab Sidekiq Cluster (EE only)
+################################################################################
+
+##! GitLab Enterprise Edition allows one to start an extra set of Sidekiq processes
+##! besides the default one. These processes can be used to consume a dedicated set
+##! of queues. This can be used to ensure certain queues always have dedicated
+##! workers, no matter the amount of jobs that need to be processed.
+
+# sidekiq_cluster['enable'] = false
+# sidekiq_cluster['ha'] = false
+# sidekiq_cluster['log_directory'] = "/var/log/gitlab/sidekiq-cluster"
+# sidekiq_cluster['interval'] = 5 # The number of seconds to wait between worker checks
+
+##! Each entry in the queue_groups array denotes a group of queues that have to be processed by a
+##! Sidekiq process. Multiple queues can be processed by the same process by
+##! separating them with a comma within the group entry
+
+# sidekiq_cluster['queue_groups'] = [
+#   "process_commit,post_receive",
+#   "gitlab_shell"
+# ]
+#
+
+##! If negate is enabled then sidekiq-cluster will process all the queues that
+##! don't match those in queue_groups.
+
+# sidekiq_cluster['negate'] = false
+
+################################################################################
+## Additional Database Settings (EE only)
+##! Docs: https://docs.gitlab.com/ee/administration/database_load_balancing.html
+################################################################################
+# gitlab_rails['db_load_balancing'] = { 'hosts' => ['secondary1.example.com'] }
+
+################################################################################
+## GitLab Geo
+##! Docs: https://docs.gitlab.com/ee/gitlab-geo
+################################################################################
+# geo_primary_role['enable'] = false
+# geo_secondary_role['enable'] = false
+
+################################################################################
+## GitLab Geo Secondary (EE only)
+################################################################################
+# geo_secondary['auto_migrate'] = true
+# geo_secondary['db_adapter'] = "postgresql"
+# geo_secondary['db_encoding'] = "unicode"
+# geo_secondary['db_collation'] = nil
+# geo_secondary['db_database'] = "gitlabhq_geo_production"
+# geo_secondary['db_pool'] = 10
+# geo_secondary['db_username'] = "gitlab_geo"
+# geo_secondary['db_password'] = nil
+# geo_secondary['db_host'] = "/var/opt/gitlab/geo-postgresql"
+# geo_secondary['db_port'] = 5431
+# geo_secondary['db_socket'] = nil
+# geo_secondary['db_sslmode'] = nil
+# geo_secondary['db_sslrootcert'] = nil
+# geo_secondary['db_sslca'] = nil
+
+################################################################################
+## GitLab Geo Secondary Tracking Database (EE only)
+################################################################################
+
+# geo_postgresql['enable'] = false
+# geo_postgresql['ha'] = false
+# geo_postgresql['dir'] = '/var/opt/gitlab/geo-postgresql'
+# geo_postgresql['data_dir'] = '/var/opt/gitlab/geo-postgresql/data'
+
+################################################################################
+# Pgbouncer (EE only)
+# See [GitLab PgBouncer documentation](http://docs.gitlab.com/omnibus/settings/database.html#enabling-pgbouncer-ee-only)
+# See the [PgBouncer page](https://pgbouncer.github.io/config.html) for details
+################################################################################
+# pgbouncer['enable'] = false
+# pgbouncer['log_directory'] = '/var/log/gitlab/pgbouncer'
+# pgbouncer['data_directory'] = '/var/opt/gitlab/pgbouncer'
+# pgbouncer['listen_addr'] = '0.0.0.0'
+# pgbouncer['listen_port'] = '6432'
+# pgbouncer['pool_mode'] = 'session'
+# pgbouncer['server_reset_query'] = 'DISCARD ALL'
+# pgbouncer['max_client_conn'] = '100'
+# pgbouncer['default_pool_size'] = '20'
+# pgbouncer['min_pool_size'] = '0'
+# pgbouncer['reserve_pool_size'] = '0'
+# pgbouncer['reserve_pool_timeout'] = '5.0'
+# pgbouncer['server_round_robin'] = '0'
+# pgbouncer['log_connections'] = '0'
+# pgbouncer['server_idle_timeout'] = '600.0'
+# pgbouncer['dns_max_ttl'] = '15.0'
+# pgbouncer['dns_zone_check_period'] = '0'
+# pgbouncer['dns_nxdomain_ttl'] = '15.0'
+# pgbouncer['admin_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['stats_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['ignore_startup_parameters'] = 'extra_float_digits'
+# pgbouncer['databases'] = {
+#   DATABASE_NAME: {
+#     host: HOSTNAME,
+#     port: PORT
+#     user: USERNAME,
+#     password: PASSWORD
+###! generate this with `echo -n '$password + $username' | md5sum`
+#   }
+#   ...
+# }
+# pgbouncer['auth_type'] = 'md5'
+# pgbouncer['auth_hba_file'] = nil
+# pgbouncer['auth_query'] = 'SELECT username, password FROM public.pg_shadow_lookup($1)'
+# pgbouncer['users'] = [
+#   {
+#     name: USERNAME,
+#     password: MD5_PASSWORD_HASH
+#   }
+# ]
+# postgresql['pgbouncer_user'] = nil
+# postgresql['pgbouncer_user_password'] = nil
+#
+
+################################################################################
+# Repmgr (EE only)
+################################################################################
+# repmgr['cluster'] = 'gitlab_cluster'
+# repmgr['database'] = 'gitlab_repmgr'
+# repmgr['host'] = nil
+# repmgr['node_number'] = nil
+# repmgr['port'] = 5432
+# repmgr['trust_auth_cidr_addresses'] = []
+# repmgr['user'] = 'gitlab_repmgr'
+
+################################################################################
+# Consul (EEP only)
+################################################################################
+# consul['enable'] = false
+# consul['dir'] = '/var/opt/gitlab/consul'
+# consul['user'] = 'gitlab-consul'
+# consul['config_file'] = '/var/opt/gitlab/consul/config.json'
+# consul['config_dir'] = '/var/opt/gitlab/consul/config.d'
+# consul['data_dir'] = '/var/opt/gitlab/consul/data'
+# consul['log_directory'] = '/var/log/gitlab/consul'
+# consul['script_directory'] = '/var/opt/gitlab/consul/scripts'
+# consul['configuration'] = {
+#   'client_addr' => nil,
+#   'datacenter' => 'gitlab_consul',
+#   'enable_script_checks' => true,
+#   'server' => false
+# }
+# consul['services'] = []
+# consul['service_config'] = {
+#   'postgresql' => {
+#     'service' => {
+#       'name' => "postgresql",
+#       'address' => '',
+#       'port' => 5432,
+#       'checks' => [
+#         {
+#           'script' => "/var/opt/gitlab/consul/scripts/check_postgresql",
+#           'interval' => "10s"
+#         }
+#       ]
+#     }
+#   }
+# }
+# consul['watchers'] = {
+#   'postgresql' => {
+#     enable: false,
+#     handler: 'failover_pgbouncer'
+#   }
+# }
diff --git a/roles/gitlab-omnibus-9/tasks/main.yml b/roles/gitlab-omnibus-9/tasks/main.yml
new file mode 100644
index 00000000..82072b97
--- /dev/null
+++ b/roles/gitlab-omnibus-9/tasks/main.yml
@@ -0,0 +1,122 @@
+---
+# file: roles/docker-gitlab/tasks/main.yaml
+
+- assert:
+    that:
+    - gitlab_db_password is defined
+
+# *****************************************************************************
+# Setup the directory where the backup and restore is to take place
+
+- name: restore dir
+  file:
+    state: directory
+    path: '{{ gitlab_docker_restore_dir }}'
+    owner: root
+    group: tape
+    mode: 'u=rwx,g=rwx,o=rx'
+    recurse: no
+    setype: svirt_sandbox_file_t
+
+- name: docker_container.conf dir
+  file:
+    state: directory
+    path: '{{ gitlab_config_dir }}'
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rx,o=rx'
+    recurse: no
+
+# *****************************************************************************
+# backup script part
+
+- name: Assemble dir for backup scripts
+  file:
+    path: /usr/libexec/bacula/backup-scripts
+    state: directory
+
+- name: before_backup script part
+  template:
+    src: before_backup.j2
+    dest: /usr/libexec/bacula/backup-scripts/55.before_backup.gitlab
+
+- name: after_backup script part
+  template:
+    src: after_backup.j2
+    dest: /usr/libexec/bacula/backup-scripts/55.after_backup.gitlab
+
+# *****************************************************************************
+# update the Docker restore config
+
+# contains the database username and password
+- name: make gitlab.rb
+  template:
+    src: gitlab.rb.j2
+    dest: '{{ gitlab_config_dir }}/gitlab.rb'
+    backup: yes
+    owner: root
+    group: root
+    mode: 'u=rw,g=r,o='
+- name: exists - state file
+  stat:
+    path: '{{ gitlab_config_dir }}/restore.date.txt'
+    get_checksum: False
+    get_md5: False
+  register: st_gitlab_restore
+
+# *****************************************************************************
+# Create the data volumes
+
+- name: config-volume container (gitlab)
+  docker_volume:
+    name: '{{ gitlab_cv_name }}'
+
+
+- name: data-volume container (gitlab)
+  docker_volume:
+    name: '{{ gitlab_dv_name }}'
+
+# *****************************************************************************
+# Create the gitlab container
+
+- name: create container (gitlab)
+  docker_container:
+    name: '{{ gitlab_container_name }}'
+    detach: true
+    restart_policy: '{{ docker_restart_policy }}'
+    hostname: '{{ gitlab_hostname }}'
+    ports: '{{ gitlab_port_args }}'
+    networks:
+      - name: '{{ docker_network_frontend }}'
+    volumes:
+      - '{{ openssl_dv_name }}:/etc/ssl/private:z'
+      - '{{ gitlab_cv_name }}:/etc/gitlab:z'
+      - '{{ gitlab_dv_name }}:/var/opt/gitlab:z'
+      - '{{ gitlab_docker_backup_dir }}:/mnt/backups:z'
+    image: '{{ gitlab_image_name }}'
+    state: present
+
+- name: Copy config into container
+  command: >
+    docker cp
+    '{{ gitlab_config_dir }}/gitlab.rb'
+    '{{ gitlab_container_name }}:/etc/gitlab/gitlab.rb'
+
+- name: start container (gitlab)
+  docker_container:
+    name: '{{ gitlab_container_name }}'
+    state: started
+
+- name: Wait for gitlab to be fully running
+  wait_for:
+    delay: 10
+    host: '{{ gitlab_network.ip_addr }}'
+    port: 22
+    state: started
+    timeout: 180
+
+# *****************************************************************************
+# restore?
+
+- include_tasks: restore.yml
+  when: st_gitlab_restore.stat.exists == False
diff --git a/roles/gitlab-omnibus-9/tasks/restore.yml b/roles/gitlab-omnibus-9/tasks/restore.yml
new file mode 100644
index 00000000..aeeef7a4
--- /dev/null
+++ b/roles/gitlab-omnibus-9/tasks/restore.yml
@@ -0,0 +1,95 @@
+---
+# file: roles/docker-gitlab/tasks/restore.yaml
+
+# *****************************************************************************
+# Get data from tape
+
+- name: find files
+  find:
+    path: '{{ gitlab_docker_restore_dir }}'
+    file_type: any
+  register: gitlab_backup
+
+- name: data from tape
+  bacula:
+    command: restore
+    storage: '{{ bacula_storage }}'
+    fileset: '{{ bacula_fileset }}'
+    dest: '{{ bacula_dest }}'
+    path_to_restore: '{{ gitlab_docker_backup_dir }}'
+  when: gitlab_backup.matched == 0
+
+- name: find files
+  find:
+    path: '{{ gitlab_docker_restore_dir }}'
+    file_type: any
+    follow: yes
+  register: gitlab_backup
+
+- name: File permissions
+  file:
+    path: '{{ gitlab_docker_restore_dir }}/{{ item }}'
+    state: touch
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rwx,o='
+  with_items: '{{ gitlab_backup.file_list | default([]) }}'
+
+# *****************************************************************************
+# restore the gitlab backup
+
+- name: Copy backup files to container
+  copy:
+    remote_src: yes
+    src: '{{ item.path }}'
+    dest: '{{ gitlab_docker_backup_dir }}/'
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rwx,o=rwx'
+  loop: "{{ gitlab_backup.files }}"
+
+- name: shut down gitlab services for restoration
+  command: >
+    docker exec -t {{ gitlab_container_name }} gitlab-ctl stop {{ item }}
+  loop:
+  - unicorn
+  - sidekiq
+
+- name: gitlab restore script
+  command: >
+    docker exec -t {{ gitlab_container_name }}
+    /bin/sh -c 'tar vxzf /mnt/backups/etc-gitlab-*.tgz -C /' 
+
+- name: gitlab restore script
+  command: >
+    docker exec -t {{ gitlab_container_name }}
+    gitlab-rake gitlab:backup:restore force=yes
+
+- name: reconfigure gitlab for updated configuration
+  command: >
+    docker exec -t {{ gitlab_container_name }} gitlab-ctl reconfigure
+
+- name: restart gitlab services
+  command: >
+    docker exec -t {{ gitlab_container_name }} gitlab-ctl start
+
+- name: Set root user password in restored database
+  command: >
+    docker exec -t {{ gitlab_container_name }} 
+    gitlab-rails runner 
+      'user=User.where(id: 1).first;
+       user.password="{{ gitlab_root_password }}";
+       user.password_confirmation="{{ gitlab_root_password }}";
+       user.save!'
+
+# *****************************************************************************
+# cleanup
+
+- name: Remove files
+  file:
+    path: '{{ gitlab_docker_restore_dir }}'
+    state: absent
+
+- name: State file
+  shell: 'date --rfc-3339=seconds > {{ gitlab_config_dir }}/restore.date.txt'
+  when: st_gitlab_restore.stat.exists == False
diff --git a/roles/gitlab-omnibus-9/templates/before_backup.j2 b/roles/gitlab-omnibus-9/templates/before_backup.j2
new file mode 100644
index 00000000..a85ea225
--- /dev/null
+++ b/roles/gitlab-omnibus-9/templates/before_backup.j2
@@ -0,0 +1,10 @@
+{% if gitlab_docker_backup_dir is defined %}
+
+# *****************************************************************************
+# Backup gitlab
+docker run --rm -v {{ docker_backup_dir }}:/tmp/import_export:z debian:latest bash -c "rm -rf /tmp/import_export/GIT"
+mkdir -p -m u=rwx,g=rwx,o= {{ gitlab_docker_backup_dir }}
+docker exec -t {{ gitlab_container_name }} gitlab_rake gitlab:backup:create
+docker exec -t {{ gitlab_container_name }} /bin/sh -c \
+    'umask 0077; tar czf /mnt/backups/$(date "+etc-gitlab-\%s.tgz") -C / etc/gitlab'
+{% endif %}
diff --git a/roles/gitlab-omnibus-9/templates/gitlab.rb.j2 b/roles/gitlab-omnibus-9/templates/gitlab.rb.j2
new file mode 100644
index 00000000..8102b4bb
--- /dev/null
+++ b/roles/gitlab-omnibus-9/templates/gitlab.rb.j2
@@ -0,0 +1,1726 @@
+## GitLab configuration settings
+##! This file is generated during initial installation and **is not** modified
+##! during upgrades.
+##! Check out the latest version of this file to know about the different
+##! settings that can be configured by this file, which may be found at:
+##! https://gitlab.com/gitlab-org/omnibus-gitlab/raw/master/files/gitlab-config-template/gitlab.rb.template
+
+
+## GitLab URL
+##! URL on which GitLab will be reachable.
+##! For more details on configuring external_url see:
+##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab
+external_url 'https://{{ gitlab_hostname }}'
+
+## Roles for multi-instance GitLab
+##! The default is to have no roles enabled, which results in GitLab running as an all-in-one instance.
+##! Options:
+##!   redis_sentinel_role redis_master_role redis_slave_role geo_primary_role geo_secondary_role
+##! For more deatils on each role, see:
+##! https://docs.gitlab.com/omnibus/roles/README.html#roles
+##!
+# roles ['redis_sentinel_role', 'redis_master_role']
+
+## Legend
+##! The following notations at the beginning of each line may be used to
+##! differentiate between components of this file and to easily select them using
+##! a regex.
+##! ## Titles, subtitles etc
+##! ##! More information - Description, Docs, Links, Issues etc.
+##! Configuration settings have a single # followed by a single space at the
+##! beginning; Remove them to enable the setting.
+
+##! **Configuration settings below are optional.**
+##! **The values currently assigned are only examples and ARE NOT the default
+##!   values.**
+
+
+################################################################################
+################################################################################
+##                Configuration Settings for GitLab CE and EE                 ##
+################################################################################
+################################################################################
+
+################################################################################
+## gitlab.yml configuration
+##! Docs: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/gitlab.yml.md
+################################################################################
+gitlab_rails['gitlab_ssh_host'] = '{{ gitlab_hostname }}'
+gitlab_rails['time_zone'] = 'America/Chicago'
+
+### Email Settings
+gitlab_rails['gitlab_email_enabled'] = true
+gitlab_rails['gitlab_email_from'] = 'gitlab@novatech-llc.com'
+gitlab_rails['gitlab_email_display_name'] = 'GitLab'
+gitlab_rails['gitlab_email_reply_to'] = 'noreply@novatech-llc.com'
+# gitlab_rails['gitlab_email_subject_suffix'] = ''
+
+### GitLab user privileges
+gitlab_rails['gitlab_default_can_create_group'] = true
+gitlab_rails['gitlab_username_changing_enabled'] = true
+
+### Default Theme
+# gitlab_rails['gitlab_default_theme'] = 2
+
+### Default project feature settings
+gitlab_rails['gitlab_default_projects_features_issues'] = true
+gitlab_rails['gitlab_default_projects_features_merge_requests'] = true
+gitlab_rails['gitlab_default_projects_features_wiki'] = false
+gitlab_rails['gitlab_default_projects_features_snippets'] = true
+# gitlab_rails['gitlab_default_projects_features_builds'] = true
+# gitlab_rails['gitlab_default_projects_features_container_registry'] = true
+
+### Automatic issue closing
+###! See https://docs.gitlab.com/ce/customization/issue_closing.html for more
+###! information about this pattern.
+# gitlab_rails['gitlab_issue_closing_pattern'] = "((?:[Cc]los(?:e[sd]?|ing)|[Ff]ix(?:e[sd]|ing)?|[Rr]esolv(?:e[sd]?|ing)|[Ii]mplement(?:s|ed|ing)?)(:?) +(?:(?:issues? +)?%{issue_ref}(?:(?:, *| +and +)?)|([A-Z][A-Z0-9_]+-\d+))+)"
+
+### Download location
+###! When a user clicks e.g. 'Download zip' on a project, a temporary zip file
+###! is created in the following directory.
+# gitlab_rails['gitlab_repository_downloads_path'] = 'tmp/repositories'
+
+### Gravatar Settings
+gitlab_rails['gravatar_plain_url'] = 'http://cdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+gitlab_rails['gravatar_ssl_url'] = 'https://seccdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'
+
+### Auxiliary jobs
+###! Periodically executed jobs, to self-heal Gitlab, do external
+###! synchronizations, etc.
+###! Docs: https://github.com/ondrejbartas/sidekiq-cron#adding-cron-job
+###!       https://docs.gitlab.com/ce/ci/yaml/README.html#artifacts:expire_in
+# gitlab_rails['stuck_ci_jobs_worker_cron'] = "0 0 * * *"
+# gitlab_rails['expire_build_artifacts_worker_cron'] = "50 * * * *"
+# gitlab_rails['pipeline_schedule_worker_cron'] = "41 * * * *"
+# gitlab_rails['repository_check_worker_cron'] = "20 * * * *"
+# gitlab_rails['admin_email_worker_cron'] = "0 0 * * 0"
+# gitlab_rails['repository_archive_cache_worker_cron'] = "0 * * * *"
+
+### Webhook Settings
+###! Number of seconds to wait for HTTP response after sending webhook HTTP POST
+###! request (default: 10)
+# gitlab_rails['webhook_timeout'] = 10
+
+### Trusted proxies
+###! Customize if you have GitLab behind a reverse proxy which is running on a
+###! different machine.
+###! **Add the IP address for your reverse proxy to the list, otherwise users
+###!   will appear signed in from that address.**
+# gitlab_rails['trusted_proxies'] = []
+
+### Monitoring settings
+###! IP whitelist controlling access to monitoring endpoints
+# gitlab_rails['monitoring_whitelist'] = ['127.0.0.0/8']
+###! Time between sampling of unicorn socket metrics, in seconds
+# gitlab_rails['monitoring_unicorn_sampler_interval'] = 10
+
+### Reply by email
+###! Allow users to comment on issues and merge requests by replying to
+###! notification emails.
+###! Docs: https://docs.gitlab.com/ce/administration/reply_by_email.html
+# gitlab_rails['incoming_email_enabled'] = true
+
+#### Incoming Email Address
+####! The email address including the `%{key}` placeholder that will be replaced
+####! to reference the item being replied to.
+####! **The placeholder can be omitted but if present, it must appear in the
+####!   "user" part of the address (before the `@`).**
+# gitlab_rails['incoming_email_address'] = "gitlab-incoming+%{key}@gmail.com"
+
+#### Email account username
+####! **With third party providers, this is usually the full email address.**
+####! **With self-hosted email servers, this is usually the user part of the
+####!   email address.**
+# gitlab_rails['incoming_email_email'] = "gitlab-incoming@gmail.com"
+
+#### Email account password
+# gitlab_rails['incoming_email_password'] = "[REDACTED]"
+
+#### IMAP Settings
+# gitlab_rails['incoming_email_host'] = "imap.gmail.com"
+# gitlab_rails['incoming_email_port'] = 993
+# gitlab_rails['incoming_email_ssl'] = true
+# gitlab_rails['incoming_email_start_tls'] = false
+
+#### Incoming Mailbox Settings
+####! The mailbox where incoming mail will end up. Usually "inbox".
+# gitlab_rails['incoming_email_mailbox_name'] = "inbox"
+####! The IDLE command timeout.
+# gitlab_rails['incoming_email_idle_timeout'] = 60
+
+### Job Artifacts
+# gitlab_rails['artifacts_enabled'] = true
+# gitlab_rails['artifacts_path'] = "/mnt/storage/artifacts"
+# gitlab_rails['artifacts_object_store_enabled'] = false # EE only
+# gitlab_rails['artifacts_object_store_remote_directory'] = "artifacts"
+# gitlab_rails['artifacts_object_store_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AWS_ACCESS_KEY_ID',
+#   'aws_secret_access_key' => 'AWS_SECRET_ACCESS_KEY',
+#   # # The below options configure an S3 compatible host instead of AWS
+#   # 'host' => 's3.amazonaws.com',
+#   # 'endpoint' => nil,
+#   # 'path_style' => false # Use 'host/bucket_name/object' instead of 'bucket_name.host/object'
+# }
+
+### Git LFS
+# gitlab_rails['lfs_enabled'] = true
+# gitlab_rails['lfs_storage_path'] = "/mnt/storage/lfs-objects"
+# gitlab_rails['lfs_object_store_enabled'] = false # EE only
+# gitlab_rails['lfs_object_store_background_upload'] = true
+# gitlab_rails['lfs_object_store_remote_directory'] = "lfs-objects"
+# gitlab_rails['lfs_object_store_connection'] = {
+#   'provider' => 'AWS',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AWS_ACCESS_KEY_ID',
+#   'aws_secret_access_key' => 'AWS_SECRET_ACCESS_KEY',
+#   # # The below options configure an S3 compatible host instead of AWS
+#   # 'host' => 's3.amazonaws.com',
+#   # 'endpoint' => nil,
+#   # 'path_style' => false # Use 'host/bucket_name/object' instead of 'bucket_name.host/object'
+# }
+
+### Usage Statistics
+# gitlab_rails['usage_ping_enabled'] = true
+
+### GitLab Mattermost
+###! These settings are void if Mattermost is installed on the same omnibus
+###! install
+# gitlab_rails['mattermost_host'] = "https://mattermost.example.com"
+
+### LDAP Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/ldap.html
+###! **Be careful not to break the indentation in the ldap_servers block. It is
+###!   in yaml format and the spaces must be retained. Using tabs will not work.**
+
+gitlab_rails['ldap_enabled'] = true
+
+###! **remember to close this block with 'EOS' below**
+gitlab_rails['ldap_servers'] = YAML.load <<-'EOS'
+  main: # 'main' is the GitLab 'provider ID' of this LDAP server
+    label: 'NovaTech'
+    host: '{{ openldap_hostname }}'
+    port: 389
+    uid: 'uid'
+    bind_dn: 'cn=proxyagent,dc=novatech'
+    password: '{{ gitlab_email_password }}'
+    encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+    verify_certificates: true
+    ca_file: ''
+    ssl_version: ''
+    active_directory: false
+    allow_username_or_email_login: true
+    block_auto_created_users: false
+    base: 'ou=user,dc=novatech'
+    user_filter: '(employeeType=gitlab)'
+    attributes:
+      username: ['uid', 'userid', 'sAMAccountName']
+      email:    ['mail', 'email', 'userPrincipalName']
+      name:       'cn'
+      first_name: 'givenName'
+      last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+#
+#   secondary: # 'secondary' is the GitLab 'provider ID' of second LDAP server
+#     label: 'LDAP'
+#     host: '_your_ldap_server'
+#     port: 389
+#     uid: 'sAMAccountName'
+#     bind_dn: '_the_full_dn_of_the_user_you_will_bind_with'
+#     password: '_the_password_of_the_bind_user'
+#     encryption: 'plain' # "start_tls" or "simple_tls" or "plain"
+#     verify_certificates: true
+#     ca_file: ''
+#     ssl_version: ''
+#     active_directory: true
+#     allow_username_or_email_login: false
+#     block_auto_created_users: false
+#     base: ''
+#     user_filter: ''
+#     attributes:
+#       username: ['uid', 'userid', 'sAMAccountName']
+#       email:    ['mail', 'email', 'userPrincipalName']
+#       name:       'cn'
+#       first_name: 'givenName'
+#       last_name:  'sn'
+#     ## EE only
+#     group_base: ''
+#     admin_group: ''
+#     sync_ssh_keys: false
+EOS
+
+### OmniAuth Settings
+###! Docs: https://docs.gitlab.com/ce/integration/omniauth.html
+# gitlab_rails['omniauth_enabled'] = false
+# gitlab_rails['omniauth_allow_single_sign_on'] = ['saml']
+# gitlab_rails['omniauth_sync_email_from_provider'] = 'saml'
+# gitlab_rails['omniauth_sync_profile_from_provider'] = ['saml']
+# gitlab_rails['omniauth_sync_profile_attributes'] = ['email']
+# gitlab_rails['omniauth_auto_sign_in_with_provider'] = 'saml'
+# gitlab_rails['omniauth_block_auto_created_users'] = true
+# gitlab_rails['omniauth_auto_link_ldap_user'] = false
+# gitlab_rails['omniauth_auto_link_saml_user'] = false
+# gitlab_rails['omniauth_external_providers'] = ['twitter', 'google_oauth2']
+# gitlab_rails['omniauth_providers'] = [
+#   {
+#     "name" => "google_oauth2",
+#     "app_id" => "YOUR APP ID",
+#     "app_secret" => "YOUR APP SECRET",
+#     "args" => { "access_type" => "offline", "approval_prompt" => "" }
+#   }
+# ]
+
+### Backup Settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/backups.html
+
+# gitlab_rails['manage_backup_path'] = true
+gitlab_rails['backup_path'] = "/mnt/backups"
+
+###! Docs: https://docs.gitlab.com/ce/raketasks/backup_restore.html#backup-archive-permissions
+gitlab_rails['backup_archive_permissions'] = 0644
+
+gitlab_rails['backup_pg_schema'] = 'public'
+
+###! The duration in seconds to keep backups before they are allowed to be deleted
+gitlab_rails['backup_keep_time'] = 604800
+
+gitlab_rails['backup_upload_connection'] = {
+  :provider => 'Local',
+#   'region' => 'eu-west-1',
+#   'aws_access_key_id' => 'AKIAKIAKI',
+#   'aws_secret_access_key' => 'secret123'
+:local_root => '/mnt/backups'
+}
+gitlab_rails['backup_upload_remote_directory'] = '.'
+# gitlab_rails['backup_multipart_chunk_size'] = 104857600
+
+###! **Turns on AWS Server-Side Encryption with Amazon S3-Managed Keys for
+###!   backups**
+# gitlab_rails['backup_encryption'] = 'AES256'
+
+###! **Specifies Amazon S3 storage class to use for backups. Valid values
+###!   include 'STANDARD', 'STANDARD_IA', 'GLACIER', and
+###!   'REDUCED_REDUNDANCY'**
+# gitlab_rails['backup_storage_class'] = 'STANDARD'
+
+### For setting up different data storing directory
+###! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#storing-git-data-in-an-alternative-directory
+###! **If you want to use a single non-default directory to store git data use a
+###!   path that doesn't contain symlinks.**
+# git_data_dirs({
+#   "default" => {
+#     "path" => "/mnt/nfs-01/git-data",
+#     "failure_count_threshold" => 10,
+#     "failure_wait_time" => 30,
+#     "failure_reset_time" => 1800,
+#     "storage_timeout" => 30
+#    }
+# })
+
+### Gitaly settings
+# gitlab_rails['gitaly_token'] = 'secret token'
+
+### For storing GitLab application uploads, eg. LFS objects, build artifacts
+###! Docs: https://docs.gitlab.com/ce/development/shared_files.html
+# gitlab_rails['shared_path'] = '/var/opt/gitlab/gitlab-rails/shared'
+
+### GitLab Shell settings for GitLab
+# gitlab_rails['gitlab_shell_ssh_port'] = 22
+# gitlab_rails['gitlab_shell_git_timeout'] = 800
+
+### Extra customization
+# gitlab_rails['extra_google_analytics_id'] = '_your_tracking_id'
+# gitlab_rails['extra_piwik_url'] = '_your_piwik_url'
+# gitlab_rails['extra_piwik_site_id'] = '_your_piwik_site_id'
+
+##! Docs: https://docs.gitlab.com/omnibus/settings/environment-variables.html
+# gitlab_rails['env'] = {
+#   'BUNDLE_GEMFILE' => "/opt/gitlab/embedded/service/gitlab-rails/Gemfile",
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+# gitlab_rails['rack_attack_git_basic_auth'] = {
+#   'enabled' => true,
+#   'ip_whitelist' => ["127.0.0.1"],
+#   'maxretry' => 10,
+#   'findtime' => 60,
+#   'bantime' => 3600
+# }
+
+# gitlab_rails['rack_attack_protected_paths'] = [
+#   '/users/password',
+#   '/users/sign_in',
+#   '/api/#{API::API.version}/session.json',
+#   '/api/#{API::API.version}/session',
+#   '/users',
+#   '/users/confirmation',
+#   '/unsubscribes/',
+#   '/import/github/personal_access_token'
+# ]
+
+###! **We do not recommend changing these directories.**
+# gitlab_rails['dir'] = "/var/opt/gitlab/gitlab-rails"
+# gitlab_rails['log_directory'] = "/var/log/gitlab/gitlab-rails"
+
+### GitLab application settings
+# gitlab_rails['uploads_directory'] = "/var/opt/gitlab/gitlab-rails/uploads"
+# gitlab_rails['rate_limit_requests_per_period'] = 10
+# gitlab_rails['rate_limit_period'] = 60
+
+#### Change the initial default admin password and shared runner registraion tokens.
+####! **Only applicable on initial setup, changing these settings after database
+####!   is created and seeded won't yield any change.**
+gitlab_rails['initial_root_password'] = "{{ gitlab_root_password }}"
+# gitlab_rails['initial_shared_runners_registration_token'] = "token"
+
+#### Enable or disable automatic database migrations
+# gitlab_rails['auto_migrate'] = true
+
+#### This is advanced feature used by large gitlab deployments where loading
+#### whole RAILS env takes a lot of time.
+# gitlab_rails['rake_cache_clear'] = true
+
+### GitLab database settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/database.html
+###! **Only needed if you use an external database.**
+# gitlab_rails['db_adapter'] = "postgresql"
+# gitlab_rails['db_encoding'] = "unicode"
+# gitlab_rails['db_collation'] = nil
+# gitlab_rails['db_database'] = "gitlabhq_production"
+# gitlab_rails['db_pool'] = 10
+# gitlab_rails['db_username'] = "gitlab"
+# gitlab_rails['db_password'] = nil
+# gitlab_rails['db_host'] = nil
+# gitlab_rails['db_port'] = 5432
+# gitlab_rails['db_socket'] = nil
+# gitlab_rails['db_sslmode'] = nil
+# gitlab_rails['db_sslrootcert'] = nil
+# gitlab_rails['db_prepared_statements'] = true
+# gitlab_rails['db_statements_limit'] = 1000
+
+
+### GitLab Redis settings
+###! Connect to your own Redis instance
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+
+#### Redis TCP connection
+# gitlab_rails['redis_host'] = "127.0.0.1"
+# gitlab_rails['redis_port'] = 6379
+# gitlab_rails['redis_password'] = nil
+# gitlab_rails['redis_database'] = 0
+
+#### Redis local UNIX socket (will be disabled if TCP method is used)
+# gitlab_rails['redis_socket'] = "/var/opt/gitlab/redis/redis.socket"
+
+#### Sentinel support
+####! To have Sentinel working, you must enable Redis TCP connection support
+####! above and define a few Sentinel hosts below (to get a reliable setup
+####! at least 3 hosts).
+####! **You don't need to list every sentinel host, but the ones not listed will
+####!   not be used in a fail-over situation to query for the new master.**
+# gitlab_rails['redis_sentinels'] = [
+#   {'host' => '127.0.0.1', 'port' => 26379},
+# ]
+
+### GitLab email server settings
+###! Docs: https://docs.gitlab.com/omnibus/settings/smtp.html
+###! **Use smtp instead of sendmail/postfix.**
+
+gitlab_rails['smtp_enable'] = true
+gitlab_rails['smtp_address'] = "{{ exim4_hostname }}"
+gitlab_rails['smtp_port'] = 465
+gitlab_rails['smtp_user_name'] = "gitlab"
+gitlab_rails['smtp_password'] = "{{ gitlab_email_password }}"
+gitlab_rails['smtp_domain'] = "novatech-llc.com"
+gitlab_rails['smtp_authentication'] = "login"
+gitlab_rails['smtp_enable_starttls_auto'] = true
+gitlab_rails['smtp_tls'] = true
+
+###! **Can be: 'none', 'peer', 'client_once', 'fail_if_no_peer_cert'**
+###! Docs: http://api.rubyonrails.org/classes/ActionMailer/Base.html
+# gitlab_rails['smtp_openssl_verify_mode'] = 'none'
+
+# gitlab_rails['smtp_ca_path'] = "/etc/ssl/certs"
+# gitlab_rails['smtp_ca_file'] = "/etc/ssl/certs/ca-certificates.crt"
+
+################################################################################
+## Container Registry settings
+##! Docs: https://docs.gitlab.com/ce/administration/container_registry.html
+################################################################################
+
+# registry_external_url 'https://registry.gitlab.example.com'
+
+### Settings used by GitLab application
+# gitlab_rails['registry_enabled'] = true
+# gitlab_rails['registry_host'] = "registry.gitlab.example.com"
+# gitlab_rails['registry_port'] = "5005"
+# gitlab_rails['registry_path'] = "/var/opt/gitlab/gitlab-rails/shared/registry"
+
+###! **Do not change the following 3 settings unless you know what you are
+###!   doing**
+# gitlab_rails['registry_api_url'] = "http://localhost:5000"
+# gitlab_rails['registry_key_path'] = "/var/opt/gitlab/gitlab-rails/certificate.key"
+# gitlab_rails['registry_issuer'] = "omnibus-gitlab-issuer"
+
+### Settings used by Registry application
+# registry['enable'] = true
+# registry['username'] = "registry"
+# registry['group'] = "registry"
+# registry['uid'] = nil
+# registry['gid'] = nil
+# registry['dir'] = "/var/opt/gitlab/registry"
+# registry['registry_http_addr'] = "localhost:5000"
+# registry['debug_addr'] = "localhost:5001"
+# registry['log_directory'] = "/var/log/gitlab/registry"
+# registry['log_level'] = "info"
+# registry['rootcertbundle'] = "/var/opt/gitlab/registry/certificate.crt"
+# registry['storage_delete_enabled'] = true
+
+### Registry backend storage
+###! Docs: https://docs.gitlab.com/ce/administration/container_registry.html#container-registry-storage-driver
+# registry['storage'] = {
+#   's3' => {
+#     'accesskey' => 'AKIAKIAKI',
+#     'secretkey' => 'secret123',
+#     'bucket' => 'gitlab-registry-bucket-AKIAKIAKI'
+#   }
+# }
+
+### Registry notifications endpoints
+# registry['notifications'] = [
+#   {
+#     'name' => 'test_endpoint',
+#     'url' => 'https://gitlab.example.com/notify2',
+#     'timeout' => '500ms',
+#     'threshold' => 5,
+#     'backoff' => '1s',
+#     'headers' => {
+#       "Authorization" => ["AUTHORIZATION_EXAMPLE_TOKEN"]
+#     }
+#   }
+# ]
+### Default registry notifications
+# registry['default_notifications_timeout'] = "500ms"
+# registry['default_notifications_threshold'] = 5
+# registry['default_notifications_backoff'] = "1s"
+# registry['default_notifications_headers'] = {}
+
+
+
+################################################################################
+## GitLab Workhorse
+##! Docs: https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/README.md
+################################################################################
+
+# gitlab_workhorse['enable'] = true
+# gitlab_workhorse['ha'] = false
+# gitlab_workhorse['listen_network'] = "unix"
+# gitlab_workhorse['listen_umask'] = 000
+# gitlab_workhorse['listen_addr'] = "/var/opt/gitlab/gitlab-workhorse/socket"
+# gitlab_workhorse['auth_backend'] = "http://localhost:8080"
+
+##! the empty string is the default in gitlab-workhorse option parser
+# gitlab_workhorse['auth_socket'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['pprof_listen_addr'] = "''"
+
+##! put an empty string on the command line
+# gitlab_workhorse['prometheus_listen_addr'] = "''"
+
+# gitlab_workhorse['dir'] = "/var/opt/gitlab/gitlab-workhorse"
+# gitlab_workhorse['log_directory'] = "/var/log/gitlab/gitlab-workhorse"
+# gitlab_workhorse['proxy_headers_timeout'] = "1m0s"
+
+##! limit number of concurrent API requests, defaults to 0 which is unlimited
+# gitlab_workhorse['api_limit'] = 0
+
+##! limit number of API requests allowed to be queued, defaults to 0 which
+##! disables queuing
+# gitlab_workhorse['api_queue_limit'] = 0
+
+##! duration after which we timeout requests if they sit too long in the queue
+# gitlab_workhorse['api_queue_duration'] = "30s"
+
+##! Long polling duration for job requesting for runners
+# gitlab_workhorse['api_ci_long_polling_duration'] = "60s"
+
+# gitlab_workhorse['env'] = {
+#   'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin"
+# }
+
+################################################################################
+## GitLab User Settings
+##! Modify default git user.
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#changing-the-name-of-the-git-user-group
+################################################################################
+
+# user['username'] = "git"
+# user['group'] = "git"
+# user['uid'] = nil
+# user['gid'] = nil
+
+##! The shell for the git user
+# user['shell'] = "/bin/sh"
+
+##! The home directory for the git user
+# user['home'] = "/var/opt/gitlab"
+
+# user['git_user_name'] = "GitLab"
+# user['git_user_email'] = "gitlab@#{node['fqdn']}"
+
+################################################################################
+## GitLab Unicorn
+##! Tweak unicorn settings.
+##! Docs: https://docs.gitlab.com/omnibus/settings/unicorn.html
+################################################################################
+
+# unicorn['worker_timeout'] = 60
+###! Minimum worker_processes is 2 at this moment
+###! See https://gitlab.com/gitlab-org/gitlab-ce/issues/18771
+# unicorn['worker_processes'] = 2
+
+### Advanced settings
+# unicorn['listen'] = '127.0.0.1'
+# unicorn['port'] = 8080
+# unicorn['socket'] = '/var/opt/gitlab/gitlab-rails/sockets/gitlab.socket'
+# unicorn['pidfile'] = '/opt/gitlab/var/unicorn/unicorn.pid'
+# unicorn['tcp_nopush'] = true
+# unicorn['backlog_socket'] = 1024
+
+###! **Make sure somaxconn is equal or higher then backlog_socket**
+# unicorn['somaxconn'] = 1024
+
+###! **We do not recommend changing this setting**
+# unicorn['log_directory'] = "/var/log/gitlab/unicorn"
+
+### **Only change these settings if you understand well what they mean**
+###! Docs: https://about.gitlab.com/2015/06/05/how-gitlab-uses-unicorn-and-unicorn-worker-killer/
+###!       https://github.com/kzk/unicorn-worker-killer
+# unicorn['worker_memory_limit_min'] = "400 * 1 << 20"
+# unicorn['worker_memory_limit_max'] = "650 * 1 << 20"
+
+################################################################################
+## GitLab Sidekiq
+################################################################################
+
+# sidekiq['log_directory'] = "/var/log/gitlab/sidekiq"
+# sidekiq['shutdown_timeout'] = 4
+# sidekiq['concurrency'] = 25
+
+################################################################################
+## gitlab-shell
+################################################################################
+
+# gitlab_shell['audit_usernames'] = false
+# gitlab_shell['log_level'] = 'INFO'
+# gitlab_shell['http_settings'] = { user: 'username', password: 'password', ca_file: '/etc/ssl/cert.pem', ca_path: '/etc/pki/tls/certs', self_signed_cert: false}
+# gitlab_shell['log_directory'] = "/var/log/gitlab/gitlab-shell/"
+# gitlab_shell['custom_hooks_dir'] = "/opt/gitlab/embedded/service/gitlab-shell/hooks"
+
+# gitlab_shell['auth_file'] = "/var/opt/gitlab/.ssh/authorized_keys"
+
+### Git trace log file.
+###! If set, git commands receive GIT_TRACE* environment variables
+###! Docs: https://git-scm.com/book/es/v2/Git-Internals-Environment-Variables#Debugging
+###! An absolute path starting with /  the trace output will be appended to
+###! that file. It needs to exist so we can check permissions and avoid
+###! throwing warnings to the users.
+# gitlab_shell['git_trace_log_file'] = "/var/log/gitlab/gitlab-shell/gitlab-shell-git-trace.log"
+
+##! **We do not recommend changing this directory.**
+# gitlab_shell['dir'] = "/var/opt/gitlab/gitlab-shell"
+
+################################################################
+## GitLab PostgreSQL
+################################################################
+
+###! Changing any of these settings requires a restart of postgresql.
+###! By default, reconfigure reloads postgresql if it is running. If you
+###! change any of these settings, be sure to run `gitlab-ctl restart postgresql`
+###! after reconfigure in order for the changes to take effect.
+# postgresql['enable'] = true
+# postgresql['listen_address'] = nil
+# postgresql['port'] = 5432
+# postgresql['data_dir'] = "/var/opt/gitlab/postgresql/data"
+
+##! **recommend value is 1/4 of total RAM, up to 14GB.**
+# postgresql['shared_buffers'] = "256MB"
+
+### Advanced settings
+# postgresql['ha'] = false
+# postgresql['dir'] = "/var/opt/gitlab/postgresql"
+# postgresql['log_directory'] = "/var/log/gitlab/postgresql"
+# postgresql['username'] = "gitlab-psql"
+# postgresql['uid'] = nil
+# postgresql['gid'] = nil
+# postgresql['shell'] = "/bin/sh"
+# postgresql['home'] = "/var/opt/gitlab/postgresql"
+# postgresql['user_path'] = "/opt/gitlab/embedded/bin:/opt/gitlab/bin:$PATH"
+# postgresql['sql_user'] = "gitlab"
+# postgresql['max_connections'] = 200
+# postgresql['md5_auth_cidr_addresses'] = []
+# postgresql['trust_auth_cidr_addresses'] = []
+# postgresql['wal_buffers'] = "-1"
+# postgresql['autovacuum_max_workers'] = "3"
+# postgresql['autovacuum_freeze_max_age'] = "200000000"
+# postgresql['track_activity_query_size'] = "1024"
+# postgresql['shared_preload_libraries'] = nil
+# postgresql['dynamic_shared_memory_type'] = nil
+# postgresql['hot_standby'] = "off"
+
+### Replication settings
+###! Note, some replication settings do not require a full restart. They are documented below.
+# postgresql['wal_level'] = "hot_standby"
+# postgresql['max_wal_senders'] = 5
+# postgresql['max_replication_slots'] = 0
+# postgresql['max_locks_per_transaction'] = 128
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_mode'] = "off"
+
+###! Changing any of these settings only requires a reload of postgresql. You do not need to
+###! restart postgresql if you change any of these and run reconfigure.
+# postgresql['work_mem'] = "16MB"
+# postgresql['maintenance_work_mem'] = "16MB"
+# postgresql['checkpoint_segments'] = 10
+# postgresql['checkpoint_timeout'] = "5min"
+# postgresql['checkpoint_completion_target'] = 0.9
+# postgresql['effective_io_concurrency'] = 1
+# postgresql['checkpoint_warning'] = "30s"
+# postgresql['effective_cache_size'] = "1MB"
+# postgresql['shmmax'] =  17179869184 # or 4294967295
+# postgresql['shmall'] =  4194304 # or 1048575
+# postgresql['autovacuum'] = "on"
+# postgresql['log_autovacuum_min_duration'] = "-1"
+# postgresql['autovacuum_naptime'] = "1min"
+# postgresql['autovacuum_vacuum_threshold'] = "50"
+# postgresql['autovacuum_analyze_threshold'] = "50"
+# postgresql['autovacuum_vacuum_scale_factor'] = "0.02"
+# postgresql['autovacuum_analyze_scale_factor'] = "0.01"
+# postgresql['autovacuum_vacuum_cost_delay'] = "20ms"
+# postgresql['autovacuum_vacuum_cost_limit'] = "-1"
+# postgresql['statement_timeout'] = "60000"
+# postgresql['idle_in_transaction_session_timeout'] = "60000"
+# postgresql['log_line_prefix'] = "%a"
+# postgresql['max_worker_processes'] = 8
+# postgreslq['max_parallel_workers_per_gather'] = 0
+# postgresql['log_lock_waits'] = 1
+# postgresql['deadlock_timeout'] = '5s'
+# postgresql['track_io_timing'] = 0
+
+### Available in PostgreSQL 9.6 and later
+# postgresql['min_wal_size'] = 80MB
+# postgresql['max_wal_size'] = 1GB
+
+# Backup/Archive settings
+# default['gitlab']['postgresql']['archive_command'] = nil
+# default['gitlab']['postgresql']['archive_timeout'] = "60"
+
+### Replication settings
+# postgresql['sql_replication_user'] = "gitlab_replicator"
+# postgresql['wal_keep_segments'] = 10
+# postgresql['max_standby_archive_delay'] = "30s"
+# postgresql['max_standby_streaming_delay'] = "30s"
+# postgresql['synchronous_commit'] = on
+# postgresql['synchronous_standby_names'] = ''
+# postgresql['hot_standby_feedback'] = 'off'
+# postgresql['random_page_cost'] = 2.0
+# postgresql['log_temp_files'] = -1
+# postgresql['log_checkpoints'] = 'off'
+# To add custom entries to pg_hba.conf use the following
+# postgresql['custom_pg_hba_entries'] = {
+#   APPLICATION: { # APPLICATION should identify what the settings are used for
+#     type: example,
+#     database: example,
+#     user: example,
+#     cidr: example,
+#     method: example,
+#     option: exmple
+#   }
+# }
+# See https://www.postgresql.org/docs/9.6/static/auth-pg-hba-conf.html for an explanation
+# of the values
+
+
+################################################################################
+## GitLab Redis
+##! **Can be disabled if you are using your own Redis instance.**
+##! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+################################################################################
+
+# redis['enable'] = true
+# redis['username'] = "gitlab-redis"
+# redis['maxclients'] = "10000"
+# redis['tcp_timeout'] = "60"
+# redis['tcp_keepalive'] = "300"
+# redis['uid'] = nil
+# redis['gid'] = nil
+
+###! **To enable only Redis service in this machine, uncomment
+###!   one of the lines below (choose master or slave instance types).**
+###! Docs: https://docs.gitlab.com/omnibus/settings/redis.html
+###!       https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_master_role['enable'] = true
+# redis_slave_role['enable'] = true
+
+### Redis TCP support (will disable UNIX socket transport)
+# redis['bind'] = '0.0.0.0' # or specify an IP to bind to a single one
+# redis['port'] = 6379
+# redis['password'] = 'redis-password-goes-here'
+
+### Redis Sentinel support
+###! **You need a master slave Redis replication to be able to do failover**
+###! **Please read the documentation before enabling it to understand the
+###!   caveats:**
+###! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+
+### Replication support
+#### Slave Redis instance
+# redis['master'] = false # by default this is true
+
+#### Slave and Sentinel shared configuration
+####! **Both need to point to the master Redis instance to get replication and
+####!   heartbeat monitoring**
+# redis['master_name'] = 'gitlab-redis'
+# redis['master_ip'] = nil
+# redis['master_port'] = 6379
+
+####! **Master password should have the same value defined in
+####!   redis['password'] to enable the instance to transition to/from
+####!   master/slave in a failover event.**
+# redis['master_password'] = 'redis-password-goes-here'
+
+####! Increase these values when your slaves can't catch up with master
+# redis['client_output_buffer_limit_normal'] = '0 0 0'
+# redis['client_output_buffer_limit_slave'] = '256mb 64mb 60'
+# redis['client_output_buffer_limit_pubsub'] = '32mb 8mb 60'
+
+#####! Redis snapshotting frequency
+#####! Set to [] to disable
+#####! Set to [''] to clear previously set values
+# redis['save'] = [ '900 1', '300 10', '60 10000' ]
+
+################################################################################
+## GitLab Web server
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#using-a-non-bundled-web-server
+################################################################################
+
+##! When bundled nginx is disabled we need to add the external webserver user to
+##! the GitLab webserver group.
+# web_server['external_users'] = []
+# web_server['username'] = 'gitlab-www'
+# web_server['group'] = 'gitlab-www'
+# web_server['uid'] = nil
+# web_server['gid'] = nil
+# web_server['shell'] = '/bin/false'
+# web_server['home'] = '/var/opt/gitlab/nginx'
+
+################################################################################
+## GitLab NGINX
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html
+################################################################################
+
+nginx['enable'] = true
+# nginx['client_max_body_size'] = '250m'
+nginx['redirect_http_to_https'] = true
+# nginx['redirect_http_to_https_port'] = 80
+
+##! Most root CA's are included by default
+# nginx['ssl_client_certificate'] = "/etc/gitlab/ssl/ca.crt"
+
+##! enable/disable 2-way SSL client authentication
+# nginx['ssl_verify_client'] = "off"
+
+##! if ssl_verify_client on, verification depth in the client certificates chain
+# nginx['ssl_verify_depth'] = "1"
+
+nginx['ssl_certificate'] = "/etc/ssl/private/nginx.crt"
+nginx['ssl_certificate_key'] = "/etc/ssl/private/nginx.key"
+# nginx['ssl_ciphers'] = "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"
+# nginx['ssl_prefer_server_ciphers'] = "on"
+
+##! **Recommended by: https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html
+##!                   https://cipherli.st/**
+# nginx['ssl_protocols'] = "TLSv1.1 TLSv1.2"
+
+##! **Recommended in: https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_cache'] = "builtin:1000  shared:SSL:10m"
+
+##! **Default according to https://nginx.org/en/docs/http/ngx_http_ssl_module.html**
+# nginx['ssl_session_timeout'] = "5m"
+
+nginx['ssl_dhparam'] = "/etc/ssl/private/dhparam.pem" # Path to dhparams.pem, eg. /etc/gitlab/ssl/dhparams.pem
+# nginx['listen_addresses'] = ['*', '[::]']
+
+##! **Defaults to forcing web browsers to always communicate using only HTTPS**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-http-strict-transport-security
+# nginx['hsts_max_age'] = 31536000
+# nginx['hsts_include_subdomains'] = false
+
+##! **Override only if you use a reverse proxy**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-the-nginx-listen-port
+nginx['listen_port'] = 443
+
+##! **Override only if your reverse proxy internally communicates over HTTP**
+##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#supporting-proxied-ssl
+# nginx['listen_https'] = nil
+
+# nginx['custom_gitlab_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# nginx['custom_nginx_config'] = "include /etc/nginx/conf.d/example.conf;"
+# nginx['proxy_read_timeout'] = 3600
+# nginx['proxy_connect_timeout'] = 300
+# nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host_with_default",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on",
+#  "Upgrade" => "$http_upgrade",
+#  "Connection" => "$connection_upgrade"
+# }
+# nginx['proxy_cache_path'] = 'proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2'
+# nginx['proxy_cache'] = 'gitlab'
+# nginx['http2_enabled'] = true
+# nginx['real_ip_trusted_addresses'] = []
+# nginx['real_ip_header'] = nil
+# nginx['real_ip_recursive'] = nil
+# nginx['custom_error_pages'] = {
+#   '404' => {
+#     'title' => 'Example title',
+#     'header' => 'Example header',
+#     'message' => 'Example message'
+#   }
+# }
+
+### Advanced settings
+# nginx['dir'] = "/var/opt/gitlab/nginx"
+# nginx['log_directory'] = "/var/log/gitlab/nginx"
+# nginx['worker_processes'] = 4
+# nginx['worker_connections'] = 10240
+# nginx['log_format'] = '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"'
+# nginx['sendfile'] = 'on'
+# nginx['tcp_nopush'] = 'on'
+# nginx['tcp_nodelay'] = 'on'
+# nginx['gzip'] = "on"
+# nginx['gzip_http_version'] = "1.0"
+# nginx['gzip_comp_level'] = "2"
+# nginx['gzip_proxied'] = "any"
+# nginx['gzip_types'] = [ "text/plain", "text/css", "application/x-javascript", "text/xml", "application/xml", "application/xml+rss", "text/javascript", "application/json" ]
+# nginx['keepalive_timeout'] = 65
+# nginx['cache_max_size'] = '5000m'
+# nginx['server_names_hash_bucket_size'] = 64
+
+### Nginx status
+# nginx['status'] = {
+#  "enable" => true,
+#  "listen_addresses" => ["127.0.0.1"],
+#  "fqdn" => "dev.example.com",
+#  "port" => 9999,
+#  "options" => {
+#    "stub_status" => "on", # Turn on stats
+#    "server_tokens" => "off", # Don't show the version of NGINX
+#    "access_log" => "off", # Disable logs for stats
+#    "allow" => "127.0.0.1", # Only allow access from localhost
+#    "deny" => "all" # Deny access to anyone else
+#  }
+# }
+
+################################################################################
+## GitLab Logging
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html
+################################################################################
+
+# logging['svlogd_size'] = 200 * 1024 * 1024 # rotate after 200 MB of log data
+# logging['svlogd_num'] = 30 # keep 30 rotated log files
+# logging['svlogd_timeout'] = 24 * 60 * 60 # rotate after 24 hours
+# logging['svlogd_filter'] = "gzip" # compress logs with gzip
+# logging['svlogd_udp'] = nil # transmit log messages via UDP
+# logging['svlogd_prefix'] = nil # custom prefix for log messages
+# logging['logrotate_frequency'] = "daily" # rotate logs daily
+# logging['logrotate_size'] = nil # do not rotate by size by default
+# logging['logrotate_rotate'] = 30 # keep 30 rotated logs
+# logging['logrotate_compress'] = "compress" # see 'man logrotate'
+# logging['logrotate_method'] = "copytruncate" # see 'man logrotate'
+# logging['logrotate_postrotate'] = nil # no postrotate command by default
+# logging['logrotate_dateformat'] = nil # use date extensions for rotated files rather than numbers e.g. a value of "-%Y-%m-%d" would give rotated files like production.log-2016-03-09.gz
+
+### UDP log forwarding
+##! Docs: http://docs.gitlab.com/omnibus/settings/logs.html#udp-log-forwarding
+
+##! remote host to ship log messages to via UDP
+# logging['udp_log_shipping_host'] = nil
+
+##! override the hostname used when logs are shipped via UDP,
+##  by default the system hostname will be used.
+# logging['udp_log_shipping_hostname'] = nil
+
+##! remote port to ship log messages to via UDP
+# logging['udp_log_shipping_port'] = 514
+
+################################################################################
+## Logrotate
+##! Docs: https://docs.gitlab.com/omnibus/settings/logs.html#logrotate
+##! You can disable built in logrotate feature.
+################################################################################
+# logrotate['enable'] = true
+
+################################################################################
+## Users and groups accounts
+##! Disable management of users and groups accounts.
+##! **Set only if creating accounts manually**
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-user-and-group-account-management
+################################################################################
+
+# manage_accounts['enable'] = false
+
+################################################################################
+## Storage directories
+##! Disable managing storage directories
+##! Docs: https://docs.gitlab.com/omnibus/settings/configuration.html#disable-storage-directories-management
+################################################################################
+
+##! **Set only if the select directories are created manually**
+# manage_storage_directories['enable'] = false
+# manage_storage_directories['manage_etc'] = false
+
+################################################################################
+## Runtime directory
+##! Docs: https://docs.gitlab.com//omnibus/settings/configuration.html#configuring-runtime-directory
+################################################################################
+
+# runtime_dir '/run'
+
+################################################################################
+## Git
+##! Advanced setting for configuring git system settings for omnibus-gitlab
+##! internal git
+################################################################################
+
+##! For multiple options under one header use array of comma separated values,
+##! eg.:
+##! { "receive" => ["fsckObjects = true"], "alias" => ["st = status", "co = checkout"] }
+
+# omnibus_gitconfig['system'] = {
+#  "pack" => ["threads = 1"],
+#  "receive" => ["fsckObjects = true"],
+#  "repack" => ["writeBitmaps = true"],
+#  "transfer" => ["hideRefs=^refs/tmp/", "hideRefs=^refs/keep-around/"],
+# }
+
+################################################################################
+## GitLab Pages
+##! Docs: https://docs.gitlab.com/ce/pages/administration.html
+################################################################################
+
+##! Define to enable GitLab Pages
+# pages_external_url "http://pages.example.com/"
+# gitlab_pages['enable'] = false
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTP
+# gitlab_pages['external_http'] = []
+
+##! Configure to expose GitLab Pages on external IP address, serving the HTTPS
+# gitlab_pages['external_https'] = []
+
+# gitlab_pages['listen_proxy'] = "localhost:8090"
+# gitlab_pages['redirect_http'] = true
+# gitlab_pages['use_http2'] = true
+# gitlab_pages['dir'] = "/var/opt/gitlab/gitlab-pages"
+# gitlab_pages['log_directory'] = "/var/log/gitlab/gitlab-pages"
+
+# gitlab_pages['artifacts_server'] = true
+# gitlab_pages['artifacts_server_url'] = nil # Defaults to external_url + '/api/v4'
+# gitlab_pages['artifacts_server_timeout'] = 10
+
+##! Prometheus metrics for Pages docs: https://gitlab.com/gitlab-org/gitlab-pages/#enable-prometheus-metrics
+# gitlab_pages['metrics_address'] = ":9235"
+
+################################################################################
+## GitLab Pages NGINX
+################################################################################
+
+# All the settings defined in the "GitLab Nginx" section are also available in this "GitLab Pages NGINX" section
+# You just have to change the key "nginx['some_settings']" with "pages_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "GitLab Pages NGINX"
+# pages_nginx['enable'] = false
+
+# gitlab_rails['pages_path'] = "/mnt/storage/pages"
+
+################################################################################
+## GitLab CI
+##! Docs: https://docs.gitlab.com/ce/ci/quick_start/README.html
+################################################################################
+
+# gitlab_ci['gitlab_ci_all_broken_builds'] = true
+# gitlab_ci['gitlab_ci_add_pusher'] = true
+# gitlab_ci['builds_directory'] = '/var/opt/gitlab/gitlab-ci/builds'
+
+################################################################################
+## GitLab Mattermost
+##! Docs: https://docs.gitlab.com/omnibus/gitlab-mattermost
+################################################################################
+
+# mattermost_external_url 'http://mattermost.example.com'
+
+# mattermost['enable'] = false
+# mattermost['username'] = 'mattermost'
+# mattermost['group'] = 'mattermost'
+# mattermost['uid'] = nil
+# mattermost['gid'] = nil
+# mattermost['home'] = '/var/opt/gitlab/mattermost'
+# mattermost['database_name'] = 'mattermost_production'
+# mattermost['env'] = {}
+
+# mattermost['service_use_ssl'] = false
+# mattermost['service_address'] = "127.0.0.1"
+# mattermost['service_port'] = "8065"
+# mattermost['service_site_url'] = nil
+# mattermost['service_maximum_login_attempts'] = 10
+# mattermost['service_google_developer_key'] = nil
+# mattermost['service_enable_incoming_webhooks'] = true
+# mattermost['service_enable_post_username_override'] = true
+# mattermost['service_enable_post_icon_override'] = true
+# mattermost['service_enable_testing'] = false
+# mattermost['service_enable_security_fix_alert'] = true
+# mattermost['service_enable_insecure_outgoing_connections'] = false
+# mattermost['service_allowed_untrusted_internal_connections'] = ""
+# mattermost['service_allow_cors_from'] = ""
+# mattermost['service_enable_outgoing_webhooks'] = true
+# mattermost['service_enable_commands'] = true
+# mattermost['service_enable_custom_emoji'] = false
+# mattermost['service_enable_only_admin_integrations'] = true
+# mattermost['service_enable_oauth_service_provider'] = false
+# mattermost['service_enable_developer'] = false
+# mattermost['service_session_length_web_in_days'] = 30
+# mattermost['service_session_length_mobile_in_days'] = 30
+# mattermost['service_session_length_sso_in_days'] = 30
+# mattermost['service_session_cache_in_minutes'] = 10
+# mattermost['service_connection_security'] = nil
+# mattermost['service_tls_cert_file'] = nil
+# mattermost['service_tls_key_file'] = nil
+# mattermost['service_use_lets_encrypt'] = false
+# mattermost['service_lets_encrypt_cert_cache_file'] = "./config/letsencrypt.cache"
+# mattermost['service_forward_80_to_443'] = false
+# mattermost['service_read_timeout'] = 300
+# mattermost['service_write_timeout'] = 300
+# mattermost['service_time_between_user_typing_updates_milliseconds'] = 5000
+# mattermost['service_enable_link_previews'] = false
+# mattermost['service_enable_user_typing_messages'] = true
+# mattermost['service_enable_post_search'] = true
+# mattermost['service_enable_user_statuses'] = true
+# mattermost['service_enable_emoji_picker'] = true
+# mattermost['service_enable_channel_viewed_messages'] = true
+# mattermost['service_enable_apiv3'] = true
+# mattermost['service_goroutine_health_threshold'] = -1
+# mattermost['service_user_access_tokens'] = false
+
+# mattermost['team_site_name'] = "GitLab Mattermost"
+# mattermost['team_max_users_per_team'] = 150
+# mattermost['team_enable_team_creation'] = true
+# mattermost['team_enable_user_creation'] = true
+# mattermost['team_enable_open_server'] = false
+# mattermost['team_allow_public_link'] = true
+# mattermost['team_allow_valet_default'] = false
+# mattermost['team_restrict_creation_to_domains'] = "gmail.com"
+# mattermost['team_restrict_team_names'] = true
+# mattermost['team_restrict_direct_message'] = "any"
+# mattermost['team_max_channels_per_team'] = 2000
+# mattermost['team_enable_x_to_leave_channels_from_lhs'] = false
+# mattermost['team_user_status_away_timeout'] = 300
+# mattermost['team_teammate_name_display'] = "full_name"
+
+# mattermost['sql_driver_name'] = 'mysql'
+# mattermost['sql_data_source'] = "mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"
+# mattermost['sql_data_source_replicas'] = ["mmuser:mostest@tcp(dockerhost:3306)/mattermost_test?charset=utf8mb4,utf8"]
+# mattermost['sql_max_idle_conns'] = 10
+# mattermost['sql_max_open_conns'] = 10
+# mattermost['sql_trace'] = false
+# mattermost['sql_data_source_search_replicas'] = []
+# mattermost['sql_query_timeout'] = 30
+
+
+# mattermost['log_file_directory'] = '/var/log/gitlab/mattermost/'
+# mattermost['log_console_enable'] = true
+# mattermost['log_console_level'] = 'INFO'
+# mattermost['log_enable_file'] = false
+# mattermost['log_file_level'] = 'INFO'
+# mattermost['log_file_format'] = nil
+# mattermost['log_enable_diagnostics'] = true
+
+# mattermost['gitlab_enable'] = false
+# mattermost['gitlab_id'] = "12345656"
+# mattermost['gitlab_secret'] = "123456789"
+# mattermost['gitlab_scope'] = ""
+# mattermost['gitlab_auth_endpoint'] = "http://gitlab.example.com/oauth/authorize"
+# mattermost['gitlab_token_endpoint'] = "http://gitlab.example.com/oauth/token"
+# mattermost['gitlab_user_api_endpoint'] = "http://gitlab.example.com/api/v4/user"
+
+# mattermost['aws'] = {'S3AccessKeyId' => '123', 'S3SecretAccessKey' => '123', 'S3Bucket' => 'aa', 'S3Region' => 'bb'}
+
+# mattermost['email_enable_sign_up_with_email'] = true
+# mattermost['email_enable_sign_in_with_email'] = true
+# mattermost['email_enable_sign_in_with_username'] = false
+# mattermost['email_send_email_notifications'] = false
+# mattermost['email_require_email_verification'] = false
+# mattermost['email_smtp_username'] = nil
+# mattermost['email_smtp_password'] = nil
+# mattermost['email_smtp_server'] = nil
+# mattermost['email_smtp_port'] = nil
+# mattermost['email_connection_security'] = nil
+# mattermost['email_feedback_name'] = nil
+# mattermost['email_feedback_email'] = nil
+# mattermost['email_feedback_organization'] = nil
+# mattermost['email_send_push_notifications'] = true
+# mattermost['email_push_notification_server'] = ""
+# mattermost['email_push_notification_contents'] = "generic"
+# mattermost['email_enable_batching'] = false
+# mattermost['email_batching_buffer_size'] = 256
+# mattermost['email_batching_interval'] = 30
+# mattermost['email_skip_server_certificate_verification'] = false
+# mattermost['email_smtp_auth'] = false
+# mattermost['email_notification_content_type'] = "full"
+
+# mattermost['file_max_file_size'] = 52428800
+# mattermost['file_driver_name'] = "local"
+# mattermost['file_directory'] = "/var/opt/gitlab/mattermost/data"
+# mattermost['file_enable_public_link'] = true
+# mattermost['file_initial_font'] = 'luximbi.ttf'
+# mattermost['file_amazon_s3_access_key_id'] = nil
+# mattermost['file_amazon_s3_bucket'] = nil
+# mattermost['file_amazon_s3_secret_access_key'] = nil
+# mattermost['file_amazon_s3_region'] = nil
+# mattermost["file_amazon_s3_endpoint"] = nil
+# mattermost["file_amazon_s3_bucket_endpoint"] = nil
+# mattermost["file_amazon_s3_location_constraint"] = false
+# mattermost["file_amazon_s3_lowercase_bucket"] = false
+# mattermost["file_amazon_s3_ssl"] = true
+# mattermost["file_amazon_s3_sign_v2"] = false
+# mattermost['file_enable_file_attachments'] = true
+# mattermost["file_amazon_s3_trace"] = false
+
+# mattermost['ratelimit_enable_rate_limiter'] = false
+# mattermost['ratelimit_per_sec'] = 10
+# mattermost['ratelimit_memory_store_size'] = 10000
+# mattermost['ratelimit_vary_by_remote_addr'] = true
+# mattermost['ratelimit_vary_by_header'] = nil
+# mattermost['ratelimit_max_burst'] = 100
+
+# mattermost['support_terms_of_service_link'] = "/static/help/terms.html"
+# mattermost['support_privacy_policy_link'] = "/static/help/privacy.html"
+# mattermost['support_about_link'] = "/static/help/about.html"
+# mattermost['support_report_a_problem_link'] =  "/static/help/report_problem.html"
+# mattermost['support_email'] =  "support@example.com"
+
+# mattermost['privacy_show_email_address'] = true
+# mattermost['privacy_show_full_name'] = true
+
+# mattermost['localization_server_locale'] = "en"
+# mattermost['localization_client_locale'] = "en"
+# mattermost['localization_available_locales'] = "en,es,fr,ja,pt-BR"
+
+# mattermost['webrtc_enable'] = false
+# mattermost['webrtc_gateway_websocket_url'] = nil
+# mattermost['webrtc_gateway_admin_url'] = nil
+# mattermost['webrtc_gateway_admin_secret'] = nil
+# mattermost['webrtc_gateway_stun_uri'] = nil
+# mattermost['webrtc_gateway_turn_uri'] = nil
+# mattermost['webrtc_gateway_turn_username'] = nil
+# mattermost['webrtc_gateway_turn_shared_key'] = nil
+
+################################################################################
+## Mattermost NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Mattermost NGINX" section
+# You just have to change the key "nginx['some_settings']" with "mattermost_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Mattermost NGINX"
+# mattermost_nginx['enable'] = false
+
+# mattermost_nginx['custom_gitlab_mattermost_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
+# mattermost_nginx['proxy_set_headers'] = {
+#   "Host" => "$http_host",
+#   "X-Real-IP" => "$remote_addr",
+#   "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#   "X-Frame-Options" => "SAMEORIGIN",
+#   "X-Forwarded-Proto" => "https",
+#   "X-Forwarded-Ssl" => "on",
+#   "Upgrade" => "$http_upgrade",
+#   "Connection" => "$connection_upgrade"
+# }
+
+
+################################################################################
+## Registry NGINX
+################################################################################
+
+# All the settings defined in the "GitLab NGINX" section are also available in this "Registry NGINX" section
+# You just have to change the key "nginx['some_settings']" with "registry_nginx['some_settings']"
+
+# Below you can find settings that are exclusive to "Registry NGINX"
+# registry_nginx['enable'] = false
+
+# registry_nginx['proxy_set_headers'] = {
+#  "Host" => "$http_host",
+#  "X-Real-IP" => "$remote_addr",
+#  "X-Forwarded-For" => "$proxy_add_x_forwarded_for",
+#  "X-Forwarded-Proto" => "https",
+#  "X-Forwarded-Ssl" => "on"
+# }
+
+################################################################################
+## Prometheus
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/
+################################################################################
+
+# prometheus['enable'] = true
+# prometheus['monitor_kubernetes'] = true
+# prometheus['username'] = 'gitlab-prometheus'
+# prometheus['uid'] = nil
+# prometheus['gid'] = nil
+# prometheus['shell'] = '/bin/sh'
+# prometheus['home'] = '/var/opt/gitlab/prometheus'
+# prometheus['log_directory'] = '/var/log/gitlab/prometheus'
+# prometheus['scrape_interval'] = 15
+# prometheus['scrape_timeout'] = 15
+# prometheus['chunk_encoding_version'] = 2
+#
+### Custom scrape configs
+#
+# Prometheus can scrape additional jobs via scrape_configs.  The default automatically
+# includes all of the exporters supported by the omnibus config.
+#
+# See: https://prometheus.io/docs/operating/configuration/#<scrape_config>
+#
+# Example:
+#
+# prometheus['scrape_configs'] = [
+#   {
+#     'job_name': 'example',
+#     'static_configs' => [
+#       'targets' => ['hostname:port'],
+#     ],
+#   },
+# ]
+#
+### Prometheus Memory Management
+#
+# Prometheus needs to be configured for how much memory is used.
+# * This sets the target heap size.
+# * This value accounts for approximately 2/3 of the memory used by the server.
+# * The recommended memory is 4kb per unique metrics time-series.
+# See: https://prometheus.io/docs/operating/storage/#memory-usage
+#
+# prometheus['target_heap_size'] = (
+#   # Use 25mb + 2% of total memory for Prometheus memory.
+#   26_214_400 + (node['memory']['total'].to_i * 1024 * 0.02 )
+# ).to_i
+#
+# prometheus['flags'] = {
+#   'storage.local.path' => "#{node['gitlab']['prometheus']['home']}/data",
+#   'storage.local.chunk-encoding-version' => user_config['chunk-encoding-version'],
+#   'storage.local.target-heap-size' => node['gitlab']['prometheus']['target-heap-size'],
+#   'config.file' => "#{node['gitlab']['prometheus']['home']}/prometheus.yml"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# prometheus['listen_address'] = 'localhost:9090'
+
+################################################################################
+## Prometheus Node Exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/node_exporter.html
+################################################################################
+
+# node_exporter['enable'] = true
+# node_exporter['home'] = '/var/opt/gitlab/node-exporter'
+# node_exporter['log_directory'] = '/var/log/gitlab/node-exporter'
+# node_exporter['flags'] = {
+#   'collector.textfile.directory' => "#{node['gitlab']['node-exporter']['home']}/textfile_collector"
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# node_exporter['listen_address'] = 'localhost:9100'
+
+################################################################################
+## Prometheus Redis exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/redis_exporter.html
+################################################################################
+
+# redis_exporter['enable'] = true
+# redis_exporter['log_directory'] = '/var/log/gitlab/redis-exporter'
+# redis_exporter['flags'] = {
+#   'redis.addr' => "unix://#{node['gitlab']['gitlab-rails']['redis_socket']}",
+# }
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# redis_exporter['listen_address'] = 'localhost:9121'
+
+################################################################################
+## Prometheus Postgres exporter
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/postgres_exporter.html
+################################################################################
+
+# postgres_exporter['enable'] = true
+# postgres_exporter['home'] = '/var/opt/gitlab/postgres-exporter'
+# postgres_exporter['log_directory'] = '/var/log/gitlab/postgres-exporter'
+# postgres_exporter['flags'] = {}
+# postgres_exporter['listen_address'] = 'localhost:9187'
+
+################################################################################
+## Prometheus Gitlab monitor
+##! Docs: https://docs.gitlab.com/ce/administration/monitoring/prometheus/gitlab_monitor_exporter.html
+################################################################################
+
+
+# gitlab_monitor['enable'] = true
+# gitlab_monitor['log_directory'] = "/var/log/gitlab/gitlab-monitor"
+# gitlab_monitor['home'] = "/var/opt/gitlab/gitlab-monitor"
+
+##! Advanced settings. Should be changed only if absolutely needed.
+# gitlab_monitor['listen_address'] = 'localhost'
+# gitlab_monitor['listen_port'] = '9168'
+
+# To completely disable prometheus, and all of it's exporters, set to false
+# prometheus_monitoring['enable'] = true
+
+################################################################################
+## Gitaly
+##! Docs:
+################################################################################
+
+
+# gitaly['enable'] = false
+# gitaly['dir'] = "/var/opt/gitlab/gitaly"
+# gitaly['log_directory'] = "/var/log/gitlab/gitaly"
+# gitaly['bin_path'] = "/opt/gitlab/embedded/bin/gitaly"
+# gitaly['env_directory'] = "/opt/gitlab/etc/gitaly"
+# gitaly['env'] = {
+#  'PATH' => "/opt/gitlab/bin:/opt/gitlab/embedded/bin:/bin:/usr/bin",
+#  'HOME' => '/var/opt/gitlab'
+# }
+# gitaly['socket_path'] = "/var/opt/gitlab/gitaly/gitaly.socket"
+# gitaly['listen_addr'] = "localhost:8075"
+# gitaly['prometheus_listen_addr'] = "localhost:9175"
+# gitaly['logging_format'] = "json"
+# gitaly['logging_sentry_dsn'] = "https://<key>:<secret>@sentry.io/<project>"
+# gitaly['prometheus_grpc_latency_buckets'] = "[0.001, 0.005, 0.025, 0.1, 0.5, 1.0, 10.0, 30.0, 60.0, 300.0, 1500.0]"
+# gitaly['auth_token'] = '<secret>'
+# gitaly['auth_transitioning'] = false # When true, auth is logged to Prometheus but NOT enforced
+# gitaly['storage'] = [
+#   {
+#     'name' => 'default',
+#     'path' => '/tmp/path-1'
+#   },
+#   {
+#     'name' => 'nfs1',
+#     'path' => '/mnt/nfs1'
+#   }
+# ]
+# gitaly['concurrency'] = [
+#   {
+#     'rpc' => "/gitaly.SmartHTTPService/PostReceivePack",
+#     'max_per_repo' => 20
+#   }, {
+#     'rpc' => "/gitaly.SSHService/SSHUploadPack",
+#     'max_per_repo' => 5
+#   }
+# ]
+
+################################################################################
+################################################################################
+##                  Configuration Settings for GitLab EE only                 ##
+################################################################################
+################################################################################
+
+
+################################################################################
+## Auxiliary cron jobs applicable to GitLab EE only
+################################################################################
+#
+# gitlab_rails['geo_file_download_dispatch_worker_cron'] = "*/10 * * * *"
+# gitlab_rails['geo_repository_sync_worker_cron'] = "*/5 * * * *"
+# gitlab_rails['ldap_sync_worker_cron'] = "30 1 * * *"
+# gitlab_rails['ldap_group_sync_worker_cron'] = "0 * * * *"
+# gitlab_rails['historical_data_worker_cron'] = "0 12 * * *"
+
+################################################################################
+## Kerberos (EE Only)
+##! Docs: https://docs.gitlab.com/ee/integration/kerberos.html#http-git-access
+################################################################################
+
+# gitlab_rails['kerberos_enabled'] = true
+# gitlab_rails['kerberos_keytab'] = /etc/http.keytab
+# gitlab_rails['kerberos_service_principal_name'] = HTTP/gitlab.example.com@EXAMPLE.COM
+# gitlab_rails['kerberos_use_dedicated_port'] = true
+# gitlab_rails['kerberos_port'] = 8443
+# gitlab_rails['kerberos_https'] = true
+
+################################################################################
+## GitLab Sentinel (EE Only)
+##! Docs: http://docs.gitlab.com/ce/administration/high_availability/redis.html#high-availability-with-sentinel
+################################################################################
+
+##! **Make sure you configured all redis['master_*'] keys above before
+##!   continuing.**
+
+##! To enable Sentinel and disable all other services in this machine,
+##! uncomment the line below (if you've enabled Redis role, it will keep it).
+##! Docs: https://docs.gitlab.com/ce/administration/high_availability/redis.html
+# redis_sentinel_role['enable'] = true
+
+# sentinel['enable'] = true
+
+##! Bind to all interfaces, uncomment to specify an IP and bind to a single one
+# sentinel['bind'] = '0.0.0.0'
+
+##! Uncomment to change default port
+# sentinel['port'] = 26379
+
+##! Quorum must reflect the amount of voting sentinels it take to start a
+##! failover.
+##! **Value must NOT be greater then the amount of sentinels.**
+##! The quorum can be used to tune Sentinel in two ways:
+##! 1. If a the quorum is set to a value smaller than the majority of Sentinels
+##!    we deploy, we are basically making Sentinel more sensible to master
+##!    failures, triggering a failover as soon as even just a minority of
+##!    Sentinels is no longer able to talk with the master.
+##! 2. If a quorum is set to a value greater than the majority of Sentinels, we
+##!    are making Sentinel able to failover only when there are a very large
+##!    number (larger than majority) of well connected Sentinels which agree
+##!    about the master being down.
+# sentinel['quorum'] = 1
+
+### Consider unresponsive server down after x amount of ms.
+# sentinel['down_after_milliseconds'] = 10000
+
+### Specifies the failover timeout in milliseconds.
+##! It is used in many ways:
+##!
+##! - The time needed to re-start a failover after a previous failover was
+##!   already tried against the same master by a given Sentinel, is two
+##!   times the failover timeout.
+##!
+##! - The time needed for a slave replicating to a wrong master according
+##!   to a Sentinel current configuration, to be forced to replicate
+##!   with the right master, is exactly the failover timeout (counting since
+##!   the moment a Sentinel detected the misconfiguration).
+##!
+##! - The time needed to cancel a failover that is already in progress but
+##!   did not produced any configuration change (SLAVEOF NO ONE yet not
+##!   acknowledged by the promoted slave).
+##!
+##! - The maximum time a failover in progress waits for all the slaves to be
+##!   reconfigured as slaves of the new master. However even after this time
+##!   the slaves will be reconfigured by the Sentinels anyway, but not with
+##!   the exact parallel-syncs progression as specified.
+# sentinel['failover_timeout'] = 60000
+
+################################################################################
+## GitLab Sidekiq Cluster (EE only)
+################################################################################
+
+##! GitLab Enterprise Edition allows one to start an extra set of Sidekiq processes
+##! besides the default one. These processes can be used to consume a dedicated set
+##! of queues. This can be used to ensure certain queues always have dedicated
+##! workers, no matter the amount of jobs that need to be processed.
+
+# sidekiq_cluster['enable'] = false
+# sidekiq_cluster['ha'] = false
+# sidekiq_cluster['log_directory'] = "/var/log/gitlab/sidekiq-cluster"
+# sidekiq_cluster['interval'] = 5 # The number of seconds to wait between worker checks
+
+##! Each entry in the queue_groups array denotes a group of queues that have to be processed by a
+##! Sidekiq process. Multiple queues can be processed by the same process by
+##! separating them with a comma within the group entry
+
+# sidekiq_cluster['queue_groups'] = [
+#   "process_commit,post_receive",
+#   "gitlab_shell"
+# ]
+#
+
+##! If negate is enabled then sidekiq-cluster will process all the queues that
+##! don't match those in queue_groups.
+
+# sidekiq_cluster['negate'] = false
+
+################################################################################
+## Additional Database Settings (EE only)
+##! Docs: https://docs.gitlab.com/ee/administration/database_load_balancing.html
+################################################################################
+# gitlab_rails['db_load_balancing'] = { 'hosts' => ['secondary1.example.com'] }
+
+################################################################################
+## GitLab Geo
+##! Docs: https://docs.gitlab.com/ee/gitlab-geo
+################################################################################
+# geo_primary_role['enable'] = false
+# geo_secondary_role['enable'] = false
+
+################################################################################
+## GitLab Geo Secondary (EE only)
+################################################################################
+# geo_secondary['auto_migrate'] = true
+# geo_secondary['db_adapter'] = "postgresql"
+# geo_secondary['db_encoding'] = "unicode"
+# geo_secondary['db_collation'] = nil
+# geo_secondary['db_database'] = "gitlabhq_geo_production"
+# geo_secondary['db_pool'] = 10
+# geo_secondary['db_username'] = "gitlab_geo"
+# geo_secondary['db_password'] = nil
+# geo_secondary['db_host'] = "/var/opt/gitlab/geo-postgresql"
+# geo_secondary['db_port'] = 5431
+# geo_secondary['db_socket'] = nil
+# geo_secondary['db_sslmode'] = nil
+# geo_secondary['db_sslrootcert'] = nil
+# geo_secondary['db_sslca'] = nil
+
+################################################################################
+## GitLab Geo Secondary Tracking Database (EE only)
+################################################################################
+
+# geo_postgresql['enable'] = false
+# geo_postgresql['ha'] = false
+# geo_postgresql['dir'] = '/var/opt/gitlab/geo-postgresql'
+# geo_postgresql['data_dir'] = '/var/opt/gitlab/geo-postgresql/data'
+
+################################################################################
+# Pgbouncer (EE only)
+# See [GitLab PgBouncer documentation](http://docs.gitlab.com/omnibus/settings/database.html#enabling-pgbouncer-ee-only)
+# See the [PgBouncer page](https://pgbouncer.github.io/config.html) for details
+################################################################################
+# pgbouncer['enable'] = false
+# pgbouncer['log_directory'] = '/var/log/gitlab/pgbouncer'
+# pgbouncer['data_directory'] = '/var/opt/gitlab/pgbouncer'
+# pgbouncer['listen_addr'] = '0.0.0.0'
+# pgbouncer['listen_port'] = '6432'
+# pgbouncer['pool_mode'] = 'session'
+# pgbouncer['server_reset_query'] = 'DISCARD ALL'
+# pgbouncer['max_client_conn'] = '100'
+# pgbouncer['default_pool_size'] = '20'
+# pgbouncer['min_pool_size'] = '0'
+# pgbouncer['reserve_pool_size'] = '0'
+# pgbouncer['reserve_pool_timeout'] = '5.0'
+# pgbouncer['server_round_robin'] = '0'
+# pgbouncer['log_connections'] = '0'
+# pgbouncer['server_idle_timeout'] = '600.0'
+# pgbouncer['dns_max_ttl'] = '15.0'
+# pgbouncer['dns_zone_check_period'] = '0'
+# pgbouncer['dns_nxdomain_ttl'] = '15.0'
+# pgbouncer['admin_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['stats_users'] = %w(gitlab-psql postgres pgbouncer)
+# pgbouncer['ignore_startup_parameters'] = 'extra_float_digits'
+# pgbouncer['databases'] = {
+#   DATABASE_NAME: {
+#     host: HOSTNAME,
+#     port: PORT
+#     user: USERNAME,
+#     password: PASSWORD
+###! generate this with `echo -n '$password + $username' | md5sum`
+#   }
+#   ...
+# }
+# pgbouncer['logfile'] = nil
+# pgbouncer['auth_type'] = 'md5'
+# pgbouncer['auth_hba_file'] = nil
+# pgbouncer['auth_query'] = 'SELECT username, password FROM public.pg_shadow_lookup($1)'
+# pgbouncer['users'] = [
+#   {
+#     name: USERNAME,
+#     password: MD5_PASSWORD_HASH
+#   }
+# ]
+# postgresql['pgbouncer_user'] = nil
+# postgresql['pgbouncer_user_password'] = nil
+#
+
+################################################################################
+# Repmgr (EE only)
+################################################################################
+# repmgr['enable'] = false
+# repmgr['cluster'] = 'gitlab_cluster'
+# repmgr['database'] = 'gitlab_repmgr'
+# repmgr['host'] = nil
+# repmgr['node_number'] = nil
+# repmgr['port'] = 5432
+# repmgr['trust_auth_cidr_addresses'] = []
+# repmgr['user'] = 'gitlab_repmgr'
+# repmgr['failover'] = 'automatic'
+# repmgr['log_directory'] = '/var/log/gitlab/repmgrd'
+# repmgr['node_name'] = nil
+# repmgr['pg_bindir'] = '/opt/gitlab/embedded/bin'
+# repmgr['service_start_command'] = '/opt/gitlab/bin/gitlab-ctl start postgresql'
+# repmgr['service_stop_command'] = '/opt/gitlab/bin/gitlab-ctl stop postgresql'
+# repmgr['service_reload_command'] = '/opt/gitlab/bin/gitlab-ctl hup postgresql'
+# repmgr['service_restart_command'] = '/opt/gitlab/bin/gitlab-ctl restart postgresql'
+# repmgr['service_promote_command'] = nil
+# repmgr['promote_command'] = '/opt/gitlab/embedded/bin/repmgr standby promote -f /var/opt/gitlab/postgresql/repmgr.conf'
+# repmgr['follow_command'] = '/opt/gitlab/embedded/bin/repmgr standby follow -f /var/opt/gitlab/postgresql/repmgr.conf'
+
+# repmgr['upstream_node'] = nil
+# repmgr['use_replication_slots'] = false
+# repmgr['loglevel'] = 'INFO'
+# repmgr['logfacility'] = 'STDERR'
+# repmgr['logfile'] = nil
+
+# repmgr['event_notification_command'] = nil
+# repmgr['event_notifications'] = nil
+
+# repmgr['rsync_options'] = nil
+# repmgr['ssh_options'] = nil
+# repmgr['priority'] = nil
+
+# repmgr['retry_promote_interval_secs'] = 300
+# repmgr['witness_repl_nodes_sync_interval_secs'] = 15
+# repmgr['reconnect_attempts'] = 6
+# repmgr['reconnect_interval'] = 10
+# repmgr['monitor_interval_secs'] = 2
+# repmgr['master_response_timeout'] = 60
+# repmgr['daemon'] = true
+# repmgrd['enable'] = true
+
+################################################################################
+# Consul (EEP only)
+################################################################################
+# consul['enable'] = false
+# consul['dir'] = '/var/opt/gitlab/consul'
+# consul['user'] = 'gitlab-consul'
+# consul['config_file'] = '/var/opt/gitlab/consul/config.json'
+# consul['config_dir'] = '/var/opt/gitlab/consul/config.d'
+# consul['data_dir'] = '/var/opt/gitlab/consul/data'
+# consul['log_directory'] = '/var/log/gitlab/consul'
+# consul['script_directory'] = '/var/opt/gitlab/consul/scripts'
+# consul['configuration'] = {
+#   'client_addr' => nil,
+#   'datacenter' => 'gitlab_consul',
+#   'enable_script_checks' => true,
+#   'server' => false
+# }
+# consul['services'] = []
+# consul['service_config'] = {
+#   'postgresql' => {
+#     'service' => {
+#       'name' => "postgresql",
+#       'address' => '',
+#       'port' => 5432,
+#       'checks' => [
+#         {
+#           'script' => "/var/opt/gitlab/consul/scripts/check_postgresql",
+#           'interval' => "10s"
+#         }
+#       ]
+#     }
+#   }
+# }
+# consul['watchers'] = {
+#   'postgresql' => {
+#     enable: false,
+#     handler: 'failover_pgbouncer'
+#   }
+# }
diff --git a/roles/gitlab-sameersbn-8/LICENSE b/roles/gitlab-sameersbn-8/LICENSE
new file mode 100644
index 00000000..8cdb8451
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/LICENSE
@@ -0,0 +1,340 @@
+                    GNU GENERAL PUBLIC LICENSE
+                       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc., <http://fsf.org/>
+ 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+                            Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Lesser General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+                    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
+
+In addition, mere aggregation of another work not based on the Program
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
+
+The source code for a work means the preferred form of the work for
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
+refrain entirely from distribution of the Program.
+
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and "any
+later version", you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+                            NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+                     END OF TERMS AND CONDITIONS
+
+            How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    {description}
+    Copyright (C) {year}  {fullname}
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License along
+    with this program; if not, write to the Free Software Foundation, Inc.,
+    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) year name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  {signature of Ty Coon}, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Lesser General
+Public License instead of this License.
+
diff --git a/roles/gitlab-sameersbn-8/README.md b/roles/gitlab-sameersbn-8/README.md
new file mode 100644
index 00000000..a5da79c9
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/README.md
@@ -0,0 +1,2 @@
+# ansible-docker-gitlab
+Ansible role that builds the gitlab docker containers  on hosts
diff --git a/roles/gitlab-sameersbn-8/defaults/main.yml b/roles/gitlab-sameersbn-8/defaults/main.yml
new file mode 100644
index 00000000..9dd5ea94
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/defaults/main.yml
@@ -0,0 +1,46 @@
+---
+
+gitlab_version: 8.8.0
+
+# The hostname passed as an envirnment variable into the container
+gitlab_ip_addr: '127.0.0.1'
+gitlab_hostname: git.example.com
+gitlab_port_args: 
+    - 80
+    - 443
+    - 22
+
+# database usernames and passwords
+gitlab_db_user: novatech
+
+# must pass in the following variables
+# gitlab_db_password: ''
+
+# the name of the image being duilt and used for the container
+gitlab_image_repo: 'https://github.com/novatechweb/docker-gitlab.git'
+gitlab_image_name: 'sameersbn/gitlab:8.0.0'
+gitlab_dv_image_name: '{{ docker_registry_username }}/gitlab'
+gitlab_db_image_name: 'postgres:9.4'
+redis_image_name: 'redis:3.0'
+
+# the name of the gitlab container
+gitlab_container_name: '{{ docker_name_prefix }}gitlab'
+
+# the name of the redis container for gitlab
+gitlab_redis_container_name: '{{ docker_name_prefix }}gitlab_redis'
+
+# the name of the postgres container for gitlab
+gitlab_db_container_name: '{{ docker_name_prefix }}gitlab_db'
+
+# the name of the data-volume used by the container
+gitlab_dv_name: '{{ docker_name_prefix }}gitlab_DV'
+
+# the name of the data-volume used by the postgres container
+gitlab_db_dv_name: '{{ docker_name_prefix }}gitlab_db_DV'
+
+# restore directories to temporarly store data being restored into docker containers
+gitlab_docker_backup_dir: '{{ docker_backup_dir }}/GIT'
+gitlab_docker_restore_dir: '{{ bacula_dest }}{{ gitlab_docker_backup_dir }}'
+
+# Network names
+docker_network_frontend: 'frontend'
diff --git a/roles/gitlab-sameersbn-8/docker-compose.yml b/roles/gitlab-sameersbn-8/docker-compose.yml
new file mode 100644
index 00000000..6448705e
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/docker-compose.yml
@@ -0,0 +1,66 @@
+version: "3"
+services:
+
+  gitlab-redis:
+    image: 'redis:3.0'
+    networks:
+      - backend
+    volumes:
+      - gitlab-redis-data:/data
+
+  gitlab-db:
+    image: 'postgres:9.4'
+    environment:
+      POSTGRES_DB: gitlabhq_production
+      POSTGRES_USER: novatech
+      POSTGRES_PASSWORD: 'e-Ld925DUOF-1zo7YJCV'
+
+    networks:
+      - backend
+    volumes:
+      - gitlab-postgres-data:/var/lib/postgresql/data
+
+  gitlab:
+    image: 'sameersbn/gitlab:7.14.3'
+    networks:
+      - frontend
+      - backend
+    ports:
+      - '8022:22'
+      - '8080:80'
+      - '8443:443'
+    depends_on:
+      - gitlab-redis
+      - gitlab-db
+    environment:
+      DEBUG_ENTRYPOINT: 1
+      GITLAB_HOST: localhost 
+      GITLAB_SSH_HOST: localhost
+      DB_USER: novatech
+      DB_PASS: 'e-Ld925DUOF-1zo7YJCV'
+      SMTP_HOST: mail.novatech-llc.com
+      SMTP_PASS: '1-:cmnWFnfkbnemDG:2O' 
+      LDAP_PASS: '4H:LK7g5oYkDT1nEhwR0' 
+      GITLAB_ROOT_PASSWORD: 'nXdKrkalaZaxpk4ipYRk' 
+      GITLAB_SECRETS_DB_KEY_BASE: '5GSj_DbI-mH2Z5VF4QM:guDgOl_ihoCoexPA8Lbp'
+    env_file: gitlab.env.list
+    volumes:
+      - gitlab-ssl:/home/git/data/certs
+      - gitlab-ce-backups:/mnt/backups
+      - gitlab-data:/home/git/data
+
+networks:
+  frontend:
+  backend:
+
+volumes:
+  gitlab-ce-backups:
+    external: true
+  gitlab-postgres-data:
+    external: true
+  gitlab-redis-data:
+    external: true
+  gitlab-data:
+    external: true
+  gitlab-ssl:
+    external: true
diff --git a/roles/gitlab-sameersbn-8/files/gitlab.env.list b/roles/gitlab-sameersbn-8/files/gitlab.env.list
new file mode 100644
index 00000000..0c77c578
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/files/gitlab.env.list
@@ -0,0 +1,199 @@
+# quay.io/sameersbn/gitlab:8.1.0-2
+
+
+# DEBUG_ENTRYPOINT                          : Set this to true to enable entrypoint debugging.
+# GITLAB_HOST                               : The hostname of the GitLab server. Defaults to localhost
+#	### Set as --env GITLAB_HOST={{ container_addr_map.git.hostname }} ###
+# GITLAB_CI_HOST                            : If you are migrating from GitLab CI use this parameter to configure the redirection to the GitLab service so that your existing runners continue to work without any changes. No defaults.
+# GITLAB_PORT                               : The port of the GitLab server. This value indicates the public port on which the GitLab application will be accessible on the network and appropriately configures GitLab to generate the correct urls. It does not affect the port on which the internal nginx server will be listening on. Defaults to 443 if GITLAB_HTTPS=true, else defaults to 80.
+GITLAB_PORT=443
+# GITLAB_SECRETS_DB_KEY_BASE                : Used to encrypt build variables. Ensure that you don't lose it. You can generate one using pwgen -Bsv1 64. If you are migrating from GitLab CI, you need to set this value to the value of GITLAB_CI_SECRETS_DB_KEY_BASE. No defaults.
+# GITLAB_TIMEZONE                           : Configure the timezone for the gitlab application. This configuration does not effect cron jobs. Defaults to UTC. See the list of acceptable values.
+GITLAB_TIMEZONE=America\/Chicago
+# GITLAB_ROOT_PASSWORD                      : The password for the root user. Defaults to 5iveL!fe.
+# GITLAB_EMAIL                              : The email address for the GitLab server. Defaults to value of SMTP_USER, else defaults to example@example.com.
+GITLAB_EMAIL=gitlab@novatech-llc.com
+# GITLAB_EMAIL_DISPLAY_NAME                 : The name displayed in emails sent out by the GitLab mailer. Defaults to GitLab.
+GITLAB_EMAIL_DISPLAY_NAME=GitLab
+# GITLAB_EMAIL_REPLY_TO                     : The reply-to address of emails sent out by GitLab. Defaults to value of GITLAB_EMAIL, else defaults to noreply@example.com.
+GITLAB_EMAIL_REPLY_TO=noreply@novatech-llc.com
+# GITLAB_EMAIL_ENABLED                      : Enable or disable gitlab mailer. Defaults to the SMTP_ENABLED configuration.
+GITLAB_EMAIL_ENABLED=True
+# GITLAB_INCOMING_EMAIL_ADDRESS             : The incoming email address for reply by email. Defaults to the value of IMAP_USER, else defaults to reply@example.com.
+# GITLAB_INCOMING_EMAIL_ENABLED             : Enable or disable gitlab reply by email feature. Defaults to the value of IMAP_ENABLED.
+# GITLAB_USERNAME_CHANGE                    : Enable or disable ability for users to change their username. Defaults is true.
+GITLAB_USERNAME_CHANGE=true
+# GITLAB_CREATE_GROUP                       : Enable or disable ability for users to create groups. Defaults is true.
+GITLAB_CREATE_GROUP=true
+# GITLAB_PROJECTS_ISSUES                    : Set if issues feature should be enabled by default for new projects. Defaults is true.
+GITLAB_PROJECTS_ISSUES=true
+# GITLAB_PROJECTS_MERGE_REQUESTS            : Set if merge requests feature should be enabled by default for new projects. Defaults is true.
+GITLAB_PROJECTS_MERGE_REQUESTS=true
+# GITLAB_PROJECTS_WIKI                      : Set if wiki feature should be enabled by default for new projects. Defaults is true.
+GITLAB_PROJECTS_WIKI=false
+# GITLAB_PROJECTS_SNIPPETS                  : Set if snippets feature should be enabled by default for new projects. Defaults is false.
+GITLAB_PROJECTS_SNIPPETS=true
+# GITLAB_WEBHOOK_TIMEOUT                    : Sets the timeout for webhooks. Defaults to 10 seconds.
+# GITLAB_SATELLITES_TIMEOUT                 : Sets the timeout for satellites. Defaults to 30 seconds.
+# GITLAB_TIMEOUT                            : Sets the timeout for git commands. Defaults to 10 seconds.
+# GITLAB_NOTIFY_ON_BROKEN_BUILDS            : Enable or disable broken build notification emails. Defaults to true
+# GITLAB_NOTIFY_PUSHER                      : Add pusher to recipients list of broken build notification emails. Defaults to false
+# GITLAB_REPOS_DIR                          : The git repositories folder in the container. Defaults to /home/git/data/repositories
+# GITLAB_BACKUP_DIR                         : The backup folder in the container. Defaults to /home/git/data/backups
+GITLAB_BACKUP_DIR=/home/git/backups
+# GITLAB_BUILDS_DIR                         : The build traces directory. Defaults to /home/git/data/builds
+GITLAB_BUILDS_DIR=/home/git/builds
+# GITLAB_BACKUPS                            : Setup cron job to automatic backups. Possible values disable, daily, weekly or monthly. Disabled by default
+GITLAB_BACKUPS=disable
+# GITLAB_BACKUP_EXPIRY                      : Configure how long (in seconds) to keep backups before they are deleted. By default when automated backups are disabled backups are kept forever (0 seconds), else the backups expire in 7 days (604800 seconds).
+GITLAB_BACKUP_EXPIRY=3600
+# GITLAB_BACKUP_ARCHIVE_PERMISSIONS         : Sets the permissions of the backup archives. Defaults to 0600. See
+# GITLAB_BACKUP_TIME                        : Set a time for the automatic backups in HH:MM format. Defaults to 04:00.
+GITLAB_BACKUP_TIME=23:00
+# GITLAB_SSH_HOST                           : The ssh host. Defaults to GITLAB_HOST.
+#	### Set as --env GITLAB_SSH_HOST={{ container_addr_map.git.hostname }} ###
+# GITLAB_SSH_PORT                           : The ssh port number. Defaults to 22.
+GITLAB_SSH_PORT=22
+# GITLAB_RELATIVE_URL_ROOT                  : The relative url of the GitLab server, e.g. /git. No default.
+# GITLAB_HTTPS                              : Set to true to enable https support, disabled by default.
+GITLAB_HTTPS=true
+# GITLAB_HTTPS_HSTS_ENABLED                 : Advanced configuration option for turning off the HSTS configuration. Applicable only when SSL is in use. Defaults to true. See #138 for use case scenario.
+GITLAB_HTTPS_HSTS_ENABLED=true
+# GITLAB_HTTPS_HSTS_MAXAGE                  : Advanced configuration option for setting the HSTS max-age in the gitlab nginx vHost configuration. Applicable only when SSL is in use. Defaults to 31536000.
+GITLAB_HTTPS_HSTS_MAXAGE=31536000
+# SSL_SELF_SIGNED                           : Set to true when using self signed ssl certificates. false by default.
+SSL_SELF_SIGNED=false
+# SSL_CERTIFICATE_PATH                      : Location of the ssl certificate. Defaults to /home/git/data/certs/gitlab.crt
+SSL_CERTIFICATE_PATH=/home/git/data/certs/nginx.crt
+# SSL_KEY_PATH                              : Location of the ssl private key. Defaults to /home/git/data/certs/gitlab.key
+SSL_KEY_PATH=/home/git/data/certs/nginx.key
+# SSL_DHPARAM_PATH                          : Location of the dhparam file. Defaults to /home/git/data/certs/dhparam.pem
+SSL_DHPARAM_PATH=/home/git/data/certs/dhparam.pem
+# SSL_VERIFY_CLIENT                         : Enable verification of client certificates using the CA_CERTIFICATES_PATH file. Defaults to false
+SSL_VERIFY_CLIENT=off
+# CA_CERTIFICATES_PATH                      : List of SSL certificates to trust. Defaults to /home/git/data/certs/ca.crt.
+CA_CERTIFICATES_PATH=/etc/ssl/certs/ca-certificates.crt
+# NGINX_WORKERS                             : The number of nginx workers to start. Defaults to 1.
+# NGINX_PROXY_BUFFERING                     : Enable proxy_buffering. Defaults to off.
+# NGINX_ACCEL_BUFFERING                     : Enable X-Accel-Buffering header. Default to no
+# NGINX_MAX_UPLOAD_SIZE                     : Maximum acceptable upload size. Defaults to 20m.
+# NGINX_X_FORWARDED_PROTO                   : Advanced configuration option for the proxy_set_header X-Forwarded-Proto setting in the gitlab nginx vHost configuration. Defaults to https when GITLAB_HTTPS is true, else defaults to $scheme.
+# REDIS_HOST                                : The hostname of the redis server. Defaults to localhost
+REDIS_HOST=gitlab-redis
+# REDIS_PORT                                : The connection port of the redis server. Defaults to 6379.
+REDIS_PORT=6379
+# UNICORN_WORKERS                           : The number of unicorn workers to start. Defaults to 3.
+# UNICORN_TIMEOUT                           : Sets the timeout of unicorn worker processes. Defaults to 60 seconds.
+# SIDEKIQ_CONCURRENCY                       : The number of concurrent sidekiq jobs to run. Defaults to 25
+# SIDEKIQ_SHUTDOWN_TIMEOUT                  : Timeout for sidekiq shutdown. Defaults to 4
+# SIDEKIQ_MEMORY_KILLER_MAX_RSS             : Non-zero value enables the SidekiqMemoryKiller. Defaults to 1000000. For additional options refer Configuring the MemoryKiller
+# DB_TYPE                                   : The database type. Possible values: mysql, postgres. Defaults to postgres.
+DB_TYPE=postgres
+# DB_HOST                                   : The database server hostname. Defaults to localhost.
+DB_HOST=gitlab-db
+# DB_PORT                                   : The database server port. Defaults to 3306 for mysql and 5432 for postgresql.
+DB_PORT=5432
+# DB_NAME                                   : The database database name. Defaults to gitlabhq_production
+DB_NAME=gitlabhq_production
+# DB_USER                                   : The database database user. Defaults to root
+#	### Set as --env DB_USER={{ gitlab_db_user }} ###
+# DB_PASS                                   : The database database password. Defaults to no password
+#	### Set as --env DB_PASS={{ gitlab_db_password | quote }} ###
+# DB_POOL                                   : The database database connection pool count. Defaults to 10.
+# SMTP_ENABLED                              : Enable mail delivery via SMTP. Defaults to true if SMTP_USER is defined, else defaults to false.
+SMTP_ENABLED=true
+# SMTP_DOMAIN                               : SMTP domain. Defaults towww.gmail.com
+SMTP_DOMAIN=novatech-llc.com
+# SMTP_HOST                                 : SMTP server host. Defaults to smtp.gmail.com.
+#	### Set as --env SMTP_HOST={{ container_addr_map.exim4.hostname }} ###
+# SMTP_PORT                                 : SMTP server port. Defaults to 587.
+# SMTP_USER                                 : SMTP username.
+SMTP_USER=gitlab
+# SMTP_PASS                                 : SMTP password.
+#	### Set as --env SMTP_PASS={{ email_accounts.gitlab.password | quote }} ###
+# SMTP_STARTTLS                             : Enable STARTTLS. Defaults to true.
+SMTP_STARTTLS=true
+# SMTP_TLS                                  : Enable SSL/TLS. Defaults to false.
+SMTP_TLS=false
+# SMTP_OPENSSL_VERIFY_MODE                  : SMTP openssl verification mode. Accepted values are none, peer, client_once and fail_if_no_peer_cert. Defaults to none.
+SMTP_OPENSSL_VERIFY_MODE=none
+# SMTP_AUTHENTICATION                       : Specify the SMTP authentication method. Defaults to login if SMTP_USER is set.
+SMTP_AUTHENTICATION=plain
+# SMTP_CA_ENABLED                           : Enable custom CA certificates for SMTP email configuration. Defaults to false.
+# SMTP_CA_PATH                              : Specify the ca_path parameter for SMTP email configuration. Defaults to /home/git/data/certs.
+# SMTP_CA_FILE                              : Specify the ca_file parameter for SMTP email configuration. Defaults to /home/git/data/certs/ca.crt.
+# IMAP_ENABLED                              : Enable mail delivery via IMAP. Defaults to true if IMAP_USER is defined, else defaults to false.
+# IMAP_HOST                                 : IMAP server host. Defaults to imap.gmail.com.
+# IMAP_PORT                                 : IMAP server port. Defaults to 993.
+# IMAP_USER                                 : IMAP username.
+# IMAP_PASS                                 : IMAP password.
+# IMAP_SSL                                  : Enable SSL. Defaults to true.
+# IMAP_STARTTLS                             : Enable STARTSSL. Defaults to false.
+# IMAP_MAILBOX                              : The name of the mailbox where incoming mail will end up. Defaults to inbox.
+# LDAP_ENABLED                              : Enable LDAP. Defaults to false
+LDAP_ENABLED=true
+# LDAP_LABEL                                : Label to show on login tab for LDAP server. Defaults to 'LDAP'
+LDAP_LABEL=NovaTech
+# # LDAP_HOST                                 : LDAP Host
+LDAP_HOST=ldap.novatech-llc.com
+# LDAP_PORT                                 : LDAP Port. Defaults to 389
+LDAP_PORT=389
+# LDAP_UID                                  : LDAP UID. Defaults to sAMAccountName
+LDAP_UID=uid
+# LDAP_METHOD                               : LDAP method, Possible values are ssl, tls and plain. Defaults to plain
+LDAP_METHOD=plain
+# LDAP_BIND_DN                              : No default.
+LDAP_BIND_DN=cn=proxyagent,dc=novatech
+# LDAP_PASS                                 : LDAP password
+# LDAP_ACTIVE_DIRECTORY                     : Specifies if LDAP server is Active Directory LDAP server. If your LDAP server is not AD, set this to false. Defaults to true,
+LDAP_ACTIVE_DIRECTORY=false
+# LDAP_ALLOW_USERNAME_OR_EMAIL_LOGIN        : If enabled, GitLab will ignore everything after the first '@' in the LDAP username submitted by the user on login. Defaults to false if LDAP_UID is userPrincipalName, else true.
+LDAP_ALLOW_USERNAME_OR_EMAIL_LOGIN=true
+# LDAP_BLOCK_AUTO_CREATED_USERS             : Locks down those users until they have been cleared by the admin. Defaults to false.
+LDAP_BLOCK_AUTO_CREATED_USERS=false
+# LDAP_BASE                                 : Base where we can search for users. No default.
+LDAP_BASE=ou=user,dc=novatech
+# LDAP_USER_FILTER                          : Filter LDAP users. No default.
+LDAP_USER_FILTER=(employeeType=gitlab)
+# OAUTH_ENABLED                             : Enable OAuth support. Defaults to true if any of the support OAuth providers is configured, else defaults to false.
+# OAUTH_AUTO_SIGN_IN_WITH_PROVIDER          : Automatically sign in with a specific OAuth provider without showing GitLab sign-in page. Accepted values are google_oauth2, twitter, github, gitlab, bitbucket and saml. No default.
+# OAUTH_ALLOW_SSO                           : This allows users to login without having a user account first. User accounts will be created automatically when authentication was successful. Defaults to false.
+OAUTH_ALLOW_SSO=false
+# OAUTH_BLOCK_AUTO_CREATED_USERS            : Locks down those users until they have been cleared by the admin. Defaults to true.
+# OAUTH_AUTO_LINK_LDAP_USER                 : Look up new users in LDAP servers. If a match is found (same uid), automatically link the omniauth identity with the LDAP account. Defaults to false.
+# OAUTH_GOOGLE_API_KEY                      : Google App Client ID. No defaults.
+# OAUTH_GOOGLE_APP_SECRET                   : Google App Client Secret. No defaults.
+# OAUTH_GOOGLE_RESTRICT_DOMAIN              : Google App restricted domain. No defaults.
+# OAUTH_TWITTER_API_KEY                     : Twitter App API key. No defaults.
+# OAUTH_TWITTER_APP_SECRET                  : Twitter App API secret. No defaults.
+# OAUTH_GITHUB_API_KEY                      : GitHub App Client ID. No defaults.
+# OAUTH_GITHUB_APP_SECRET                   : GitHub App Client secret. No defaults.
+# OAUTH_GITLAB_API_KEY                      : GitLab App Client ID. No defaults.
+# OAUTH_GITLAB_APP_SECRET                   : GitLab App Client secret. No defaults.
+# OAUTH_BITBUCKET_API_KEY                   : BitBucket App Client ID. No defaults.
+# OAUTH_BITBUCKET_APP_SECRET                : BitBucket App Client secret. No defaults.
+# OAUTH_SAML_ASSERTION_CONSUMER_SERVICE_URL : The URL at which the SAML assertion should be received. When GITLAB_HTTPS=true, defaults to https://${GITLAB_HOST}/users/auth/saml/callback else defaults to http://${GITLAB_HOST}/users/auth/saml/callback.
+# OAUTH_SAML_IDP_CERT_FINGERPRINT           : The SHA1 fingerprint of the certificate. No Defaults.
+# OAUTH_SAML_IDP_SSO_TARGET_URL             : The URL to which the authentication request should be sent. No defaults.
+# OAUTH_SAML_ISSUER                         : The name of your application. When GITLAB_HTTPS=true, defaults to https://${GITLAB_HOST} else defaults to http://${GITLAB_HOST}.
+# OAUTH_SAML_NAME_IDENTIFIER_FORMAT         : Describes the format of the username required by GitLab, Defaults to urn:oasis:names:tc:SAML:2.0:nameid-format:transient
+# OAUTH_CROWD_SERVER_URL                    : Crowd server url. No defaults.
+# OAUTH_CROWD_APP_NAME                      : Crowd server application name. No defaults.
+# OAUTH_CROWD_APP_PASSWORD                  : Crowd server application password. No defaults.
+# GITLAB_GRAVATAR_ENABLED                   : Enables gravatar integration. Defaults to true.
+GITLAB_GRAVATAR_ENABLED=true
+# GITLAB_GRAVATAR_HTTP_URL                  : Sets a custom gravatar url. Defaults to http://www.gravatar.com/avatar/%{hash}?s=%{size}&d=identicon. This can be used for Libravatar integration.
+GITLAB_GRAVATAR_HTTP_URL=http://cdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon
+# GITLAB_GRAVATAR_HTTPS_URL                 : Same as above, but for https. Defaults to https://secure.gravatar.com/avatar/%{hash}?s=%{size}&d=identicon.
+GITLAB_GRAVATAR_HTTPS_URL=https://seccdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon
+# USERMAP_UID                               : Sets the uid for user git to the specified uid. Defaults to 1000.
+# USERMAP_GID                               : Sets the gid for group git to the specified gid. Defaults to USERMAP_UID if defined, else defaults to 1000.
+# GOOGLE_ANALYTICS_ID                       : Google Analytics ID. No defaults.
+# PIWIK_URL                                 : Sets the Piwik URL. No defaults.
+# PIWIK_SITE_ID                             : Sets the Piwik site ID. No defaults.
+# AWS_BACKUPS                               : Enables automatic uploads to an Amazon S3 instance. Defaults to false.
+# AWS_BACKUP_REGION                         : AWS region. No defaults.
+# AWS_BACKUP_ACCESS_KEY_ID                  : AWS access key id. No defaults.
+# AWS_BACKUP_SECRET_ACCESS_KEY              : AWS secret access key. No defaults.
+# AWS_BACKUP_BUCKET                         : AWS bucket for backup uploads. No defaults.
+# GITLAB_ROBOTS_PATH                        : Location of custom robots.txt. Uses GitLab's default robots.txt configuration by default. See www.robotstxt.org for examples.
diff --git a/roles/gitlab-sameersbn-8/meta/main.yml b/roles/gitlab-sameersbn-8/meta/main.yml
new file mode 100644
index 00000000..7f867d73
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/meta/main.yml
@@ -0,0 +1,2 @@
+---
+dependencies:
diff --git a/roles/gitlab-sameersbn-8/tasks/main.yml b/roles/gitlab-sameersbn-8/tasks/main.yml
new file mode 100644
index 00000000..6c156578
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/tasks/main.yml
@@ -0,0 +1,151 @@
+---
+# file: roles/docker-gitlab/tasks/main.yaml
+
+- assert:
+    that:
+    - gitlab_db_password is defined
+
+# *****************************************************************************
+# Setup the directory where the backup and restore is to take place
+
+- name: restore dir
+  file:
+    state: directory
+    path: '{{ gitlab_docker_restore_dir }}'
+    owner: root
+    group: tape
+    mode: 'u=rwx,g=rwx,o=rx'
+    recurse: no
+    setype: svirt_sandbox_file_t
+
+- name: docker_container.conf dir
+  file:
+    state: directory
+    path: '{{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}'
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rx,o=rx'
+    recurse: no
+
+# *****************************************************************************
+# backup script part
+
+- name: Assemble dir for backup scripts
+  file:
+    path: /usr/libexec/bacula/backup-scripts
+    state: directory
+
+- name: before_backup script part
+  template:
+    src: before_backup.j2
+    dest: /usr/libexec/bacula/backup-scripts/55.before_backup.gitlab
+
+- name: after_backup script part
+  template:
+    src: after_backup.j2
+    dest: /usr/libexec/bacula/backup-scripts/55.after_backup.gitlab
+
+# *****************************************************************************
+# update the Docker restore config
+
+- name: copy env-file
+  copy:
+    src: gitlab.env.list
+    dest: '{{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}/gitlab.env.list'
+    owner: root
+    group: root
+    mode: 'u=r,g=r,o='
+
+- name: exists - state file
+  stat:
+    path: '{{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}/restore.date.txt'
+    get_checksum: False
+    get_md5: False
+  register: st_gitlab_restore
+
+# *****************************************************************************
+# Create the data volumes
+
+- name: data-volume container (gitlab)
+  docker_volume:
+    name: '{{ gitlab_dv_name }}'
+
+- name: data-volume container (postgres)
+  docker_volume:
+    name: '{{ gitlab_db_dv_name }}'
+
+# *****************************************************************************
+# Start the data container running
+
+- name: start container (redis)
+  docker_container:
+    name: '{{ gitlab_redis_container_name }}'
+    detach: true
+    restart_policy: '{{ docker_restart_policy }}'
+    image: '{{ redis_image_name }}'
+    networks:
+      - name: '{{ docker_network_frontend }}'
+
+- name: start container (postgres)
+  docker_container:
+    name: '{{ gitlab_db_container_name }}'
+    detach: true
+    restart_policy: '{{ docker_restart_policy }}'
+    volumes:
+    - '{{ gitlab_db_dv_name }}:/var/lib/postgresql/data'
+    image: '{{ gitlab_db_image_name }}'
+    networks:
+    - name: '{{ docker_network_frontend }}'
+    env:
+    - POSTGRES_DB=gitlabhq_production
+    - POSTGRES_USER='{{ gitlab_db_user }}'
+    - POSTGRES_PASSWORD='{{ gitlab_db_password | quote }}'
+
+- name: Wait for container (postgres)
+  command: >
+    docker exec --user postgres
+    {{ gitlab_db_container_name }}
+    psql -l
+  retries: 10
+  delay: 3
+
+- name: start container (gitlab)
+  docker_container:
+    name: '{{ gitlab_container_name }}'
+    detach: true
+    restart_policy: '{{ docker_restart_policy }}'
+    hostname: '{{ gitlab_hostname }}'
+    ports: '{{ gitlab_port_args }}'
+    networks:
+    - name: '{{ docker_network_frontend }}'
+    volumes:
+    - '{{ openssl_dv_name }}:/home/git/data/certs:ro'
+    - '{{ gitlab_dv_name }}:/home/git/data'
+    - '{{ gitlab_docker_backup_dir }}:/mnt/backups'
+    env:
+    - GITLAB_TIMEZONE=America/Chicago
+    - GITLAB_HOST={{ gitlab_hostname }}
+    - GITLAB_SSH_HOST={{ gitlab_hostname }}
+    - DB_USER={{ gitlab_db_user }}
+    - DB_PASS={{ gitlab_db_password | quote }}
+    - SMTP_HOST={{ exim4_hostname }}
+    - SMTP_PASS={{ gitlab_email_password | quote }}
+    - LDAP_PASS={{ ldap_proxyagent_password | quote }}
+    - GITLAB_ROOT_PASSWORD={{ gitlab_root_password | quote }}
+    - GITLAB_SECRETS_DB_KEY_BASE={{ gitlab_secrets_db_key_base | quote }}
+    env-file: '{{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}/gitlab.env.list'
+    image: '{{ gitlab_image_name }}'
+
+- name: Wait for gitlab to be fully running
+  wait_for:
+    delay: 10
+    host: '{{ gitlab_network.ip_addr }}'
+    port: 22
+    state: started
+    timeout: 180
+
+# *****************************************************************************
+# restore?
+
+- include_tasks: restore.yml
+  when: st_gitlab_restore.stat.exists == False
diff --git a/roles/gitlab-sameersbn-8/tasks/restore.yml b/roles/gitlab-sameersbn-8/tasks/restore.yml
new file mode 100644
index 00000000..b9f74ee0
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/tasks/restore.yml
@@ -0,0 +1,54 @@
+---
+# file: roles/docker-gitlab/tasks/restore.yaml
+
+# *****************************************************************************
+# Get data from tape
+
+- name: find files
+  files_in_dir:
+    path: '{{ gitlab_docker_restore_dir }}'
+  register: gitlab_backup
+
+- name: data from tape
+  bacula:
+    command: restore
+    storage: '{{ bacula_storage }}'
+    fileset: '{{ bacula_fileset }}'
+    dest: '{{ bacula_dest }}'
+    path_to_restore: '{{ gitlab_docker_backup_dir }}'
+  when: gitlab_backup.file_list == []
+
+- name: find files
+  files_in_dir:
+    path: '{{ gitlab_docker_restore_dir }}'
+  register: gitlab_backup
+
+- name: File permissions
+  file:
+    path: '{{ gitlab_docker_restore_dir }}/{{ item }}'
+    state: touch
+    owner: root
+    group: root
+    mode: 'u=rwx,g=rwx,o='
+  with_items: '{{ gitlab_backup.file_list | default([]) }}'
+
+# *****************************************************************************
+# restore the gitlap backup
+
+- name: gitlab restore script
+  command: '{{ docker_projects_dir }}/docker-gitlab/gitlab.sh restore'
+  args:
+    chdir: '{{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}/'
+  when: gitlab_backup.file_list != []
+
+# *****************************************************************************
+# cleanup
+
+- name: Remove files
+  file:
+    path: '{{ gitlab_docker_restore_dir }}'
+    state: absent
+
+- name: State file
+  shell: 'date --rfc-3339=seconds > {{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}/restore.date.txt'
+  when: st_gitlab_restore.stat.exists == False
diff --git a/roles/gitlab-sameersbn-8/templates/after_backup.j2 b/roles/gitlab-sameersbn-8/templates/after_backup.j2
new file mode 100644
index 00000000..85b103f0
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/templates/after_backup.j2
@@ -0,0 +1,6 @@
+{% if gitlab_docker_backup_dir is defined %}
+
+# *****************************************************************************
+# Clean up git
+docker run --rm -v {{ docker_backup_dir }}:/tmp/import_export:z debian:latest bash -c "rm -rf /tmp/import_export/GIT"
+{% endif %}
diff --git a/roles/gitlab-sameersbn-8/templates/before_backup.j2 b/roles/gitlab-sameersbn-8/templates/before_backup.j2
new file mode 100644
index 00000000..d304bcb7
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/templates/before_backup.j2
@@ -0,0 +1,10 @@
+{% if gitlab_docker_backup_dir is defined %}
+
+# *****************************************************************************
+# Backup gitlab
+docker run --rm -v {{ docker_backup_dir }}:/tmp/import_export:z debian:latest bash -c "rm -rf /tmp/import_export/GIT"
+mkdir -p -m u=rwx,g=rwx,o= {{ gitlab_docker_backup_dir }}
+pushd {{ docker_restore_config_base_dir }}/{{ gitlab_dv_name }}
+./gitlab.sh backup
+popd
+{% endif %}
diff --git a/roles/gitlab-sameersbn-8/templates/config.sh.j2 b/roles/gitlab-sameersbn-8/templates/config.sh.j2
new file mode 100644
index 00000000..4df5fa31
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/templates/config.sh.j2
@@ -0,0 +1,19 @@
+# *****************************************************************************
+# Variables used in the backup/restore/import scripts
+
+DOCKER_IMAGE_TAG='{{ docker_image_tag }}'
+
+{ # variables for gitLab
+  GITLAB_IMAGE_NAME='{{ gitlab_image_name }}'
+  GITLAB_DV_IMAGE_NAME='{{ gitlab_dv_image_name }}'
+  GITLAB_CONTAINER_NAME='{{ gitlab_container_name }}'
+  GITLAB_DB_CONTAINER_NAME='{{ gitlab_db_container_name }}'
+  GITLAB_REDIS_CONTAINER_NAME='{{ gitlab_redis_container_name }}'
+  GITLAB_DV_NAME='{{ gitlab_dv_name }}'
+  HOST_GITLAB_RESTORE_DIR='{{ gitlab_docker_restore_dir }}'
+  HOST_GITLAB_BACKUP_DIR='{{ gitlab_docker_backup_dir }}'
+
+  # this file should be only readable by root since username and password exist in the file in plain text
+  GITLAB_DB_USER='{{ gitlab_db_user }}'
+  GITLAB_DB_PASSWORD='{{ gitlab_db_password }}'
+}
diff --git a/roles/gitlab-sameersbn-8/vars/main.yml b/roles/gitlab-sameersbn-8/vars/main.yml
new file mode 100644
index 00000000..56d0699a
--- /dev/null
+++ b/roles/gitlab-sameersbn-8/vars/main.yml
@@ -0,0 +1,2 @@
+---
+docker_name_prefix: '{{gitlab_version}}_'
