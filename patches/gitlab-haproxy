Bottom: 6f77e33bde5148ba731e64dc5eea30e498b42b4d
Top:    2e29251e23a4ad1cba04c832dbbe90e44c198a52
Author: Andrew Cooper <andrew.cooper@novatechweb.com>
Date:   2018-09-13 15:43:49 -0500

run gitlab behind haproxy


---
diff --git a/roles/docker-gitlab/templates/gitlab.rb-10.8.4.j2 b/roles/docker-gitlab/templates/gitlab.rb-10.8.4.j2
index f66fc4911..24c834aaf 100644
--- a/roles/docker-gitlab/templates/gitlab.rb-10.8.4.j2
+++ b/roles/docker-gitlab/templates/gitlab.rb-10.8.4.j2
@@ -884,7 +884,7 @@ gitlab_rails['smtp_tls'] = true
 
 nginx['enable'] = true
 # nginx['client_max_body_size'] = '250m'
-nginx['redirect_http_to_https'] = true
+# nginx['redirect_http_to_https'] = true
 # nginx['redirect_http_to_https_port'] = 80
 
 ##! Most root CA's are included by default
@@ -924,11 +924,11 @@ nginx['ssl_dhparam'] = "/etc/ssl/private/dhparam.pem" # Path to dhparams.pem, eg
 
 ##! **Override only if you use a reverse proxy**
 ##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#setting-the-nginx-listen-port
-# nginx['listen_port'] = nil
+nginx['listen_port'] = 80
 
 ##! **Override only if your reverse proxy internally communicates over HTTP**
 ##! Docs: https://docs.gitlab.com/omnibus/settings/nginx.html#supporting-proxied-ssl
-# nginx['listen_https'] = nil
+nginx['listen_https'] = false
 
 # nginx['custom_gitlab_server_config'] = "location ^~ /foo-namespace/bar-project/raw/ {\n deny all;\n}\n"
 # nginx['custom_nginx_config'] = "include /etc/nginx/conf.d/example.conf;"
